"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8112],{98112:(e,r,t)=>{t.r(r),t.d(r,{plugin:()=>Rt});var s=t(23214),o=t(92721),i=t(38251),a=t(68404),n=t(70332),c=t(2633),u=t(93570),l=t(2843),p=t(82897),d=t.n(p),m=t(85699);class f{static createISO8601Duration(e,r){return(0,p.includes)(["hour","minute","h","m"],r)?`PT${e}${r[0].toUpperCase()}`:`P${e}${r[0].toUpperCase()}`}static createISO8601DurationFromInterval(e){const r=+e.slice(0,e.length-1),t=e[e.length-1];if(e.indexOf("ms")>-1)return f.createISO8601Duration(1,"m");if("s"===e[e.length-1]){let e=60*r%60;return e<1&&(e=1),f.createISO8601Duration(e,"m")}return f.createISO8601Duration(r,t)}static findClosestTimeGrain(e,r){const t=(0,p.filter)(r,(e=>"auto"!==e));let s=t[0];const o=m.intervalToMs(e);for(let e=0;e<t.length;e++)o>m.intervalToMs(t[e])&&(s=e+1<t.length?t[e+1]:t[e]);return s}static createTimeGrainFromISO8601Duration(e){let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+" "+f.timeUnitToText(+t,s)}static timeUnitToText(e,r){let t="";return"S"===r&&(t="second"),"M"===r&&(t="minute"),"H"===r&&(t="hour"),"D"===r&&(t="day"),e>1?t+"s":t}static createKbnUnitFromISO8601Duration(e){if("auto"===e)return"auto";let r=1;"PT"===e.substring(0,2)&&(r=2);const t=e.substring(r,e.length-1),s=e.substring(e.length-1);return t+f.timeUnitToKbn(+t,s)}static timeUnitToKbn(e,r){return"S"===r?"s":"M"===r?"m":"H"===r?"h":"D"===r?"d":""}}class h{static parseResponseValues(e,r,t){const s=[];if(!e)return s;for(let o=0;o<e.value.length;o++)if(!(0,p.find)(s,["value",(0,p.get)(e.value[o],t)])){const i=(0,p.get)(e.value[o],t),a=(0,p.get)(e.value[o],r,i);s.push({text:a,value:i})}return s}static parseResourceNames(e,r){const t=[];if(!e)return t;for(let s=0;s<e.value.length;s++)"string"!=typeof e.value[s].type||r&&e.value[s].type.toLocaleLowerCase()!==r.toLocaleLowerCase()||t.push({text:e.value[s].name,value:e.value[s].name});return t}static parseMetadata(e,r){var t,s;const o=["None","Average","Minimum","Maximum","Total","Count"],i=null==e?void 0:e.value.find((e=>e.name.value===r));return i?{primaryAggType:i.primaryAggregationType,supportedAggTypes:i.supportedAggregationTypes||o,supportedTimeGrains:[{label:"Auto",value:"auto"},...h.parseTimeGrains(null!==(t=i.metricAvailabilities)&&void 0!==t?t:[])],dimensions:h.parseDimensions(null!==(s=i.dimensions)&&void 0!==s?s:[])}:{primaryAggType:"",supportedAggTypes:o,supportedTimeGrains:[],dimensions:[]}}static parseTimeGrains(e){const r=[];return e?(e.forEach((e=>{e.timeGrain&&r.push({label:f.createTimeGrainFromISO8601Duration(e.timeGrain),value:e.timeGrain})})),r):r}static parseDimensions(e){return e.map((e=>({label:e.localizedValue||e.value,value:e.value})))}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,p.find)(r,["value",(0,p.get)(e.value[s],t)])||r.push({text:`${(0,p.get)(e.value[s],"displayName")}`,value:(0,p.get)(e.value[s],t)});return r}static parseSubscriptionsForSelect(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.data.value.length;s++)(0,p.find)(r,["value",(0,p.get)(e.data.value[s],t)])||r.push({label:`${(0,p.get)(e.data.value[s],"displayName")} - ${(0,p.get)(e.data.value[s],t)}`,value:(0,p.get)(e.data.value[s],t)});return r}static parseWorkspacesForSelect(e){const r=[];if(!e)return r;const t="customerId";for(let s=0;s<e.data.value.length;s++)(0,p.find)(r,["value",(0,p.get)(e.data.value[s].properties,t)])||r.push({label:(0,p.get)(e.data.value[s],"name"),value:(0,p.get)(e.data.value[s].properties,t)});return r}static parseLocations(e){const r=[];if(!e)return r;for(const t of e.value)r.push({name:t.name,displayName:t.displayName,supportsLogs:void 0});return r}}const g=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===r.length)return[];const t=r.reduce(((e,r)=>(e.add(r),e)),new Set);return e.filter((e=>t.has(e.value)))},v=e=>({value:e.value,label:e.text}),b=(e,r,t)=>{const s=[...e,r],o=e.map((e=>e.value.toLowerCase())).concat(r.options.map((e=>e.value)));return t&&!o.includes(t.toLowerCase())&&s.push({label:t,value:t}),s};const y="azuremonitor",w="loganalytics",k="resourcegraph";function S(e,r){if("string"==typeof e)return r.multi||r.includeAll&&!r.allValue?"'"+e+"'":e;if("number"==typeof e)return e;return(0,p.map)(e,(r=>"number"==typeof e?e:"'"+r+"'")).join(",")}var j=t(65737);let z,x;!function(e){e.AzureMonitor="Azure Monitor",e.LogAnalytics="Azure Log Analytics",e.AzureResourceGraph="Azure Resource Graph",e.SubscriptionsQuery="Azure Subscriptions",e.ResourceGroupsQuery="Azure Resource Groups",e.NamespacesQuery="Azure Namespaces",e.ResourceNamesQuery="Azure Resource Names",e.MetricNamesQuery="Azure Metric Names",e.WorkspacesQuery="Azure Workspaces",e.GrafanaTemplateVariableFn="Grafana Template Variable Function"}(z||(z={})),function(e){e.Public="AzureCloud",e.China="AzureChinaCloud",e.USGovernment="AzureUSGovernment",e.Germany="AzureGermanCloud",e.None=""}(x||(x={}));const N=Symbol("Concealed client secret");function A(e){return e.jsonData.azureAuthType?e.jsonData.azureAuthType:e.jsonData.tenantId&&e.jsonData.clientId?"clientsecret":j.v.azure.managedIdentityEnabled?"msi":"clientsecret"}function M(){switch(j.v.azure.cloud){case x.Public:case x.None:case void 0:return"azuremonitor";case x.China:return"chinaazuremonitor";case x.USGovernment:return"govazuremonitor";case x.Germany:return"germanyazuremonitor";default:throw new Error(`The cloud '${j.v.azure.cloud}' not supported.`)}}function C(e){switch(e){case"azuremonitor":return"https://portal.azure.com";case"chinaazuremonitor":return"https://portal.azure.cn";case"govazuremonitor":return"https://portal.azure.us";case"germanyazuremonitor":return"https://portal.microsoftazure.de";default:throw new Error("The cloud not supported.")}}function G(e){switch(A(e)){case"msi":return M();case"clientsecret":return e.jsonData.cloudName||M()}}function I(e){if(e.secureJsonFields.clientSecret)return N;{var r;const t=null===(r=e.secureJsonData)||void 0===r?void 0:r.clientSecret;return"string"==typeof t&&t.length>0?t:void 0}}var R=t(65231),T=t(46889),q=t(70917),O=t(5333),D=t(8006);const P={configEditor:{authType:{select:"data-testid auth-type"},azureCloud:{input:"data-testid azure-cloud"},tenantID:{input:"data-testid tenant-id"},clientID:{input:"data-testid client-id"},clientSecret:{input:"data-testid client-secret"},loadSubscriptions:{button:"data-testid load-subscriptions"},defaultSubscription:{input:"data-testid default-subscription"}},queryEditor:{header:{select:"data-testid azure-monitor-experimental-header"},resourcePicker:{select:{button:"data-testid resource-picker-select"},search:{input:"data-testid resource-picker-search"},apply:{button:"data-testid resource-picker-apply"},cancel:{button:"data-testid resource-picker-cancel"},advanced:{collapse:"data-testid resource-picker-advanced",subscription:{input:"data-testid resource-picker-subscription"},resourceGroup:{input:"data-testid resource-picker-resource-group"},namespace:{input:"data-testid resource-picker-namespace"},resource:{input:"data-testid resource-picker-resource"}}},metricsQueryEditor:{metricName:{input:"data-testid metric-name"}},logsQueryEditor:{formatSelection:{input:"data-testid format-selection"}},argsQueryEditor:{container:{input:"data-testid azure-monitor-arg-query-editor"},subscriptions:{input:"data-testid azure-monitor-args-subscription"}}},variableEditor:{queryType:{input:"data-testid query-type"},subscription:{input:"data-testid subscription"},resourceGroup:{input:"data-testid resource-group"},namespace:{input:"data-testid namespace"},resource:{input:"data-testid resource"}}};var E,L,Q=t(45916);const{Input:F}=R.vw6,V=[{value:"msi",label:"Managed Identity"},{value:"clientsecret",label:"App Registration"}],$=e=>{const{credentials:r,azureCloudOptions:t,onCredentialsChange:s,getSubscriptions:o,disabled:i}=e,n=function(e){switch(e.authType){case"msi":return!0;case"clientsecret":return!!(e.azureCloud&&e.tenantId&&e.clientId&&e.clientSecret)}}(r),[c,u]=(0,a.useState)([]),[l,p]=(0,a.useReducer)((e=>e+1),0);(0,a.useEffect)((()=>{if(!o||!n)return void d([]);let e=!1;return o().then((r=>{e||d(r,l)})),()=>{e=!0}}),[l]);const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(u(e),o)if(t&&!r.defaultSubscriptionId&&e.length>0)m(e[0]);else if(r.defaultSubscriptionId){e.find((e=>e.value===r.defaultSubscriptionId))||m(void 0)}},m=e=>{if(s){const t=Object.assign({},r,{defaultSubscriptionId:null==e?void 0:e.value});s(t)}};return(0,Q.jsxs)("div",{className:"gf-form-group",children:[e.managedIdentityEnabled&&(0,Q.jsx)(T._,{label:"Authentication",labelWidth:18,tooltip:"Choose the type of authentication to Azure services","data-testid":P.configEditor.authType.select,htmlFor:"authentication-type",children:(0,Q.jsx)(q.Ph,{className:"width-15",value:V.find((e=>e.value===r.authType)),options:V,onChange:e=>{if(s){u([]);const t=Object.assign({},r,{authType:e.value||"msi",defaultSubscriptionId:void 0});s(t)}},disabled:i})}),"clientsecret"===r.authType&&(0,Q.jsxs)(Q.Fragment,{children:[t&&(0,Q.jsx)(T._,{label:"Azure Cloud",labelWidth:18,tooltip:"Choose an Azure Cloud","data-testid":P.configEditor.azureCloud.input,htmlFor:"azure-cloud-type",disabled:i,children:(0,Q.jsx)(q.Ph,{inputId:"azure-cloud-type","aria-label":"Azure Cloud",className:"width-15",value:t.find((e=>e.value===r.azureCloud)),options:t,onChange:e=>{if(s&&"clientsecret"===r.authType){u([]);const t=Object.assign({},r,{azureCloud:e.value,defaultSubscriptionId:void 0});s(t)}}})}),(0,Q.jsx)(T._,{label:"Directory (tenant) ID",labelWidth:18,"data-testid":P.configEditor.tenantID.input,htmlFor:"tenant-id",children:(0,Q.jsx)("div",{className:"width-15",children:(0,Q.jsx)(F,{"aria-label":"Tenant ID",className:"width-30",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.tenantId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){u([]);const t=Object.assign({},r,{tenantId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:i})})}),(0,Q.jsx)(T._,{label:"Application (client) ID",labelWidth:18,"data-testid":P.configEditor.clientID.input,htmlFor:"tenant-id",children:(0,Q.jsx)("div",{className:"width-15",children:(0,Q.jsx)(F,{className:"width-30","aria-label":"Client ID",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientId||"",onChange:e=>{if(s&&"clientsecret"===r.authType){u([]);const t=Object.assign({},r,{clientId:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:i})})}),!i&&("symbol"==typeof r.clientSecret?(0,Q.jsxs)("div",{className:"gf-form-inline",children:[E||(E=(0,Q.jsxs)("div",{className:"gf-form",children:[(0,Q.jsx)(O.c,{className:"width-12",children:"Client Secret"}),(0,Q.jsx)(F,{"data-testid":"client-secret",className:"width-25",placeholder:"configured",disabled:!0})]})),(0,Q.jsx)("div",{className:"gf-form",children:(0,Q.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,Q.jsx)(D.zx,{variant:"secondary",type:"button",onClick:()=>{if(s&&"clientsecret"===r.authType){u([]);const e=Object.assign({},r,{clientSecret:"",defaultSubscriptionId:void 0});s(e)}},disabled:i,children:"reset"})})})]}):(0,Q.jsx)(T._,{label:"Client Secret",labelWidth:18,"data-testid":P.configEditor.clientSecret.input,htmlFor:"client-secret",children:(0,Q.jsx)(F,{className:"width-30","aria-label":"Client Secret",placeholder:"XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",value:r.clientSecret||"",onChange:e=>{if(s&&"clientsecret"===r.authType){u([]);const t=Object.assign({},r,{clientSecret:e.target.value,defaultSubscriptionId:void 0});s(t)}},disabled:i})}))]}),o&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)("div",{className:"gf-form-inline",children:(0,Q.jsxs)("div",{className:"gf-form","data-testid":P.configEditor.defaultSubscription.input,children:[L||(L=(0,Q.jsx)(O.c,{className:"width-12",children:"Default Subscription"})),(0,Q.jsx)("div",{className:"width-30",children:(0,Q.jsx)(q.Ph,{"aria-label":"Default Subscription",value:r.defaultSubscriptionId?c.find((e=>e.value===r.defaultSubscriptionId)):void 0,options:c,onChange:m,disabled:i})})]})}),!i&&(0,Q.jsx)("div",{className:"gf-form-inline",children:(0,Q.jsx)("div",{className:"gf-form",children:(0,Q.jsx)("div",{className:"max-width-30 gf-form-inline",children:(0,Q.jsx)(D.zx,{variant:"secondary","aria-label":"Load Subscriptions",size:"sm",type:"button",onClick:p,disabled:!n,"data-testid":P.configEditor.loadSubscriptions.button,children:"Load Subscriptions"})})})})]}),e.children]})};var W;const X=[{value:"azuremonitor",label:"Azure"},{value:"govazuremonitor",label:"Azure US Government"},{value:"germanyazuremonitor",label:"Azure Germany"},{value:"chinaazuremonitor",label:"Azure China"}],_=e=>{const{updateOptions:r,getSubscriptions:t}=e,s=(0,a.useMemo)((()=>function(e){switch(A(e)){case"msi":return j.v.azure.managedIdentityEnabled?{authType:"msi",defaultSubscriptionId:e.jsonData.subscriptionId}:{authType:"clientsecret",azureCloud:M()};case"clientsecret":return{authType:"clientsecret",azureCloud:e.jsonData.cloudName||M(),tenantId:e.jsonData.tenantId,clientId:e.jsonData.clientId,clientSecret:I(e),defaultSubscriptionId:e.jsonData.subscriptionId}}}(e.options)),[e.options]);return(0,Q.jsxs)(Q.Fragment,{children:[W||(W=(0,Q.jsx)("h3",{className:"page-heading",children:"Authentication"})),(0,Q.jsx)($,{managedIdentityEnabled:j.v.azure.managedIdentityEnabled,credentials:s,azureCloudOptions:X,onCredentialsChange:e=>{r((r=>function(e,r){switch(r.authType){case"msi":if(!j.v.azure.managedIdentityEnabled)throw new Error("Managed Identity authentication is not enabled in Grafana config.");return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"msi",subscriptionId:r.defaultSubscriptionId})});case"clientsecret":return Object.assign({},e,{jsonData:Object.assign({},e.jsonData,{azureAuthType:"clientsecret",cloudName:r.azureCloud||M(),tenantId:r.tenantId,clientId:r.clientId,subscriptionId:r.defaultSubscriptionId}),secureJsonData:Object.assign({},e.secureJsonData,{clientSecret:"string"==typeof r.clientSecret?r.clientSecret:void 0}),secureJsonFields:Object.assign({},e.secureJsonFields,{clientSecret:"symbol"==typeof r.clientSecret})})}}(r,e)))},getSubscriptions:t,disabled:e.options.readOnly})]})};function U(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class B extends a.PureComponent{constructor(e){super(e),U(this,"templateSrv",(0,c.J)()),U(this,"baseURL",void 0),U(this,"updateOptions",(e=>{const r=e(this.props.options);this.props.onOptionsChange(r),this.setState({unsaved:!0})})),U(this,"saveOptions",(async()=>{this.state.unsaved&&(await(0,u.i)().put(`/api/datasources/${this.props.options.id}`,this.props.options).then((e=>{(0,n.fd)(this.props,"version",e.datasource.version)})),this.setState({unsaved:!1}))})),U(this,"getSubscriptions",(async()=>{await this.saveOptions();try{const e=await(0,u.i)().fetch({url:this.baseURL+"?api-version=2019-03-01",method:"GET"}).toPromise();return this.setState({error:void 0}),h.parseSubscriptionsForSelect(e)}catch(r){var e;if((0,u.kW)(r))this.setState({error:{title:"Error requesting subscriptions",description:"Could not request subscriptions from Azure. Check your credentials and try again.",details:null==r||null===(e=r.data)||void 0===e?void 0:e.message}});return Promise.resolve([])}})),this.state={unsaved:!1},this.baseURL=`/api/datasources/${this.props.options.id}/resources/${y}/subscriptions`}render(){const{options:e}=this.props,{error:r}=this.state;return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(_,{options:e,updateOptions:this.updateOptions,getSubscriptions:this.getSubscriptions}),r&&(0,Q.jsxs)(l.b,{severity:"error",title:r.title,children:[(0,Q.jsx)("p",{children:r.description}),r.details&&(0,Q.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:r.details})]})]})}}var H=t(31787);function J(e){var r,t,s,o,i,a,n,c,u,l,p,d,m,f,h,g,v;if(!e||"object"!=typeof e)return;if("string"==typeof e.message)return e.message;if("string"==typeof(null===(r=e.data)||void 0===r||null===(t=r.error)||void 0===t?void 0:t.message))return e.data.error.message;const b=(null===(s=e.error)||void 0===s||null===(o=s.data)||void 0===o||null===(i=o.error)||void 0===i||null===(a=i.innererror)||void 0===a||null===(n=a.innererror)||void 0===n?void 0:n.message)||(null===(c=e.error)||void 0===c||null===(u=c.data)||void 0===u||null===(l=u.error)||void 0===l||null===(p=l.innererror)||void 0===p?void 0:p.message)||(null===(d=e.error)||void 0===d||null===(m=d.data)||void 0===m||null===(f=m.error)||void 0===f?void 0:f.message)||(null===(h=e.error)||void 0===h||null===(g=h.data)||void 0===g?void 0:g.message)||(null===(v=e.data)||void 0===v?void 0:v.message)||e;return"string"==typeof b?b:b&&b.toString?b.toString():void 0}function K(){const[e,r]=(0,a.useState)([]),t=(0,a.useCallback)(((e,t)=>{r((r=>{const s=[...r],o=r.findIndex((r=>{let[t]=r;return t===e}));return o>-1&&s.splice(o,1),t&&s.unshift([e,t]),s}))}),[]);return[(0,a.useMemo)((()=>{const r=e[0];return r&&(t=r[1],(0,a.isValidElement)(t)?t:J(t));var t}),[e]),t]}var Z=t(68522);const Y=["labelWidth","inlineField"];const ee=e=>{const{labelWidth:r,inlineField:t}=e,s=function(e,r){if(null==e)return{};var t,s,o={},i=Object.keys(e);for(s=0;s<i.length;s++)t=i[s],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,Y);return t?(0,Q.jsx)(T._,Object.assign({labelWidth:r||18},s)):(0,Q.jsx)(Z.EditorField,Object.assign({width:r||18},s))},re=e=>{let{query:r,subscriptions:t,variableOptionGroup:s,onQueryChange:o,multiSelect:i=!1}=e;const n=(0,a.useCallback)((e=>{if(!e.value)return;let t=Object.assign({},r,{subscription:e.value});r.queryType===z.AzureMonitor&&(t.azureMonitor=Object.assign({},t.azureMonitor,{resourceGroup:void 0,metricNamespace:void 0,resourceName:void 0,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})),o(t)}),[r,o]),c=(0,a.useCallback)((e=>{e&&o(Object.assign({},r,{subscriptions:e.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""}))}))}),[r,o]),u=(0,a.useMemo)((()=>[...t,s]),[t,s]);return i?(0,Q.jsx)(ee,{label:"Subscriptions","data-testid":P.queryEditor.argsQueryEditor.subscriptions.input,children:(0,Q.jsx)(q.NU,{isClearable:!0,value:g([...t,...s.options],r.subscriptions),inputId:"azure-monitor-subscriptions-field",onChange:c,options:u,width:38})}):(0,Q.jsx)(ee,{label:"Subscription","data-testid":P.queryEditor.argsQueryEditor.subscriptions.input,children:(0,Q.jsx)(q.Ph,{value:r.subscription,inputId:"azure-monitor-subscriptions-field",onChange:n,options:u,width:38,allowCustomValue:!0})})},te=e=>{var r,t;let{query:s,onQueryChange:o}=e;const i=(0,a.useCallback)((e=>{o(Object.assign({},s,{azureResourceGraph:Object.assign({},s.azureResourceGraph,{query:e})}))}),[o,s]);return(0,Q.jsx)(H.p,{value:null!==(r=null===(t=s.azureResourceGraph)||void 0===t?void 0:t.query)&&void 0!==r?r:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:i,onSave:i})},se="arg-subscriptions";function oe(e,r,t){let s=r||[];0===s.length&&t&&(s=[t]),0===s.length&&e.length&&(s=[e[0]]);const o=(0,p.intersection)(s,e);return e.length&&s.length>o.length&&(s=o.length>0?o:[e[0]]),s}const ie=e=>{let{query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onChange:i,setError:n}=e;const[c,u]=(0,a.useState)([]);return(0,a.useMemo)((()=>{t.getSubscriptions().then((e=>{const t=e.map((e=>({label:e.text,value:e.value,description:e.value})));u(t),n(se,void 0),i(Object.assign({},r,{subscriptions:oe(t.map((e=>e.value)),r.subscriptions,r.subscription)}))})).catch((e=>n(se,e)))}),[t]),(0,Q.jsxs)("span",{"data-testid":P.queryEditor.argsQueryEditor.container.input,children:[(0,Q.jsx)(Z.EditorRows,{children:(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsx)(Z.EditorFieldGroup,{children:(0,Q.jsx)(re,{multiSelect:!0,subscriptions:c,query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onQueryChange:i,setError:n})})})}),(0,Q.jsx)(te,{query:r,datasource:t,subscriptionId:s,variableOptionGroup:o,onQueryChange:i,setError:n})]})};var ae=t(52423),ne=t(16755),ce=t(78941),ue=t(99500),le=t(31423),pe=t(38953),de=t(50191);const me=e=>{const r=(0,ne.l4)(),t=fe(r,e);return(0,Q.jsx)("span",{className:(0,ae.cx)(t.wrapper)})};me.defaultProps={v:0,h:0,layout:"block"};const fe=(0,de.B)(((e,r)=>{var t,s;return{wrapper:(0,ae.css)([{paddingRight:e.spacing(null!==(t=r.h)&&void 0!==t?t:0),paddingBottom:e.spacing(null!==(s=r.v)&&void 0!==s?s:0)},"inline"===r.layout&&{display:"inline-block"},"block"===r.layout&&{display:"block"}])}}));var he,ge,ve=t(38595),be=t(83744),ye=t(21888),we=t(4645);const ke=e=>{var r,t,s,o;let{resource:i,onChange:n}=e;const[c,u]=(0,a.useState)(!!i&&JSON.stringify(i).includes("$"));return(0,Q.jsx)("div",{"data-testid":P.queryEditor.resourcePicker.advanced.collapse,children:(0,Q.jsxs)(ve.U,{collapsible:!0,label:"Advanced",isOpen:c,onToggle:()=>u(!c),children:["string"==typeof i?(0,Q.jsxs)(Q.Fragment,{children:[" ",he||(he=(0,Q.jsx)(be._,{htmlFor:"input-advanced-resource-picker",children:(0,Q.jsxs)("h6",{children:["Resource URI"," ",(0,Q.jsx)(ye.u,{content:(0,Q.jsxs)(Q.Fragment,{children:["Manually edit the"," ",(0,Q.jsxs)("a",{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/logs/log-standard-columns#_resourceid",rel:"noopener noreferrer",target:"_blank",children:["resource uri."," "]}),"Supports the use of multiple template variables (ex: /subscriptions/$subId/resourceGroups/$rg)"]}),placement:"right",interactive:!0,children:(0,Q.jsx)(ue.J,{name:"info-circle"})})]})})),(0,Q.jsx)(we.I,{id:"input-advanced-resource-picker",value:i,onChange:e=>n(e.currentTarget.value),placeholder:"ex: /subscriptions/$subId"})]}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(T._,{label:"Subscription",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-subscription",labelWidth:15,"data-testid":P.queryEditor.resourcePicker.advanced.subscription.input,children:(0,Q.jsx)(we.I,{id:"input-advanced-resource-picker-subscription",value:null!==(r=null==i?void 0:i.subscription)&&void 0!==r?r:"",onChange:e=>n(Object.assign({},i,{subscription:e.currentTarget.value})),placeholder:"aaaaaaaa-bbbb-cccc-dddd-eeeeeeee"})}),(0,Q.jsx)(T._,{label:"Resource Group",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceGroup",labelWidth:15,"data-testid":P.queryEditor.resourcePicker.advanced.resourceGroup.input,children:(0,Q.jsx)(we.I,{id:"input-advanced-resource-picker-resourceGroup",value:null!==(t=null==i?void 0:i.resourceGroup)&&void 0!==t?t:"",onChange:e=>n(Object.assign({},i,{resourceGroup:e.currentTarget.value})),placeholder:"resource-group"})}),(0,Q.jsx)(T._,{label:"Namespace",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-metricNamespace",labelWidth:15,"data-testid":P.queryEditor.resourcePicker.advanced.namespace.input,children:(0,Q.jsx)(we.I,{id:"input-advanced-resource-picker-metricNamespace",value:null!==(s=null==i?void 0:i.metricNamespace)&&void 0!==s?s:"",onChange:e=>n(Object.assign({},i,{metricNamespace:e.currentTarget.value})),placeholder:"Microsoft.Insights/metricNamespaces"})}),(0,Q.jsx)(T._,{label:"Resource Name",grow:!0,transparent:!0,htmlFor:"input-advanced-resource-picker-resourceName",labelWidth:15,"data-testid":P.queryEditor.resourcePicker.advanced.resource.input,children:(0,Q.jsx)(we.I,{id:"input-advanced-resource-picker-resourceName",value:null!==(o=null==i?void 0:i.resourceName)&&void 0!==o?o:"",onChange:e=>n(Object.assign({},i,{resourceName:e.currentTarget.value})),placeholder:"name"})})]}),ge||(ge=(0,Q.jsx)(me,{v:2}))]})})};var Se=t(75336),je=t(23734),ze=t(12310);let xe;var Ne,Ae,Me,Ce;!function(e){e.Subscription="Subscription",e.ResourceGroup="ResourceGroup",e.Resource="Resource",e.VariableGroup="TemplateVariableGroup",e.Variable="TemplateVariable"}(xe||(xe={}));const Ge=e=>{let{isOpen:r,entry:{type:t}}=e;switch(t){case xe.Subscription:return Ne||(Ne=(0,Q.jsx)(ue.J,{name:"layer-group"}));case xe.ResourceGroup:return(0,Q.jsx)(ue.J,{name:r?"folder-open":"folder"});case xe.Resource:return Ae||(Ae=(0,Q.jsx)(ue.J,{name:"cube"}));case xe.VariableGroup:return Me||(Me=(0,Q.jsx)(ue.J,{name:"x"}));case xe.Variable:return Ce||(Ce=(0,Q.jsx)(ue.J,{name:"x"}));default:return null}},Ie=e=>({table:(0,ae.css)({width:"100%",tableLayout:"fixed"}),tableScroller:(0,ae.css)({maxHeight:"50vh",overflow:"auto"}),header:(0,ae.css)({background:e.colors.background.secondary}),row:(0,ae.css)({borderBottom:`1px solid ${e.colors.border.weak}`,"&:last-of-type":{borderBottomColor:e.colors.border.medium}}),disabledRow:(0,ae.css)({opacity:.5}),cell:(0,ae.css)({padding:e.spacing(1,1,1,0),width:"25%",overflow:"hidden",textOverflow:"ellipsis","&:first-of-type":{width:"50%",padding:e.spacing(1,1,1,2)}}),collapseButton:(0,ae.css)({margin:0}),loadingCell:(0,ae.css)({textAlign:"center"}),spinner:(0,ae.css)({marginBottom:0}),nestedEntry:(0,ae.css)({display:"flex",alignItems:"center"}),entryContentItem:(0,ae.css)({margin:e.spacing(0,1,0,0)}),truncated:(0,ae.css)({minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),resourceField:(0,ae.css)({maxWidth:e.spacing(36),overflow:"hidden"}),resourceFieldButton:(0,ae.css)({padding:"7px",textAlign:"left"}),nestedRowCheckbox:(0,ae.css)({zIndex:0}),selectionFooter:(0,ae.css)({position:"sticky",bottom:0,background:e.colors.background.primary,paddingTop:e.spacing(2)}),loadingWrapper:(0,ae.css)({textAlign:"center",paddingTop:e.spacing(2),paddingBottom:e.spacing(2),color:e.colors.text.secondary}),resultLimit:(0,ae.css)({margin:"4px 0",fontStyle:"italic"}),modal:(0,ae.css)({width:e.breakpoints.values.lg})});var Re,Te,qe,Oe;const De=e=>{let{entry:r,isSelected:t,isDisabled:s,isOpen:o,isSelectable:i,level:n,scrollIntoView:c,onToggleCollapse:u,onSelectedChange:l}=e;const p=(0,ne.l4)(),d=(0,ne.wW)(Ie),m=!!r.children,f=(0,a.useCallback)((()=>{u(r)}),[u,r]),h=(0,a.useCallback)((e=>{const t=e.target.checked;l(r,t)}),[r,l]),g=`${c?"table":"summary"}_checkbox_${r.uri}`;return(0,a.useEffect)((()=>{var e;t&&c&&(null===(e=document.getElementById(g))||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}))}),[]),(0,Q.jsxs)("div",{className:d.nestedEntry,style:{marginLeft:n*(3*p.spacing.gridSize)},children:[m?(0,Q.jsx)(je.h,{className:d.collapseButton,name:o?"angle-down":"angle-right","aria-label":o?`Collapse ${r.name}`:`Expand ${r.name}`,onClick:f,id:r.id}):Re||(Re=(0,Q.jsx)(me,{layout:"inline",h:2})),Te||(Te=(0,Q.jsx)(me,{layout:"inline",h:2})),i&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(ze.X,{id:g,onChange:h,disabled:s,value:t,className:d.nestedRowCheckbox}),qe||(qe=(0,Q.jsx)(me,{layout:"inline",h:2}))]}),(0,Q.jsx)(Ge,{entry:r,isOpen:o}),Oe||(Oe=(0,Q.jsx)(me,{layout:"inline",h:1})),(0,Q.jsx)("label",{htmlFor:g,className:(0,ae.cx)(d.entryContentItem,d.truncated),children:r.name})]})};var Pe=t(64421);class Ee{static buildResourceUri(e,r){const t=[],{subscription:s,resourceGroup:o,metricNamespace:i,resourceName:a}=r;if(s&&(t.push("/subscriptions",s),o&&(t.push("resourceGroups",o),i&&a))){const r=e.replace(i),s=i.split("/"),o=e.replace(a),n=a.split("/"),c=s.shift();if(c&&t.push("providers",c),r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")&&!o.endsWith("default")&&n.push("default"),n.length>s.length){const e=n.shift();e&&t.push(e)}for(const e in s)t.push(s[e]),t.push(n[e])}return t.join("/")}static buildAzureMonitorGetMetricNamespacesUrl(e,r,t,s,o){let i;if("resourceUri"in t)i=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:s,resourceName:a}=t;i=Ee.buildResourceUri(o,{subscription:e,resourceGroup:r,metricNamespace:s,resourceName:a})}return`${e}${i}/providers/microsoft.insights/metricNamespaces?api-version=${r}${s?"&region=global":""}`}static buildAzureMonitorGetMetricNamesUrl(e,r,t,s){let o;const{customNamespace:i}=t;if("resourceUri"in t)o=t.resourceUri;else{const{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a}=t;o=Ee.buildResourceUri(s,{subscription:e,resourceGroup:r,metricNamespace:i,resourceName:a})}let a=`${e}${o}/providers/microsoft.insights/metricdefinitions?api-version=${r}`;return i&&(a+=`&metricnamespace=${encodeURIComponent(i)}`),a}}const Le=/\/subscriptions\/(?<subscription>[^/]+)(?:\/resourceGroups\/(?<resourceGroup>[^/]+)(?:\/providers\/(?<metricNamespaceAndResource>.+))?)?/;function Qe(e){var r;const t=Le.exec(e),s=null!==(r=null==t?void 0:t.groups)&&void 0!==r?r:{},{subscription:o,resourceGroup:i,metricNamespaceAndResource:a}=s,{metricNamespace:n,resourceName:c}=function(e){if(!e)return{};const r=e.split("/"),t=r.splice(0,2),s=r.splice(0,1);for(;r.length;){const e=r.shift();r.length%2==0?s.push(e):t.push(e)}return{metricNamespace:t.join("/"),resourceName:s.join("/")}}(a);return{subscription:o,resourceGroup:i,metricNamespace:n,resourceName:c}}function Fe(e){return"string"==typeof e?Qe(e):e}function Ve(e){return!!e.match(/^[A-Z0-9]+/i)}function $e(e,r){var t,s,o,i;const a=Fe(r),n=Fe(e);return(null==n?void 0:n.subscription)===(null==a?void 0:a.subscription)&&(null==n||null===(t=n.resourceGroup)||void 0===t?void 0:t.toLowerCase())===(null==a||null===(s=a.resourceGroup)||void 0===s?void 0:s.toLowerCase())&&(c=null==n||null===(o=n.metricNamespace)||void 0===o?void 0:o.toLowerCase(),u=null==n?void 0:n.resourceName,l=null==a||null===(i=a.metricNamespace)||void 0===i?void 0:i.toLowerCase(),p=null==a?void 0:a.resourceName,null!==(d=l)&&void 0!==d&&d.startsWith("microsoft.storage/storageaccounts")&&(l="microsoft.storage/storageaccounts",null!==(m=p)&&void 0!==m&&m.endsWith("/default")&&(p=p.slice(0,-"/default".length))),c===l&&u===p);var c,u,l,p,d,m}function We(e,r){for(const t of e){if($e(t.uri,r))return t;if(t.children){const e=We(t.children,r);if(e)return e}}}function Xe(e,r,t){return(0,Pe.ZP)(e,(e=>{const s=We(e,r);s&&(s.children=t)}))}const _e=e=>{var r;let{row:t,selectedRows:s,level:o,requestNestedRows:i,onRowSelectedChange:n,selectableEntryTypes:c,scrollIntoView:u}=e;const l=(0,ne.wW)(Ie),[p,d]=(0,a.useState)("closed"),m=!!s.find((e=>e.uri===t.uri)),f=s.length>0&&!m,h="open"===p;return(0,a.useEffect)((()=>{var e;const r=s[0];r&&!!We(null!==(e=t.children)&&void 0!==e?e:[],r.uri)&&d("open")}),[s,t]),(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)("tr",{className:(0,ae.cx)(l.row,f&&l.disabledRow),children:[(0,Q.jsx)("td",{className:l.cell,children:(0,Q.jsx)(De,{level:o,isSelected:m,isDisabled:f,isOpen:h,entry:t,onToggleCollapse:async()=>{"open"!==p?(d("loading"),i(t).then((()=>d("open"))).catch((()=>d("closed")))):d("closed")},onSelectedChange:n,isSelectable:c.some((e=>e===t.type)),scrollIntoView:u})}),(0,Q.jsx)("td",{className:l.cell,children:t.typeLabel}),(0,Q.jsx)("td",{className:l.cell,children:null!==(r=t.location)&&void 0!==r?r:"-"})]},t.id),h&&t.children&&Object.keys(t.children).length>0&&t.children.map((e=>(0,Q.jsx)(_e,{row:e,selectedRows:s,level:o+1,requestNestedRows:i,onRowSelectedChange:n,selectableEntryTypes:c,scrollIntoView:u},e.uri))),(0,Q.jsx)(Se.n,{visible:"loading"===p,children:(0,Q.jsx)("tr",{children:(0,Q.jsx)("td",{className:(0,ae.cx)(l.cell,l.loadingCell),colSpan:3,children:(0,Q.jsx)(pe.u,{text:"Loading...",className:l.spinner})})})})]})},Ue=_e;var Be;const He=e=>{let{searchFn:r}=e;const[t,s]=(0,a.useState)(""),o=(0,a.useMemo)((()=>(0,p.debounce)(r,600)),[r]);return(0,a.useEffect)((()=>()=>{o.cancel()}),[o]),(0,Q.jsx)(we.I,{"aria-label":"resource search",prefix:Be||(Be=(0,Q.jsx)(ue.J,{name:"search"})),value:t,onChange:e=>{const r=e.currentTarget.value;s(r),o(r)},placeholder:"search for a resource","data-testid":P.queryEditor.resourcePicker.search.input})};var Je,Ke,Ze,Ye,er,rr,tr;const sr=e=>{let{resourcePickerData:r,resource:t,onApply:s,onCancel:o,selectableEntryTypes:i,queryType:n}=e;const u=(0,ne.wW)(Ie),[p,d]=(0,a.useState)(!1),[m,f]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[v,b]=(0,a.useState)(t),[y,w]=(0,a.useState)(void 0),[k,S]=(0,a.useState)(!1);(0,a.useEffect)((()=>{b(t)}),[t]);const j=(0,a.useCallback)((async()=>{if(!p){try{d(!0);const e=await r.fetchInitialRows(n,Fe(null!=v?v:{}));f(e)}catch(e){w(J(e))}d(!1)}}),[v,p,r,n]);(0,le.Z)((()=>{j()})),(0,a.useEffect)((()=>{v||g([]);const e=v&&We(m,function(e){return e?"string"==typeof e?e:Ee.buildResourceUri((0,c.J)(),e):""}(v));return g(e?[Object.assign({},e,{children:void 0})]:[])}),[v,m]);const z=(0,a.useCallback)((async e=>{var t;if(w(void 0),null===(t=e.children)||void 0===t||!t.length)try{const t=await r.fetchAndAppendNestedRow(m,e,n);f(t)}catch(e){throw w(J(e)),e}}),[r,m,n]),x="string"==typeof t,N=(0,a.useCallback)(((e,r)=>{b(r?x?e.uri:Fe(e.uri):x?"":{})}),[x]),A=(0,a.useCallback)((()=>{v&&s(x?v:Fe(v))}),[x,v,s]),M=(0,a.useCallback)((async e=>{if(w(void 0),S(!1),e){try{d(!0);const t=await r.search(e,n);f(t),t.length>=r.resultLimit&&S(!0)}catch(e){w(J(e))}d(!1)}else j()}),[j,r,n]);return(0,Q.jsxs)("div",{children:[(0,Q.jsx)(He,{searchFn:M}),k?(0,Q.jsxs)("p",{className:u.resultLimit,children:["Showing first ",r.resultLimit," results"]}):Je||(Je=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)("table",{className:u.table,children:(0,Q.jsx)("thead",{children:(0,Q.jsxs)("tr",{className:(0,ae.cx)(u.row,u.header),children:[(0,Q.jsx)("td",{className:u.cell,children:"Scope"}),(0,Q.jsx)("td",{className:u.cell,children:"Type"}),(0,Q.jsx)("td",{className:u.cell,children:"Location"})]})})}),(0,Q.jsx)("div",{className:u.tableScroller,children:(0,Q.jsx)("table",{className:u.table,children:(0,Q.jsxs)("tbody",{children:[p&&(0,Q.jsx)("tr",{className:(0,ae.cx)(u.row),children:(0,Q.jsx)("td",{className:u.cell,children:Ke||(Ke=(0,Q.jsx)(pe.u,{text:"Loading..."}))})}),!p&&0===m.length&&(0,Q.jsx)("tr",{className:(0,ae.cx)(u.row),children:(0,Q.jsx)("td",{className:u.cell,"aria-live":"polite",children:"No resources found"})}),!p&&m.map((e=>(0,Q.jsx)(Ue,{row:e,selectedRows:h,level:0,requestNestedRows:z,onRowSelectedChange:N,selectableEntryTypes:i,scrollIntoView:!0},e.uri)))]})})}),(0,Q.jsxs)("div",{className:u.selectionFooter,children:[h.length>0&&(0,Q.jsxs)(Q.Fragment,{children:[Ze||(Ze=(0,Q.jsx)("h5",{children:"Selection"})),(0,Q.jsx)("div",{className:u.tableScroller,children:(0,Q.jsx)("table",{className:u.table,children:(0,Q.jsx)("tbody",{children:h.map((e=>(0,Q.jsx)(Ue,{row:e,selectedRows:h,level:0,requestNestedRows:z,onRowSelectedChange:N,selectableEntryTypes:i},e.uri)))})})}),Ye||(Ye=(0,Q.jsx)(me,{v:2}))]}),(0,Q.jsx)(ke,{resource:v,onChange:e=>b(e)}),er||(er=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)(D.zx,{disabled:!!y,onClick:A,"data-testid":P.queryEditor.resourcePicker.apply.button,children:"Apply"}),rr||(rr=(0,Q.jsx)(me,{layout:"inline",h:1})),(0,Q.jsx)(D.zx,{onClick:o,variant:"secondary",children:"Cancel"})]}),y&&(0,Q.jsxs)(Q.Fragment,{children:[tr||(tr=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)(l.b,{severity:"error",title:"An error occurred while requesting resources from Azure Monitor",children:y})]})]})};var or,ir,ar;const nr=e=>{let{resource:r,datasource:t}=e;const[s,o]=(0,a.useState)(Fe(null!=r?r:""));return(0,a.useEffect)((()=>{r&&Fe(r)?"string"==typeof r?t.resourcePickerData.getResourceURIDisplayProperties(r).then(o):o(r):o({})}),[t.resourcePickerData,r]),!r||"object"==typeof r&&!r.subscription?(0,Q.jsx)(Q.Fragment,{children:"Select a resource"}):s?(0,Q.jsx)(cr,{resource:s}):(0,Q.jsx)(Q.Fragment,{children:r})},cr=e=>{let{resource:r}=e;const t=(0,ne.wW)(Ie);return r.resourceName?(0,Q.jsxs)("span",{className:(0,ae.cx)(t.truncated,t.resourceField),children:[or||(or=(0,Q.jsx)(ue.J,{name:"cube"}))," ",r.resourceName.split("/")[0]]}):r.resourceGroup?(0,Q.jsxs)("span",{children:[ir||(ir=(0,Q.jsx)(ue.J,{name:"folder"}))," ",r.resourceGroup]}):(0,Q.jsxs)("span",{children:[ar||(ar=(0,Q.jsx)(ue.J,{name:"layer-group"}))," ",r.subscription]})},ur=e=>{let{query:r,datasource:t,onQueryChange:s,selectableEntryTypes:o,queryType:i,resource:n,inlineField:c,labelWidth:u}=e;const l=(0,ne.wW)(Ie),[p,d]=(0,a.useState)(!1),m=(0,a.useCallback)((()=>{d(!0)}),[]),f=(0,a.useCallback)((()=>{d(!1)}),[]),h=(0,a.useCallback)((e=>{s(function(e,r){var t;return"string"==typeof r?Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resource:r})}):Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r||null===(t=r.metricNamespace)||void 0===t?void 0:t.toLocaleLowerCase(),resourceName:null==r?void 0:r.resourceName,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(r,e)),f()}),[f,s,r]);return(0,Q.jsxs)("span",{"data-testid":P.queryEditor.resourcePicker.select.button,children:[(0,Q.jsx)(ce.u,{className:l.modal,title:"Select a resource",isOpen:p,onDismiss:f,trapFocus:!1,children:(0,Q.jsx)(sr,{resourcePickerData:t.resourcePickerData,resource:n,onApply:h,onCancel:f,selectableEntryTypes:o,queryType:i})}),(0,Q.jsx)(ee,{label:"Resource",inlineField:c,labelWidth:u,children:(0,Q.jsx)(D.zx,{className:l.resourceFieldButton,variant:"secondary",onClick:m,type:"button",children:(0,Q.jsx)(nr,{resource:n,datasource:t})})})]})};function lr(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{query:r})})}const pr=[{label:"Time series",value:"time_series"},{label:"Table",value:"table"}],dr=e=>{var r;let{query:t,variableOptionGroup:s,onQueryChange:o}=e;const i=(0,a.useMemo)((()=>[...pr,s]),[s]),n=(0,a.useCallback)((e=>{const{value:r}=e;if(!r)return;const s=function(e,r){return Object.assign({},e,{azureLogAnalytics:Object.assign({},e.azureLogAnalytics,{resultFormat:r})})}(t,r);o(s)}),[o,t]);return(0,Q.jsx)(ee,{label:"Format as","data-testid":P.queryEditor.logsQueryEditor.formatSelection.input,children:(0,Q.jsx)(q.Ph,{inputId:"azure-monitor-logs-workspaces-field",value:null===(r=t.azureLogAnalytics)||void 0===r?void 0:r.resultFormat,onChange:n,options:i,width:38})})};function mr(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class fr{constructor(){mr(this,"resolve",void 0),mr(this,"reject",void 0),mr(this,"promise",void 0),this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,r)=>{this.resolve=e,this.reject=r})),Object.freeze(this)}}const hr=e=>{var r,t,s;let{query:o,datasource:i,onQueryChange:n}=e;const c=(0,a.useRef)();(0,a.useEffect)((()=>{var e;if(null===(e=o.azureLogAnalytics)||void 0===e||!e.resource)return;const r=[i.azureLogAnalyticsDatasource.getKustoSchema(o.azureLogAnalytics.resource),(c.current||(c.current=new fr),c.current.promise)];Promise.all(r).then((e=>{let[r,{monaco:t,editor:s}]=e;t.languages.kusto.getKustoWorker().then((e=>{const r=s.getModel();return r&&e(r.uri)})).then((e=>{null==e||e.setSchema(r,"https://help.kusto.windows.net","Samples")}))}))}),[i.azureLogAnalyticsDatasource,null===(r=o.azureLogAnalytics)||void 0===r?void 0:r.resource]);const u=(0,a.useCallback)(((e,r)=>{var t,s;null===(t=c.current)||void 0===t||null===(s=t.resolve)||void 0===s||s.call(t,{editor:e,monaco:r})}),[]),l=(0,a.useCallback)((e=>{n(lr(o,e))}),[n,o]);return(0,Q.jsx)(H.p,{value:null!==(t=null===(s=o.azureLogAnalytics)||void 0===s?void 0:s.query)&&void 0!==t?t:"",language:"kusto",height:200,width:"100%",showMiniMap:!1,onBlur:l,onSave:l,onEditorDidMount:u})};function gr(e,r,t){const[s,o]=(0,a.useState)();return(0,a.useEffect)((()=>{(async function(e,r,t){var s;if(void 0!==(null===(s=r.azureLogAnalytics)||void 0===s?void 0:s.workspace)&&!r.azureLogAnalytics.resource){let s;s=Ve(r.azureLogAnalytics.workspace)?await e.resourcePickerData.getResourceURIFromWorkspace(r.azureLogAnalytics.workspace):r.azureLogAnalytics.workspace;const o=Object.assign({},r,{azureLogAnalytics:Object.assign({},r.azureLogAnalytics,{resource:s,workspace:void 0})});delete o.azureLogAnalytics.workspace,t(o)}})(e,r,t).catch((e=>o({title:"Unable to migrate workspace as a resource",message:e.message})))}),[e,r,t]),s}const vr=e=>{var r,t;let{query:s,datasource:o,subscriptionId:i,variableOptionGroup:a,onChange:n,setError:c,hideFormatAs:u}=e;const p=gr(o,s,n);return(0,Q.jsx)("span",{"data-testid":"azure-monitor-logs-query-editor-with-experimental-ui",children:(0,Q.jsxs)(Z.EditorRows,{children:[(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsx)(Z.EditorFieldGroup,{children:(0,Q.jsx)(ur,{query:s,datasource:o,inlineField:!0,labelWidth:10,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c,selectableEntryTypes:[xe.Subscription,xe.ResourceGroup,xe.Resource,xe.Variable],resource:null!==(r=null===(t=s.azureLogAnalytics)||void 0===t?void 0:t.resource)&&void 0!==r?r:"",queryType:"logs"})})}),(0,Q.jsx)(hr,{query:s,datasource:o,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c}),(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsxs)(Z.EditorFieldGroup,{children:[!u&&(0,Q.jsx)(dr,{query:s,datasource:o,subscriptionId:i,variableOptionGroup:a,onQueryChange:n,setError:c}),p&&(0,Q.jsx)(l.b,{title:p.title,children:p.message})]})})]})})};function br(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.customNamespace)===r?e:null!=r&&r.toLowerCase().startsWith("microsoft.storage/storageaccounts/")?Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:r,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})}):Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{customNamespace:r,metricName:void 0,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}function yr(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.timeGrain)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{timeGrain:r})})}function wr(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{dimensionFilters:r})})}const kr=e=>{var r,t;let{query:s,variableOptionGroup:o,onQueryChange:i,aggregationOptions:n,isLoading:c}=e;const u=(0,a.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.aggregation)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r})})}(s,e.value);i(r)}),[i,s]),l=b(n,o,null===(r=s.azureMonitor)||void 0===r?void 0:r.aggregation);return(0,Q.jsx)(ee,{label:"Aggregation",children:(0,Q.jsx)(q.Ph,{inputId:"azure-monitor-metrics-aggregation-field",value:(null===(t=s.azureMonitor)||void 0===t?void 0:t.aggregation)||null,onChange:u,options:l,isLoading:c})})};var Sr=t(54761);const jr=e=>{var r;let{data:t,query:s,dimensionOptions:o,onQueryChange:i}=e;const n=(0,a.useMemo)((()=>{var e,r;return null!==(e=null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters)&&void 0!==e?e:[]}),[null===(r=s.azureMonitor)||void 0===r?void 0:r.dimensionFilters]),c=((e,r)=>{const[t,s]=(0,a.useState)({});return(0,a.useEffect)((()=>{var t;let o={};if(null!=e&&null!==(t=e.series)&&void 0!==t&&t.length){const t=e.series.flat().filter((e=>e.refId===r.refId)).flatMap((e=>e.fields)).map((e=>e.labels)).flat().filter((e=>null!=e));for(const e of t)for(const[r,t]of Object.entries(e))o[r]?o[r].add(t):o[r]=new Set([t])}s((e=>{const r={},t=Object.keys(o);if(0===t.length)return e;for(const s of t)e[s]&&o[s].size<e[s].size?r[s]=e[s]:r[s]=o[s];return r}))}),[null==e?void 0:e.series,r.refId]),t})(t,s),u=[{label:"==",value:"eq"},{label:"!=",value:"ne"},{label:"starts with",value:"sw"}],l=(0,a.useMemo)((()=>{let e=o;return n.length&&(e=o.filter((e=>!n.some((r=>r.dimension===e.value))))),e}),[n,o]),p=(e,r,t,s)=>{r[e]=t,s(r)},d=(e,r)=>{var t;const s=Array.from(null!==(t=c[r.toLowerCase()])&&void 0!==t?t:[]);return s.find((r=>r===e))?s.map((e=>({value:e,label:e}))):[...s,...e&&"*"!==e?[e]:[]].map((e=>({value:e,label:e})))},m=(e,r)=>{const t=d(void 0,r);if(e)for(const r of e)t.find((e=>e.value===r))||t.push({value:r,label:r});return t};return(0,Q.jsx)(ee,{label:"Dimensions",children:(0,Q.jsx)(Z.EditorList,{items:n,onChange:e=>{const r=e.map((e=>{var r,t,s;return{dimension:null!==(r=e.dimension)&&void 0!==r?r:"",operator:null!==(t=e.operator)&&void 0!==t?t:"eq",filters:null!==(s=e.filters)&&void 0!==s?s:[]}}));i(wr(s,r))},renderItem:(e,r,t)=>{var s,i,a,n;return(0,Q.jsxs)(Sr.Lh,{spacing:"none",children:[(0,Q.jsx)(q.Ph,{menuShouldPortal:!0,placeholder:"Field",value:e.dimension,options:(n=e.dimension||"",l.concat(o.filter((e=>e.value===n)))),onChange:t=>{var s;return p("dimension",e,null!==(s=t.value)&&void 0!==s?s:"",r)}}),(0,Q.jsx)(q.Ph,{menuShouldPortal:!0,placeholder:"Operation",value:e.operator,options:(a=e.operator||"eq",u.find((e=>e.value===a))?u:[...u,...a?[{label:a,value:a}]:[]]),onChange:t=>{var s;return p("operator",e,null!==(s=t.value)&&void 0!==s?s:"",r)},allowCustomValue:!0}),"eq"===e.operator||"ne"===e.operator?(0,Q.jsx)(q.NU,{menuShouldPortal:!0,placeholder:"Select value(s)",value:e.filters,options:m(e.filters,null!==(s=e.dimension)&&void 0!==s?s:""),onChange:t=>p("filters",e,t.map((e=>{var r;return null!==(r=e.value)&&void 0!==r?r:""})),r),"aria-label":"dimension-labels-select",allowCustomValue:!0}):(0,Q.jsx)(q.Ph,{menuShouldPortal:!0,placeholder:"Select value",value:e.filters?e.filters[0]:"",allowCustomValue:!0,options:d(e.filters?e.filters[0]:"",null!==(i=e.dimension)&&void 0!==i?i:""),onChange:t=>{var s;return p("filters",e,[null!==(s=null==t?void 0:t.value)&&void 0!==s?s:""],r)},isClearable:!0}),(0,Q.jsx)(Z.AccessoryButton,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:t,type:"button"})]})}})})},zr=e=>{var r,t;let{onQueryChange:s,query:o}=e;const[i,n]=(0,a.useState)(null!==(r=null===(t=o.azureMonitor)||void 0===t?void 0:t.alias)&&void 0!==r?r:""),c=(0,a.useCallback)((e=>{e.target instanceof HTMLInputElement&&n(e.target.value)}),[]),u=(0,a.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.alias)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{alias:r})})}(o,i);s(e)}),[s,o,i]);return(0,Q.jsx)(ee,{label:"Legend format",children:(0,Q.jsx)(we.I,{id:"azure-monitor-metrics-legend-field",placeholder:"Alias patterns",value:i,onChange:c,onBlur:u,width:38})})},xr=e=>{var r,t,s;let{metricNames:o,query:i,variableOptionGroup:n,onQueryChange:c}=e;const u=(0,a.useCallback)((e=>{if(!e.value)return;const r=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.metricName)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricName:r,aggregation:void 0,timeGrain:"",dimensionFilters:[]})})}(i,e.value);c(r)}),[c,i]),l=b(o,n,null===(r=i.azureMonitor)||void 0===r?void 0:r.metricName);return(0,Q.jsx)(ee,{label:"Metric","data-testid":P.queryEditor.metricsQueryEditor.metricName.input,children:(0,Q.jsx)(q.Ph,{inputId:"azure-monitor-metrics-metric-field",value:null!==(t=null===(s=i.azureMonitor)||void 0===s?void 0:s.metricName)&&void 0!==t?t:null,onChange:u,options:l,allowCustomValue:!0})})},Nr=e=>{var r,t;let{metricNamespaces:s,query:o,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,a.useCallback)((e=>{if(!e.value)return;const r=br(o,e.value);n(r)}),[n,o]),u=(null===(r=o.azureMonitor)||void 0===r?void 0:r.customNamespace)||(null===(t=o.azureMonitor)||void 0===t?void 0:t.metricNamespace),l=b(s,i,u);return(0,Q.jsx)(ee,{label:"Metric namespace",children:(0,Q.jsx)(q.Ph,{inputId:"azure-monitor-metrics-metric-namespace-field",value:u||null,onChange:c,options:l,allowCustomValue:!0})})},Ar=e=>{var r,t;let{query:s,timeGrainOptions:o,variableOptionGroup:i,onQueryChange:n}=e;const c=(0,a.useCallback)((e=>{if(!e.value)return;const r=yr(s,e.value);n(r)}),[n,s]),u=(0,a.useMemo)((()=>{var e;const r=f.findClosestTimeGrain("1m",o.map((e=>f.createKbnUnitFromISO8601Duration(e.value)))||["1m","5m","15m","30m","1h","6h","12h","1d"]),t=o.map((e=>"auto"===e.value?Object.assign({},e,{description:r}):e));return b(t,i,null===(e=s.azureMonitor)||void 0===e?void 0:e.timeGrain)}),[o,i,null===(r=s.azureMonitor)||void 0===r?void 0:r.timeGrain]);return(0,Q.jsx)(ee,{label:"Time grain",children:(0,Q.jsx)(q.Ph,{inputId:"azure-monitor-metrics-time-grain-field",value:null===(t=s.azureMonitor)||void 0===t?void 0:t.timeGrain,onChange:c,options:u})})},Mr=e=>{var r,t;let{onQueryChange:s,query:o}=e;const[i,n]=(0,a.useState)(null!==(r=null===(t=o.azureMonitor)||void 0===t?void 0:t.top)&&void 0!==r?r:""),c=(0,a.useCallback)((e=>{e.target instanceof HTMLInputElement&&n(e.target.value)}),[]),u=(0,a.useCallback)((()=>{const e=function(e,r){var t;return(null===(t=e.azureMonitor)||void 0===t?void 0:t.top)===r?e:Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{top:r})})}(o,i);s(e)}),[s,o,i]);return(0,Q.jsx)(ee,{label:"Top",children:(0,Q.jsx)(we.I,{id:"azure-monitor-metrics-top-field",value:i,onChange:c,onBlur:u,width:16})})};function Cr(e,r,t){const[s]=(0,a.useState)((()=>Math.random())),[o,i]=(0,a.useState)(),n=(0,a.useMemo)((()=>null!=o?o:[]),[o]);return(0,a.useEffect)((()=>{e().then((e=>{i(e),r(s,void 0)})).catch((e=>{r(s,e)}))}),t),n}const Gr={aggOptions:[],timeGrains:[],dimensions:[],isLoading:!1,supportedAggTypes:[],primaryAggType:void 0};function Ir(e,r){const t=e.map(v);return r&&!t.find((e=>e.value===r.toLowerCase()))&&t.push({label:r,value:r}),t}const Rr=e=>{var r,t,s,o,i,n;let{data:c,query:u,datasource:l,variableOptionGroup:p,onChange:d,setError:h}=e;const g=((e,r,t)=>{var s;const[o,i]=(0,a.useState)(Gr),{subscription:n}=e,{resourceGroup:c,resourceName:u,metricNamespace:l,metricName:p,aggregation:d,timeGrain:h,customNamespace:g}=null!==(s=e.azureMonitor)&&void 0!==s?s:{};return(0,a.useEffect)((()=>{n&&c&&u&&l&&p?r.azureMonitorDatasource.getMetricMetadata({subscription:n,resourceGroup:c,resourceName:u,metricNamespace:l,metricName:p,customNamespace:g}).then((e=>{var r;const t=(e.supportedAggTypes||[e.primaryAggType]).map((e=>({label:e,value:e})));i({aggOptions:t,timeGrains:e.supportedTimeGrains,dimensions:e.dimensions,isLoading:!1,supportedAggTypes:null!==(r=e.supportedAggTypes)&&void 0!==r?r:[],primaryAggType:e.primaryAggType})})):i(Gr)}),[r,n,c,u,l,p,g]),(0,a.useEffect)((()=>{const r=d||o.primaryAggType,s=h||"auto";r===d&&s===h||t(Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{aggregation:r,timeGrain:s,allowedTimeGrainsMs:o.timeGrains.filter((e=>"auto"!==e.value)).map((e=>m.intervalToMs(f.createKbnUnitFromISO8601Duration(e.value))))})}))}),[t,o,d,h,e]),o})(u,l,d),v=((e,r,t,s)=>{var o;const{subscription:i}=e,{metricNamespace:a,resourceGroup:n,resourceName:c}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return Cr((async()=>{if(!i||!n||!c)return;const s=Ir(await r.azureMonitorDatasource.getMetricNamespaces({subscription:i,metricNamespace:a,resourceGroup:n,resourceName:c},!1),a);return!a&&s.length&&t(br(e,s[0].value)),s}),s,[i,a,n,c])})(u,l,d,h),b=((e,r,t,s)=>{var o;const{subscription:i}=e,{metricNamespace:a,metricName:n,resourceGroup:c,resourceName:u,customNamespace:l}=null!==(o=e.azureMonitor)&&void 0!==o?o:{};return Cr((async()=>{if(i&&a&&c&&u)return Ir(await r.azureMonitorDatasource.getMetricNames({subscription:i,resourceGroup:c,resourceName:u,metricNamespace:a,customNamespace:l}),n)}),s,[i,c,u,a,l])})(u,l,0,h),y={subscription:u.subscription,resourceGroup:null===(r=u.azureMonitor)||void 0===r?void 0:r.resourceGroup,metricNamespace:null===(t=u.azureMonitor)||void 0===t?void 0:t.metricNamespace,resourceName:null===(s=u.azureMonitor)||void 0===s?void 0:s.resourceName};return(0,Q.jsx)("span",{"data-testid":"azure-monitor-metrics-query-editor-with-experimental-ui",children:(0,Q.jsxs)(Z.EditorRows,{children:[(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsxs)(Z.EditorFieldGroup,{children:[(0,Q.jsx)(ur,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h,selectableEntryTypes:[xe.Resource],resource:y,queryType:"metrics"}),(0,Q.jsx)(Nr,{metricNamespaces:v,query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h}),(0,Q.jsx)(xr,{metricNames:b,query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h}),(0,Q.jsx)(kr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h,aggregationOptions:null!==(o=null==g?void 0:g.aggOptions)&&void 0!==o?o:[],isLoading:g.isLoading}),(0,Q.jsx)(Ar,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h,timeGrainOptions:null!==(i=null==g?void 0:g.timeGrains)&&void 0!==i?i:[]})]})}),(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsx)(Z.EditorFieldGroup,{children:(0,Q.jsx)(jr,{data:c,query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h,dimensionOptions:null!==(n=null==g?void 0:g.dimensions)&&void 0!==n?n:[]})})}),(0,Q.jsx)(Z.EditorRow,{children:(0,Q.jsxs)(Z.EditorFieldGroup,{children:[(0,Q.jsx)(Mr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h}),(0,Q.jsx)(zr,{query:u,datasource:l,variableOptionGroup:p,onQueryChange:d,setError:h})]})})]})})},Tr=e=>{let{query:r,onQueryChange:t}=e;const s=[{value:z.AzureMonitor,label:"Metrics"},{value:z.LogAnalytics,label:"Logs"},{value:z.AzureResourceGraph,label:"Azure Resource Graph"}],o=(0,a.useCallback)((e=>{e.value&&t(Object.assign({},r,{queryType:e.value}))}),[t,r]);return(0,Q.jsx)("span",{"data-testid":P.queryEditor.header.select,children:(0,Q.jsx)(Z.EditorHeader,{children:(0,Q.jsx)(Z.InlineSelect,{label:"Service",value:r.queryType,placeholder:"Service...",allowCustomValue:!0,options:s,onChange:o})})})};var qr=t(10322),Or=t.n(qr);const Dr="select";function Pr(e){let r=e;return r.queryType||(r=Object.assign({},r,{queryType:z.AzureMonitor})),r=function(e){var r,t,s,o;let i=e;null!==(r=i.azureLogAnalytics)&&void 0!==r&&null!==(t=r.query)&&void 0!==t&&t.match(/\$__from\s/gi)&&(i=lr(i,i.azureLogAnalytics.query.replace(/\$__from\s/gi,"$__timeFrom() ")));null!==(s=i.azureLogAnalytics)&&void 0!==s&&null!==(o=s.query)&&void 0!==o&&o.match(/\$__to\s/gi)&&(i=lr(i,i.azureLogAnalytics.query.replace(/\$__to\s/gi,"$__timeTo() ")));return i}(r),r.queryType===z.AzureMonitor&&r.azureMonitor&&(r=function(e){var r;let t=e;if(null!==(r=t.azureMonitor)&&void 0!==r&&r.timeGrainUnit&&"auto"!==t.azureMonitor.timeGrain){var s,o;t=yr(t,f.createISO8601Duration(null!==(s=t.azureMonitor.timeGrain)&&void 0!==s?s:"auto",t.azureMonitor.timeGrainUnit)),null===(o=t.azureMonitor)||void 0===o||delete o.timeGrainUnit}return t}(r),r=function(e){var r,t;if((!(null===(r=e.azureMonitor)||void 0===r?void 0:r.metricNamespace)||e.azureMonitor.metricNamespace===Dr)&&null!==(t=e.azureMonitor)&&void 0!==t&&t.metricDefinition)return Object.assign({},e,{azureMonitor:Object.assign({},e.azureMonitor,{metricNamespace:e.azureMonitor.metricDefinition,metricDefinition:void 0})});return e}(r),r=function(e){var r,t,s;let o=e;const i=null===(r=o.azureMonitor)||void 0===r?void 0:r.dimension;var a;i&&"None"!==i&&(o=function(e){var r,t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"eq",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=null!==(r=null===(t=e.azureMonitor)||void 0===t?void 0:t.dimensionFilters)&&void 0!==r?r:[];return wr(e,[...a,{dimension:s,operator:o,filters:i}])}(o,i,"eq",[(null===(a=o.azureMonitor)||void 0===a?void 0:a.dimensionFilter)||""]));return null===(t=o.azureMonitor)||void 0===t||delete t.dimension,null===(s=o.azureMonitor)||void 0===s||delete s.dimensionFilter,o}(r),r=function(e){const r=e.azureMonitor;if(!r)return e;const t=[],s=r.dimensionFilters;if(s&&s.length>0&&(s.forEach((e=>{const r={dimension:e.dimension,operator:e.operator};if(!e.filters&&e.filter)t.push(Object.assign({},r,{filters:[e.filter]}));else{let s=!1;if(e.filters&&e.filter){for(const r of e.filters)if(e.filter===r){s=!0;break}s||"*"===e.filter||e.filters.push(e.filter),t.push(Object.assign({},r,{filters:e.filters}))}}})),t.length>0))return Object.assign({},e,{azureMonitor:Object.assign({},r,{dimensionFilters:t})});return e}(r),r=function(e){var r;if(null!==(r=e.azureMonitor)&&void 0!==r&&r.resourceUri&&!e.azureMonitor.resourceUri.startsWith("$")){const r=Fe(e.azureMonitor.resourceUri),t=(null==r?void 0:r.subscription)&&(null==r?void 0:r.resourceGroup)&&(null==r?void 0:r.resourceName);return Object.assign({},e,{subscription:null==r?void 0:r.subscription,azureMonitor:Object.assign({},e.azureMonitor,{resourceGroup:null==r?void 0:r.resourceGroup,metricNamespace:null==r?void 0:r.metricNamespace,resourceName:null==r?void 0:r.resourceName,resourceUri:t?void 0:e.azureMonitor.resourceUri})})}return e}(r)),r}const Er={queryType:z.AzureMonitor},Lr=(e,r)=>{const t=(0,a.useMemo)((()=>(e=>{const r=Pr((0,p.defaults)({},e,Er));return Or()(r,e)?e:r})(e)),[e]);return(0,a.useEffect)((()=>{t!==e&&r(t)}),[t,e,r]),t};var Qr,Fr;const Vr=e=>{let{data:r,subscriptionId:t,query:s,datasource:o,variableOptionGroup:i,onChange:a,setError:n}=e;switch(s.queryType){case z.AzureMonitor:return(0,Q.jsx)(Rr,{data:r,query:s,datasource:o,onChange:a,variableOptionGroup:i,setError:n});case z.LogAnalytics:return(0,Q.jsx)(vr,{subscriptionId:t,query:s,datasource:o,onChange:a,variableOptionGroup:i,setError:n});case z.AzureResourceGraph:return(0,Q.jsx)(ie,{subscriptionId:t,query:s,datasource:o,onChange:a,variableOptionGroup:i,setError:n});default:const e=s.queryType;return(0,Q.jsx)(l.b,{title:"Unknown query type",children:("Application Insights"===e||"Insights Analytics"===e)&&(0,Q.jsxs)(Q.Fragment,{children:[e," was deprecated in Grafana 9. See the"," ",Fr||(Fr=(0,Q.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/datasources/azuremonitor/deprecated-application-insights/",target:"_blank",rel:"noreferrer",children:"deprecation notice"}))," ","to get more information about how to migrate your queries. This is the current query definition:",(0,Q.jsx)(H.p,{height:"200px",readOnly:!0,language:"json",value:JSON.stringify(s,null,4)})]})})}},$r=e=>{let{query:r,datasource:t,onChange:s,onRunQuery:o,data:i}=e;const[n,c]=K(),u=(0,a.useMemo)((()=>(0,p.debounce)(o,500)),[o]),d=(0,a.useCallback)((e=>{s(e),u()}),[s,u]),m=Lr(r,d),f=m.subscription||t.azureMonitorDatasource.defaultSubscriptionId,h={label:"Template Variables",options:t.getVariables().map((e=>({label:e,value:e})))};return(0,Q.jsxs)("div",{"data-testid":"azure-monitor-query-editor",children:[(0,Q.jsx)(Tr,{query:m,onQueryChange:d}),(0,Q.jsx)(Vr,{data:i,subscriptionId:f,query:m,datasource:t,onChange:d,variableOptionGroup:h,setError:c}),n&&(0,Q.jsxs)(Q.Fragment,{children:[Qr||(Qr=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:n})]})]})};var Wr=t(74687),Xr=t(53786),_r=t(2101),Ur=t(28173),Br=t(18474),Hr=t(79328),Jr=t(85526),Kr=t(98356),Zr=t(88246);class Yr{constructor(e,r,t){this.rawQueryString=e,this.options=r,this.defaultTimeField=t}generate(){let e=this.rawQueryString;const r=/\$__([_a-zA-Z0-9]+)\(([^()]*)\)/gi;e=e.replace(r,((e,r,t)=>"contains"===r?this.getMultiContains(t):e)),e=e.replace(/\$__escapeMulti\(('[^]*')\)/gi,((e,r)=>this.escape(r))),this.options&&(e=e.replace(r,((e,r,t)=>"timeFilter"===r?this.getTimeFilter(t,this.options):"timeFrom"===r?this.getFrom(this.options):"timeTo"===r?this.getUntil(this.options):e)),e=e.replace(/\$__interval/gi,this.options.interval));const t=e;e=encodeURIComponent(e);return{uriString:`query=${e}`,rawQuery:t}}getFrom(e){const r=e.range.from;return`datetime(${(0,Zr.CQ)(r).startOf("minute").toISOString()})`}getUntil(e){var r;if("now"===(null===(r=e.rangeRaw)||void 0===r?void 0:r.to)){const e=Date.now();return`datetime(${(0,Zr.CQ)(e).startOf("minute").toISOString()})`}{const r=e.range.to;return`datetime(${(0,Zr.CQ)(r).startOf("minute").toISOString()})`}}getTimeFilter(e,r){var t;const s=e||this.defaultTimeField;return"now"===(null===(t=r.rangeRaw)||void 0===t?void 0:t.to)?`${s} >= ${this.getFrom(r)}`:`${s}  >= ${this.getFrom(r)} and ${s} <= ${this.getUntil(r)}`}getMultiContains(e){const r=e.indexOf(","),t=e.substring(0,r),s=e.substring(e.indexOf(",")+1);return s&&"all"===s.toLowerCase().trim()?"1 == 1":`${t.trim()} in (${s.trim()})`}escape(e){return e.substring(1,e.length-1).split("','").map((e=>`@'${e}'`)).join(", ")}}class et{constructor(e){this.results=e}parseQueryResult(){let e=[],r=[];for(let t=0;t<this.results.length;t++){if(0===this.results[t].result.tables.length)continue;r=this.results[t].result.tables[0].columns;const s=this.results[t].result.tables[0].rows;e="time_series"===this.results[t].query.resultFormat?(0,p.concat)(e,this.parseTimeSeriesResult(this.results[t].query,r,s)):(0,p.concat)(e,this.parseTableResult(this.results[t].query,r,s))}return e}parseTimeSeriesResult(e,r,t){const s=[];let o=-1,i=-1,a=-1;for(let e=0;e<r.length;e++)-1===o&&"datetime"===r[e].type&&(o=e),-1===i&&"string"===r[e].type&&(i=e),-1===a&&["int","long","real","double"].indexOf(r[e].type)>-1&&(a=e);if(-1===o)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");return(0,p.forEach)(t,(t=>{const n=et.dateTimeToEpoch(t[o]),c=i>-1?t[i]:r[a].name,u=et.findOrCreateBucket(s,c);u.datapoints.push([t[a],n]),u.refId=e.refId,u.meta={executedQueryString:e.query}})),s}parseTableResult(e,r,t){return{type:"table",columns:(0,p.map)(r,(e=>({text:e.name,type:e.type}))),rows:t,refId:e.refId,meta:{executedQueryString:e.query}}}parseToVariables(){const e=this.parseQueryResult(),r=[];return(0,p.forEach)(e,(e=>{(0,p.forEach)((0,p.flattenDeep)(e.rows),(e=>{r.push({text:e,value:e})}))})),r}transformToAnnotations(e){const r=this.parseQueryResult(),t=[];return(0,p.forEach)(r,(r=>{let s=-1,o=-1,i=-1;for(let e=0;e<r.columns.length;e++)-1===s&&"datetime"===r.columns[e].type&&(s=e),-1===o&&"text"===r.columns[e].text.toLowerCase()&&(o=e),-1===i&&"tags"===r.columns[e].text.toLowerCase()&&(i=e);(0,p.forEach)(r.rows,(r=>{t.push({annotation:e.annotation,time:Math.floor(et.dateTimeToEpoch(r[s])),text:r[o]?r[o].toString():"",tags:r[i]?r[i].trim().split(/\s*,\s*/):[]})}))})),t}static findOrCreateBucket(e,r){let t=(0,p.find)(e,["target",r]);return t||(t={target:r,datapoints:[],refId:"",query:""},e.push(t)),t}static dateTimeToEpoch(e){return(0,Zr.CQ)(e).valueOf()}static parseSubscriptions(e){const r=[];if(!e)return r;const t="subscriptionId";for(let s=0;s<e.value.length;s++)(0,p.find)(r,["value",(0,p.get)(e.value[s],t)])||r.push({text:`${(0,p.get)(e.value[s],"displayName")}`,value:(0,p.get)(e.value[s],t)});return r}}const rt=/([\w\W]+):([\w]+)(?:\s?=\s?([\w\W]+))?/;function tt(e){return e.functions?e.functions.map((e=>{const r=e.parameters&&e.parameters.split(", ").map((e=>{const r=e.match(rt);if(!r)return;const[,t,s,o]=r;return{name:t,type:s,defaultValue:o,cslDefaultValue:o}})).filter((e=>!!e));return{name:e.name,body:e.body,inputParameters:r||[]}})):[]}function st(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class ot extends Br.CK{constructor(e){super(e),st(this,"resourcePath",void 0),st(this,"azurePortalUrl",void 0),st(this,"defaultSubscriptionId",void 0),st(this,"azureMonitorPath",void 0),st(this,"firstWorkspace",void 0),st(this,"cache",void 0),this.instanceSettings=e,this.cache=new Map,this.resourcePath=`${w}`,this.azureMonitorPath=`${y}/subscriptions`;const r=G(e);this.azurePortalUrl=C(r),this.defaultSubscriptionId=this.instanceSettings.jsonData.subscriptionId||""}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r;return!(!0===e.hide||null===(r=e.azureLogAnalytics)||void 0===r||!r.query||!e.azureLogAnalytics.resource&&!e.azureLogAnalytics.workspace)}async getSubscriptions(){if(!this.isConfigured())return[];const e=`${this.azureMonitorPath}?api-version=2019-03-01`;return await this.getResource(e).then((e=>et.parseSubscriptions(e)))}async getWorkspaces(e){const r=await this.getWorkspaceList(e);return(0,p.map)(r.value,(e=>({text:e.name,value:e.id})))||[]}getWorkspaceList(e){const r=(0,c.J)().replace(e||this.defaultSubscriptionId),t=this.azureMonitorPath+`/${r}/providers/Microsoft.OperationalInsights/workspaces?api-version=2017-04-26-preview`;return this.getResource(t)}async getMetadata(e){const r=`${this.resourcePath}/v1${e}/metadata`;return await this.getResource(r)}async getKustoSchema(e){const r=(0,c.J)(),t=r.replace(e,{},S);return function(e,r,t){const s={name:r,tables:e.tables,functions:tt(e),majorVersion:0,minorVersion:0};return s.functions.push({name:"$__timeFilter",body:"{ true }",inputParameters:[{name:"timeColumn",type:"System.String",defaultValue:'""',cslDefaultValue:'""'}]},{name:"$__timeFrom",body:"{ datetime(2018-06-05T18:09:58.907Z) }",inputParameters:[]},{name:"$__timeTo",body:"{ datetime(2018-06-05T20:09:58.907Z) }",inputParameters:[]},{name:"$__escapeMulti",body:"{ @'\\grafana-vmNetwork(eth0)Total', @'\\hello!'}",inputParameters:[{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]},{name:"$__contains",body:"{ colName in ('value1','value2') }",inputParameters:[{name:"colName",type:"System.String",defaultValue:"colName",cslDefaultValue:"colName"},{name:"$myVar",type:"System.String",defaultValue:"$myVar",cslDefaultValue:"$myVar"}]}),{clusterType:"Engine",cluster:{connectionString:r,databases:[s]},database:s,globalParameters:t.map((e=>({name:`$${e.name}`,type:"dynamic"})))}}(await this.getMetadata(t),t,r.getVariables())}applyTemplateVariables(e,r){const t=e.azureLogAnalytics;if(!t)return e;const s=(0,c.J)(),o=s.replace(t.resource,r);let i=s.replace(t.workspace,r);i||o||!this.firstWorkspace||(i=this.firstWorkspace);const a=s.replace(t.query,r,S);return Object.assign({},e,{queryType:z.LogAnalytics,azureLogAnalytics:{resultFormat:t.resultFormat,query:a,resource:o,workspace:i}})}query(e){return super.query(e).pipe((0,Kr.z)((e=>(0,Jr.D)(this.processResponse(e)))))}async processResponse(e){if(e.data)for(const s of e.data){var r,t;const e=null===(r=s.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.encodedQuery;if(e&&e.length>0){const e=await this.buildDeepLink(s.meta.custom);if(null!=e&&e.length)for(const r of s.fields)r.config.links=[{url:e,title:"View in Azure Portal",targetBlank:!0}]}}return e}async buildDeepLink(e){const r=encodeURIComponent(e.encodedQuery),t=encodeURIComponent(e.resource);return`${this.azurePortalUrl}/#blade/Microsoft_OperationsManagementSuite_Workspace/AnalyticsBlade/initiator/AnalyticsShareLinkToQuery/isQueryEditorVisible/true/scope/%7B%22resources%22%3A%5B%7B%22resourceId%22%3A%22${t}%22%7D%5D%7D/query/${r}/isQueryBase64Compressed/true/timespanInIsoFormat/P1D`}async getWorkspaceDetails(e){if(!this.defaultSubscriptionId)return{};const r=(await this.getWorkspaceList(this.defaultSubscriptionId)).value.find((r=>r.properties.customerId===e));if(!r)return{};const t=/.*resourcegroups\/(.*)\/providers.*/.exec(r.id);return!t||t.length<2?{}:{workspace:r.name,resourceGroup:t[1]}}getDeprecatedDefaultWorkSpace(){return this.instanceSettings.jsonData.logAnalyticsDefaultWorkspace}buildQuery(e,r,t){const s=new Yr((0,c.J)().replace(e,{},S),r,"TimeGenerated").generate().uriString,o=Ve(t)?`${this.resourcePath}/v1/workspaces/${t}/query?${s}`:`${this.resourcePath}/v1${t}/query?${s}`;return[{datasource:this.getRef(),path:o,resultFormat:"table"}]}async getDefaultOrFirstSubscription(){var e;if(this.defaultSubscriptionId)return this.defaultSubscriptionId;return null===(e=(await this.getSubscriptions())[0])||void 0===e?void 0:e.value}async getFirstWorkspace(){var e;if(this.firstWorkspace)return this.firstWorkspace;const r=await this.getDefaultOrFirstSubscription();if(!r)return;const t=null===(e=(await this.getWorkspaces(r))[0])||void 0===e?void 0:e.value;return t&&(this.firstWorkspace=t),t}annotationQuery(e){if(!e.annotation.rawQuery)return Promise.reject({message:"Query missing in annotation definition"});const r=this.buildQuery(e.annotation.rawQuery,e,e.annotation.workspace),t=this.doQueries(r);return Promise.all(t).then((r=>new et(r).transformToAnnotations(e)))}doQueries(e){return(0,p.map)(e,(e=>this.getResource(e.path).then((r=>({result:r,query:e}))).catch((r=>{throw{error:r,query:e}}))))}validateDatasource(){if("clientsecret"===A(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}}var it=t(53091);function at(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function nt(e){return!(!e||"select"===e)}class ct extends Br.CK{constructor(e){super(e),at(this,"apiVersion","2018-01-01"),at(this,"apiPreviewVersion","2017-12-01-preview"),at(this,"listByResourceGroupApiVersion","2021-04-01"),at(this,"providerApiVersion","2021-04-01"),at(this,"locationsApiVersion","2020-01-01"),at(this,"defaultSubscriptionId",void 0),at(this,"resourcePath",void 0),at(this,"azurePortalUrl",void 0),at(this,"timeSrv",void 0),at(this,"templateSrv",void 0),this.instanceSettings=e,this.timeSrv=(0,it.$t)(),this.templateSrv=(0,c.J)(),this.defaultSubscriptionId=e.jsonData.subscriptionId;const r=G(e);this.resourcePath=y,this.azurePortalUrl=C(r)}isConfigured(){return!this.validateDatasource()}filterQuery(e){var r,t,s,o,i,a,n;const c=nt(null==e||null===(r=e.azureMonitor)||void 0===r?void 0:r.resourceGroup)&&nt(null==e||null===(t=e.azureMonitor)||void 0===t?void 0:t.resourceName)&&nt((null==e||null===(s=e.azureMonitor)||void 0===s?void 0:s.metricDefinition)||(null==e||null===(o=e.azureMonitor)||void 0===o?void 0:o.metricNamespace)),u=nt(null===(i=e.azureMonitor)||void 0===i?void 0:i.resourceUri);return!(!0===e.hide||!c&&!u||!nt(null==e||null===(a=e.azureMonitor)||void 0===a?void 0:a.metricName)||!nt(null==e||null===(n=e.azureMonitor)||void 0===n?void 0:n.aggregation))}applyTemplateVariables(e,r){var t;const s=e.azureMonitor;if(!s)throw new Error("Query is not a valid Azure Monitor Metrics query");s.timeGrain&&s.timeGrainUnit&&"auto"!==s.timeGrain&&(s.timeGrain=f.createISO8601Duration(s.timeGrain,s.timeGrainUnit));const o=(0,c.J)(),i=o.replace(e.subscription||this.defaultSubscriptionId,r),a=o.replace(s.resourceGroup,r),n=o.replace(s.resourceName,r),u=o.replace(s.metricNamespace,r),l=o.replace(s.customNamespace,r),p=o.replace((s.timeGrain||"").toString(),r),d=o.replace(s.aggregation,r),m=o.replace(s.top||"",r),h=(null!==(t=s.dimensionFilters)&&void 0!==t?t:[]).filter((e=>e.dimension&&"None"!==e.dimension)).map((e=>{var t;const s=null===(t=e.filters)||void 0===t?void 0:t.map((e=>o.replace(null!=e?e:"",r)));return{dimension:o.replace(e.dimension,r),operator:e.operator||"eq",filters:s||[]}})),g={resourceGroup:a,metricNamespace:u,customNamespace:l,resourceName:n,timeGrain:p,allowedTimeGrainsMs:s.allowedTimeGrainsMs,metricName:o.replace(s.metricName,r),aggregation:d,dimensionFilters:h,top:m||"10",alias:s.alias};return s.metricDefinition&&(g.metricDefinition=o.replace(s.metricDefinition,r)),s.resourceUri&&(g.resourceUri=o.replace(s.resourceUri,r)),Pr(Object.assign({},e,{subscription:i,queryType:z.AzureMonitor,azureMonitor:g}))}async getSubscriptions(){return this.isConfigured()?this.getResource(`${this.resourcePath}/subscriptions?api-version=2019-03-01`).then((e=>h.parseSubscriptions(e))):[]}getResourceGroups(e){return this.getResource(`${this.resourcePath}/subscriptions/${e}/resourceGroups?api-version=${this.listByResourceGroupApiVersion}`).then((e=>h.parseResponseValues(e,"name","name")))}getResourceNames(e,r,t,s){const o=(0,p.startsWith)(null==t?void 0:t.toLowerCase(),"microsoft.storage/storageaccounts/")?"microsoft.storage/storageaccounts":t;let i=`${this.resourcePath}/subscriptions/${e}`;return r&&(i+=`/resourceGroups/${r}`),i+=`/resources?api-version=${this.listByResourceGroupApiVersion}`,o&&(i+=`&$filter=resourceType eq '${o}'`),s&&(i+=`&$skiptoken=${s}`),this.getResource(i).then((async s=>{let o=[];if((0,p.startsWith)(null==t?void 0:t.toLowerCase(),"microsoft.storage/storageaccounts/")){o=h.parseResourceNames(s,"microsoft.storage/storageaccounts");for(let e=0;e<o.length;e++)o[e].text+="/default",o[e].value+="/default"}else o=h.parseResourceNames(s,t);if(s.nextLink){const i=new URL(s.nextLink).searchParams.get("$skiptoken");if(!i)throw Error("unable to request the next page of resources");const a=await this.getResourceNames(e,r,t,i);o=o.concat(a)}return o}))}getMetricNamespaces(e,r){const t=Ee.buildAzureMonitorGetMetricNamespacesUrl(this.resourcePath,this.apiPreviewVersion,this.replaceTemplateVariables(e),r,this.templateSrv);return this.getResource(t).then((e=>h.parseResponseValues(e,"properties.metricNamespaceName","properties.metricNamespaceName"))).then((e=>{if(t.toLowerCase().includes("microsoft.storage/storageaccounts")){const r=["microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/tableservices","microsoft.storage/storageaccounts/queueservices"];for(const t of r)(0,p.find)(e,["value",t.toLowerCase()])||e.push({value:t,text:t})}return e}))}getMetricNames(e){const r=Ee.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(r).then((e=>h.parseResponseValues(e,"name.localizedValue","name.value")))}getMetricMetadata(e){const{metricName:r}=e,t=Ee.buildAzureMonitorGetMetricNamesUrl(this.resourcePath,this.apiVersion,this.replaceTemplateVariables(e),this.templateSrv);return this.getResource(t).then((e=>h.parseMetadata(e,this.templateSrv.replace(r))))}validateDatasource(){if("clientsecret"===A(this.instanceSettings)){if(!this.isValidConfigField(this.instanceSettings.jsonData.tenantId))return{status:"error",message:"The Tenant Id field is required."};if(!this.isValidConfigField(this.instanceSettings.jsonData.clientId))return{status:"error",message:"The Client Id field is required."}}}isValidConfigField(e){return"string"==typeof e&&e.length>0}replaceTemplateVariables(e){const r=(0,c.J)(),t=Object.assign({},e);return Object.keys(e).forEach((e=>{t[e]=r.replace(t[e])})),t}async getProvider(e){return await this.getResource(`${y}/providers/${e}?api-version=${this.providerApiVersion}`)}async getLocations(e){const r=new Map;for(const t of e){const e=h.parseLocations(await this.getResource(`${y}/subscriptions/${t}/locations?api-version=${this.locationsApiVersion}`));for(const t of e)r.set(t.name,t)}return r}}class ut extends Br.CK{filterQuery(e){var r;return!(null===(r=e.azureResourceGraph)||void 0===r||!r.query)}applyTemplateVariables(e,r){const t=e.azureResourceGraph;if(!t)return e;const s=(0,c.J)(),o=s.getVariables().map((e=>`$${e.name}`)),i=d().find(e.subscriptions,(e=>d().includes(o,e))),a=[...s.replace(i,r,(e=>e)).split(",").filter((e=>e.length>0)),...d().filter(e.subscriptions,(e=>!d().includes(o,e)))],n=s.replace(t.query,r,S);return Object.assign({},e,{queryType:z.AzureResourceGraph,subscriptions:a,azureResourceGraph:{resultFormat:"table",query:n}})}}const lt={"microsoft.recoveryservices/vaults/backupfabrics/protectioncontainers/protecteditems":"Backup Items","microsoft.resources/subscriptions":"Subscriptions","microsoft.resources/subscriptions/resourcegroups":"Resource groups","citrix.services/xenappessentials":"Citrix Virtual Apps Essentials","citrix.services/xendesktopessentials":"Citrix Virtual Desktops Essentials","dynatrace.observability/monitors":"Dynatrace","github.enterprise/accounts":"GitHub AE","microsoft.aad/domainservices":"Azure AD Domain Services","microsoft.aadiam/privatelinkforazuread":"Private Link for Azure AD","microsoft.agfoodplatform/farmbeats":"Azure FarmBeats","microsoft.analysisservices/servers":"Analysis Services","microsoft.anybuild/clusters":"AnyBuild clusters","microsoft.apimanagement/service":"API Management services","microsoft.appconfiguration/configurationstores":"App Configuration","microsoft.appplatform/spring":"Azure Spring Cloud","microsoft.attestation/attestationproviders":"Attestation providers","microsoft.authorization/resourcemanagementprivatelinks":"Resource management private links","microsoft.automation/automationaccounts":"Automation Accounts","microsoft.automation/automationaccounts/runbooks":"Runbook","microsoft.autonomoussystems/workspaces":"Bonsai","microsoft.avs/privateclouds":"AVS Private clouds","microsoft.azureactivedirectory/b2cdirectories":"B2C Tenants","microsoft.azureactivedirectory/guestusages":"Guest Usages","microsoft.azurearcdata/datacontrollers":"Azure Arc data controllers","microsoft.azurearcdata/postgresinstances":"Azure Arc-enabled PostgreSQL Hyperscale server groups","microsoft.azurearcdata/sqlmanagedinstances":"SQL managed instances - Azure Arc","microsoft.azurearcdata/sqlserverinstances":"SQL Server - Azure Arc","microsoft.azuredata/sqlserverregistrations":"SQL Server registries","microsoft.azurepercept/accounts":"Azure Percept accounts","microsoft.azurestackhci/clusters":"Azure Stack HCI","microsoft.azurestackhci/virtualmachines":"Azure Stack HCI virtual machine - Azure Arc","microsoft.baremetal/crayservers":"Cray Servers","microsoft.baremetal/monitoringservers":"Monitoring Servers","microsoft.baremetalinfrastructure/baremetalinstances":"BareMetal Instances","microsoft.batch/batchaccounts":"Batch accounts","microsoft.bing/accounts":"Bing Resources","microsoft.botservice/botservices":"Bot Services","microsoft.cache/redis":"Azure Cache for Redis","microsoft.cache/redisenterprise":"Redis Enterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies":"Content Delivery Network WAF policies","microsoft.cdn/profiles (front doors standard/premium":"Preview)","microsoft.cdn/profiles/afdendpoints":"Endpoints","microsoft.cdn/profiles/endpoints":"Endpoints","microsoft.certificateregistration/certificateorders":"App Service Certificates","microsoft.chaos/chaosexperiments":"Chaos Experiments (Classic)","microsoft.chaos/experiments":"Chaos Experiments","microsoft.classiccompute/domainnames":"Cloud services (classic)","microsoft.classiccompute/virtualmachines":"Virtual machines (classic)","microsoft.classicnetwork/networksecuritygroups":"Network security groups (classic)","microsoft.classicnetwork/reservedips":"Reserved IP addresses (classic)","microsoft.classicnetwork/virtualnetworks":"Virtual networks (classic)","microsoft.classicstorage/storageaccounts":"Storage accounts (classic)","microsoft.cloudtest/accounts":"CloudTest Accounts","microsoft.cloudtest/hostedpools":"1ES Hosted Pools","microsoft.cloudtest/images":"CloudTest Images","microsoft.cloudtest/pools":"CloudTest Pools","microsoft.clusterstor/nodes":"ClusterStors","microsoft.cognitiveservices/accounts":"Cognitive Services","microsoft.compute/availabilitysets":"Availability sets","microsoft.compute/capacityreservationgroups":"Capacity Reservation Groups","microsoft.compute/cloudservices":"Cloud services (extended support)","microsoft.compute/diskaccesses":"Disk Accesses","microsoft.compute/diskencryptionsets":"Disk Encryption Sets","microsoft.compute/disks":"Disks","microsoft.compute/galleries":"Azure compute galleries","microsoft.compute/galleries/applications":"VM application definitions","microsoft.compute/galleries/applications/versions":"VM application versions","microsoft.compute/galleries/images":"VM image definitions","microsoft.compute/galleries/images/versions":"VM image versions","microsoft.compute/hostgroups":"Host groups","microsoft.compute/hostgroups/hosts":"Hosts","microsoft.compute/images":"Images","microsoft.compute/proximityplacementgroups":"Proximity placement groups","microsoft.compute/restorepointcollections":"Restore Point Collections","microsoft.compute/snapshots":"Snapshots","microsoft.compute/sshpublickeys":"SSH keys","microsoft.compute/virtualmachines":"Virtual machines","microsoft.compute/virtualmachinescalesets":"Virtual machine scale sets","microsoft.confidentialledger/ledgers":"Confidential Ledgers","microsoft.confluent/organizations":"Confluent organizations","microsoft.connectedcache/cachenodes":"Connected Cache Resources","microsoft.connectedcache/enterprisecustomers":"Connected Cache Resources","microsoft.connectedvehicle/platformaccounts":"Connected Vehicle Platforms","microsoft.connectedvmwarevsphere/vcenters":"VMware vCenters","microsoft.connectedvmwarevsphere/virtualmachines":"VMware + AVS virtual machines","microsoft.containerinstance/containergroups":"Container instances","microsoft.containerregistry/registries":"Container registries","microsoft.containerregistry/registries/replications":"Container registry replications","microsoft.containerregistry/registries/webhooks":"Container registry webhooks","microsoft.containerservice/managedclusters":"Kubernetes services","microsoft.dashboard/grafana":"Grafana Workspaces","microsoft.databox/jobs":"Azure Data Box","microsoft.databoxedge/databoxedgedevices":"Azure Stack Edge / Data Box Gateway","microsoft.databricks/workspaces":"Azure Databricks Services","microsoft.datacatalog/catalogs":"Data Catalog","microsoft.datacollaboration/workspaces":"Project CI","microsoft.datadog/monitors":"Datadog","microsoft.datafactory/datafactories":"Data factories","microsoft.datafactory/factories":"Data factories (V2)","microsoft.datalakeanalytics/accounts":"Data Lake Analytics","microsoft.datalakestore/accounts":"Data Lake Storage Gen1","microsoft.datamigration/services":"Azure Database Migration Services","microsoft.datamigration/services/projects":"Azure Database Migration Projects","microsoft.datamigration/sqlmigrationservices":"Azure Database Migration Services","microsoft.dataprotection/backupvaults":"Backup vaults","microsoft.dataprotection/resourceguards":"Resource Guards (Preview)","microsoft.datareplication/replicationvaults":"Site Recovery Vaults","microsoft.datashare/accounts":"Data Shares","microsoft.dbformariadb/servers":"Azure Database for MariaDB servers","microsoft.dbformysql/flexibleservers":"Azure Database for MySQL flexible servers","microsoft.dbformysql/servers":"Azure Database for MySQL servers","microsoft.dbforpostgresql/flexibleservers":"Azure Database for PostgreSQL flexible servers","microsoft.dbforpostgresql/servergroups":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servergroupsv2":"Azure Database for PostgreSQL server groups","microsoft.dbforpostgresql/servers":"Azure Database for PostgreSQL servers","microsoft.dbforpostgresql/serversv2":"Azure Database for PostgreSQL servers v2","microsoft.deploymentmanager/rollouts":"Rollouts","microsoft.desktopvirtualization/applicationgroups":"Application groups","microsoft.desktopvirtualization/hostpools":"Host pools","microsoft.desktopvirtualization/scalingplans":"Scaling plans","microsoft.desktopvirtualization/workspaces":"Workspaces","microsoft.devices/iothubs":"IoT Hub","microsoft.devices/provisioningservices":"Device Provisioning Services","microsoft.deviceupdate/accounts":"Device Update for IoT Hubs","microsoft.devops/pipelines":"DevOps Starter","microsoft.devtestlab/labs":"DevTest Labs","microsoft.devtestlab/labs/virtualmachines":"Virtual machines","microsoft.digitaltwins/digitaltwinsinstances":"Azure Digital Twins","microsoft.documentdb/cassandraclusters":"Azure Managed Instance for Apache Cassandra","microsoft.documentdb/databaseaccounts":"Azure Cosmos DB accounts","microsoft.domainregistration/domains":"App Service Domains","microsoft.edgeorder/addresses":"Azure Edge Hardware Center Address","microsoft.edgeorder/orderitems":"Azure Edge Hardware Center","microsoft.elastic/monitors":"Elasticsearch (Elastic Cloud)","microsoft.eventgrid/domains":"Event Grid Domains","microsoft.eventgrid/partnernamespaces":"Event Grid Partner Namespaces","microsoft.eventgrid/partnerregistrations":"Event Grid Partner Registrations","microsoft.eventgrid/partnertopics":"Event Grid Partner Topics","microsoft.eventgrid/systemtopics":"Event Grid System Topics","microsoft.eventgrid/topics":"Event Grid Topics","microsoft.eventhub/clusters":"Event Hubs Clusters","microsoft.eventhub/namespaces":"Event Hubs Namespaces","microsoft.experimentation/experimentworkspaces":"Experiment Workspaces","microsoft.extendedlocation/customlocations":"Custom locations","microsoft.fidalgo/devcenters":"Fidalgo DevCenters","microsoft.fidalgo/networksettings":"Network Configurations","microsoft.fidalgo/projects":"Fidalgo Projects","microsoft.fidalgo/projects/environments":"Fidalgo Environments","microsoft.fluidrelay/fluidrelayservers":"Fluid Relay","microsoft.genomics/accounts":"Genomics accounts","microsoft.hanaonazure/hanainstances":"SAP HANA on Azure","microsoft.hanaonazure/sapmonitors":"Azure Monitors for SAP Solutions","microsoft.hdinsight/clusterpools":"HDInsight cluster pools","microsoft.hdinsight/clusterpools/clusters":"HDInsight gen2 clusters","microsoft.hdinsight/clusterpools/clusters/sessionclusters":"HDInsight session clusters","microsoft.hdinsight/clusters":"HDInsight clusters","microsoft.healthbot/healthbots":"Azure Health Bot","microsoft.healthcareapis/services":"Azure API for FHIR","microsoft.healthcareapis/workspaces":"Healthcare APIs Workspaces","microsoft.healthcareapis/workspaces/dicomservices":"DICOM services","microsoft.healthcareapis/workspaces/fhirservices":"FHIR services","microsoft.healthcareapis/workspaces/iotconnectors":"IoT connectors","microsoft.hpcworkbench/instances":"HPC Workbenches (preview)","microsoft.hpcworkbench/instances/chambers":"Chambers (preview)","microsoft.hpcworkbench/instances/chambers/accessprofiles":"Chamber Profiles (preview)","microsoft.hpcworkbench/instances/chambers/workloads":"Chamber VMs (preview)","microsoft.hpcworkbench/instances/consortiums":"Consortiums (preview)","microsoft.hybridcompute/machines":"Servers - Azure Arc","microsoft.hybridcompute/privatelinkscopes":"Azure Arc Private Link Scopes","microsoft.hybriddata/datamanagers":"StorSimple Data Managers","microsoft.hybridnetwork/devices":"Azure Network Function Manager  Devices","microsoft.hybridnetwork/networkfunctions":"Azure Network Function Manager  Network Functions","microsoft.importexport/jobs":"Import/export jobs","microsoft.insights/components":"Application Insights","microsoft.insights/datacollectionendpoints":"Data collection endpoints","microsoft.insights/datacollectionrules":"Data collection rules","microsoft.insights/privatelinkscopes":"Azure Monitor Private Link Scopes","microsoft.insights/webtests":"Availability tests","microsoft.insights/workbooks":"Azure Workbooks","microsoft.insights/workbooktemplates":"Azure Workbook Templates","microsoft.iotcentral/iotapps":"IoT Central Applications","microsoft.keyvault/vaults":"Key vaults","microsoft.kubernetes/connectedclusters":"Kubernetes - Azure Arc","microsoft.kusto/clusters":"Azure Data Explorer Clusters","microsoft.kusto/clusters/databases":"Azure Data Explorer Databases","microsoft.labservices/labaccounts":"Lab accounts","microsoft.labservices/labplans":"Lab plans","microsoft.labservices/labs":"Labs","microsoft.loadtestservice/loadtests":"Azure Load Testing","microsoft.logic/integrationaccounts":"Integration accounts","microsoft.logic/integrationserviceenvironments":"Integration Service Environments","microsoft.logic/integrationserviceenvironments/managedapis":"Managed Connector","microsoft.logic/workflows":"Logic apps","microsoft.logz/monitors":"Logz main account","microsoft.logz/monitors/accounts":"Logz sub account","microsoft.logz/monitors/metricssource":"Logz metrics data source","microsoft.machinelearning/commitmentplans":"Machine Learning Studio (classic) web service plans","microsoft.machinelearning/webservices":"Machine Learning Studio (classic) web services","microsoft.machinelearning/workspaces":"Machine Learning Studio (classic) workspaces","microsoft.machinelearningservices/workspaces":"Machine learning","microsoft.machinelearningservices/workspaces/onlineendpoints":"Machine learning online endpoints","microsoft.machinelearningservices/workspaces/onlineendpoints/deployments":"Machine learning online deployments","microsoft.maintenance/maintenanceconfigurations":"Maintenance Configurations","microsoft.managedidentity/userassignedidentities":"Managed Identities","microsoft.maps/accounts":"Azure Maps Accounts","microsoft.maps/accounts/creators":"Azure Maps Creator Resources","microsoft.media/mediaservices":"Media Services","microsoft.media/mediaservices/liveevents":"Live events","microsoft.media/mediaservices/streamingendpoints":"Streaming Endpoints","microsoft.media/videoanalyzers":"Video Analyzers","microsoft.migrate/projects":"Migration projects","microsoft.mixedreality/objectanchorsaccounts":"Object Anchors Accounts","microsoft.mixedreality/objectunderstandingaccounts":"Object Understanding Accounts","microsoft.mixedreality/remoterenderingaccounts":"Remote Rendering Accounts","microsoft.mixedreality/spatialanchorsaccounts":"Spatial Anchors Accounts","microsoft.mobilenetwork/mobilenetworks":"Mobile Networks","microsoft.mobilenetwork/mobilenetworks/datanetworks":"Data Networks","microsoft.mobilenetwork/mobilenetworks/services":"Services","microsoft.mobilenetwork/mobilenetworks/simpolicies":"Sim Policies","microsoft.mobilenetwork/mobilenetworks/sites":"Mobile Network Sites","microsoft.mobilenetwork/mobilenetworks/slices":"Slices","microsoft.mobilenetwork/packetcorecontrolplanes":"Packet Core Control Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes":"Packet Core Data Planes","microsoft.mobilenetwork/packetcorecontrolplanes/packetcoredataplanes/attacheddatanetworks":"Attached Data Networks","microsoft.mobilenetwork/sims":"Sims","microsoft.netapp/netappaccounts":"NetApp accounts","microsoft.netapp/netappaccounts/capacitypools":"Capacity pools","microsoft.netapp/netappaccounts/capacitypools/volumes":"Volumes","microsoft.netapp/netappaccounts/capacitypools/volumes/snapshots":"Snapshots","microsoft.netapp/netappaccounts/snapshotpolicies":"Snapshot policies","microsoft.network/applicationgateways":"Application gateways","microsoft.network/applicationgatewaywebapplicationfirewallpolicies":"Application Gateway WAF policies","microsoft.network/applicationsecuritygroups":"Application security groups","microsoft.network/azurefirewalls":"Firewalls","microsoft.network/bastionhosts":"Bastions","microsoft.network/connections":"Connections","microsoft.network/customipprefixes":"Custom IP Prefixes","microsoft.network/ddosprotectionplans":"DDoS protection plans","microsoft.network/dnsforwardingrulesets":"Dns Forwarding Rulesets","microsoft.network/dnsresolvers":"DNS Private Resolvers","microsoft.network/dnszones":"DNS zones","microsoft.network/expressroutecircuits":"ExpressRoute circuits","microsoft.network/expressrouteports":"ExpressRoute Direct","microsoft.network/firewallpolicies":"Firewall Policies","microsoft.network/frontdoors":"Front Doors","microsoft.network/frontdoorwebapplicationfirewallpolicies":"Web Application Firewall policies (WAF)","microsoft.network/ipgroups":"IP Groups","microsoft.network/loadbalancers":"Load balancers","microsoft.network/localnetworkgateways":"Local network gateways","microsoft.network/natgateways":"NAT gateways","microsoft.network/networkexperimentprofiles":"Internet Analyzer profiles","microsoft.network/networkinterfaces":"Network interfaces","microsoft.network/networkmanagers":"Network Managers","microsoft.network/networksecuritygroups":"Network security groups","microsoft.network/networkwatchers":"Network Watchers","microsoft.network/networkwatchers/flowlogs":"NSG Flow Logs","microsoft.network/privatednszones":"Private DNS zones","microsoft.network/privateendpoints":"Private endpoints","microsoft.network/privatelinkservices":"Private link services","microsoft.network/publicipaddresses":"Public IP addresses","microsoft.network/publicipprefixes":"Public IP Prefixes","microsoft.network/routefilters":"Route filters","microsoft.network/routetables":"Route tables","microsoft.network/serviceendpointpolicies":"Service endpoint policies","microsoft.network/trafficmanagerprofiles":"Traffic Manager profiles","microsoft.network/virtualnetworkgateways":"Virtual network gateways","microsoft.network/virtualnetworks":"Virtual networks","microsoft.network/virtualwans":"Virtual WANs","microsoft.notificationhubs/namespaces":"Notification Hub Namespaces","microsoft.notificationhubs/namespaces/notificationhubs":"Notification Hubs","microsoft.openenergyplatform/energyservices":"Project Oak Forest","microsoft.openlogisticsplatform/workspaces":"Open Supply Chain Platform","microsoft.operationalinsights/querypacks":"Log Analytics query packs","microsoft.operationalinsights/workspaces":"Log Analytics workspaces","microsoft.operationsmanagement/solutions":"Solutions","microsoft.orbital/contactprofiles":"Contact Profiles","microsoft.orbital/edgesites":"Edge Sites","microsoft.orbital/groundstations":"Ground Stations","microsoft.orbital/l2connections":"L2 Connections","microsoft.orbital/spacecrafts":"Spacecrafts","microsoft.peering/peerings":"Peerings","microsoft.peering/peeringservices":"Peering Services","microsoft.playfab/playeraccountpools":"PlayFab player account pools","microsoft.playfab/titles":"PlayFab titles","microsoft.portal/dashboards":"Shared dashboards","microsoft.powerbidedicated/capacities":"Power BI Embedded","microsoft.purview/accounts":"Microsoft Purview accounts","microsoft.quantum/workspaces":"Quantum Workspaces","microsoft.recommendationsservice/accounts":"Intelligent Recommendations Accounts","microsoft.recommendationsservice/accounts/modeling":"Modeling","microsoft.recommendationsservice/accounts/serviceendpoints":"Service Endpoints","microsoft.recoveryservices/vaults":"Recovery Services vaults","microsoft.redhatopenshift/openshiftclusters":"Azure Red Hat OpenShift","microsoft.relay/namespaces":"Relays","microsoft.resourceconnector/appliances":"Resource bridges","microsoft.resourcegraph/queries":"Resource Graph queries","microsoft.resources/deploymentscripts":"Deployment Scripts","microsoft.resources/templatespecs":"Template specs","microsoft.saas/applications":"Software as a Service (classic)","microsoft.saas/resources":"SaaS","microsoft.scom/managedinstances":"Aquila Instances","microsoft.scvmm/virtualmachines":"SCVMM virtual machine - Azure Arc","microsoft.scvmm/vmmservers":"SCVMM management servers","microsoft.search/searchservices":"Search services","microsoft.securitydetonation/chambers":"Security Detonation Chambers","microsoft.servicebus/namespaces":"Service Bus Namespaces","microsoft.servicefabric/clusters":"Service Fabric clusters","microsoft.servicefabric/managedclusters":"Service Fabric managed clusters","microsoft.serviceshub/connectors":"Services Hub Connectors","microsoft.signalrservice/signalr":"SignalR","microsoft.signalrservice/webpubsub":"Web PubSub Service","microsoft.solutions/applicationdefinitions":"Service catalog managed application definitions","microsoft.solutions/applications":"Managed applications","microsoft.sql/instancepools":"Instance pools","microsoft.sql/managedinstances":"SQL managed instances","microsoft.sql/managedinstances/databases":"Managed databases","microsoft.sql/servers":"SQL servers","microsoft.sql/servers/databases":"SQL databases","microsoft.sql/servers/elasticpools":"SQL elastic pools","microsoft.sql/servers/jobagents":"Elastic Job agents","microsoft.sql/virtualclusters":"Virtual clusters","microsoft.sqlvirtualmachine/sqlvirtualmachines":"SQL virtual machines","microsoft.storage/storageaccounts":"Storage accounts","microsoft.storagecache/amlfilesystems":"Lustre File Systems","microsoft.storagecache/caches":"HPC caches","microsoft.storagepool/diskpools":"Disk Pools","microsoft.storagesync/storagesyncservices":"Storage Sync Services","microsoft.storagesyncdev/storagesyncservices":"Storage Sync Services","microsoft.storagesyncint/storagesyncservices":"Storage Sync Services","microsoft.storsimple/managers":"StorSimple Device Managers","microsoft.streamanalytics/clusters":"Stream Analytics clusters","microsoft.streamanalytics/streamingjobs":"Stream Analytics jobs","microsoft.synapse/privatelinkhubs":"Azure Synapse Analytics (private link hubs)","microsoft.synapse/workspaces":"Azure Synapse Analytics","microsoft.synapse/workspaces/bigdatapools":"Apache Spark pools","microsoft.synapse/workspaces/kustopools":"Data Explorer pools (preview)","microsoft.synapse/workspaces/sqlpools":"Dedicated SQL pools","microsoft.testbase/testbaseaccounts":"Test Base Accounts","microsoft.testbase/testbaseaccounts/packages":"Test Base Packages","microsoft.timeseriesinsights/environments":"Time Series Insights environments","microsoft.timeseriesinsights/environments/eventsources":"Time Series Insights event sources","microsoft.timeseriesinsights/environments/referencedatasets":"Time Series Insights reference data sets","microsoft.videoindexer/accounts":"Video Analyzer for Media","microsoft.virtualmachineimages/imagetemplates":"Image Templates","microsoft.visualstudio/account":"Azure DevOps organizations","microsoft.visualstudio/account/project":"DevOps Starter","microsoft.vmwarecloudsimple/dedicatedcloudnodes":"CloudSimple Nodes","microsoft.vmwarecloudsimple/dedicatedcloudservices":"CloudSimple Services","microsoft.vmwarecloudsimple/virtualmachines":"CloudSimple Virtual Machines","microsoft.vsonline/plans":"Visual Studio Online Plans","microsoft.web/connectiongateways":"On-premises data gateways","microsoft.web/connections":"API Connections","microsoft.web/containerapps":"Container Apps","microsoft.web/customapis":"Logic Apps Custom Connector","microsoft.web/hostingenvironments":"App Service Environments","microsoft.web/kubeenvironments":"App Service Kubernetes Environments","microsoft.web/serverfarms":"App Service plans","microsoft.web/sites":"App Services","microsoft.web/sites/slots":"App Service (Slots)","microsoft.web/staticsites":"Static Web Apps","microsoft.windowsesu/multipleactivationkeys":"Windows Multiple Activation Keys","microsoft.windowsiot/deviceservices":"Windows 10 IoT Core Services","microsoft.workloads/monitors":"Azure Monitors for SAP Solutions (v2)","microsoft.workloads/phpworkloads":"Scalable WordPress on Linux","microsoft.workloads/sapvirtualinstances":"SAP Virtual Instances","microsoft.workloads/sapvirtualinstances/applicationinstances":"SAP app server instances","microsoft.workloads/sapvirtualinstances/centralinstances":"SAP central server instances","microsoft.workloads/sapvirtualinstances/databaseinstances":"SAP database server instances","nginx.nginxplus/nginxdeployments":"NGINX Deployment","providers.test/statefulibizaengines":"VLCentral Help","wandisco.fusion/fusiongroups":"LiveData Planes","wandisco.fusion/fusiongroups/azurezones":"Azure Zones","wandisco.fusion/fusiongroups/azurezones/plugins":"Plugins","wandisco.fusion/fusiongroups/hivereplicationrules":"Hive Replication Rules","wandisco.fusion/fusiongroups/managedonpremzones":"On-premises Zones","wandisco.fusion/fusiongroups/replicationrules":"Replication Rules","wandisco.fusion/migrators":"LiveData Migrators","wandisco.fusion/migrators/exclusiontemplates":"Exclusions","wandisco.fusion/migrators/livedatamigrations":"Migrations","wandisco.fusion/migrators/metadatamigrations":"Metadata Migrations","wandisco.fusion/migrators/metadatatargets":"Metadata Targets","wandisco.fusion/migrators/pathmappings":"Path Mappings","wandisco.fusion/migrators/targets":"Targets","microsoft.security/insights/classification":"Data Sensitivity Security Insights (Preview)","microsoft.security/locations/alerts":"Security Alerts"};function pt(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const dt=["microsoft.aad/domainservices","microsoft.aadiam/azureadmetrics","microsoft.aadiam/tenants","microsoft.agfoodplatform/farmbeats","microsoft.analysisservices/servers","microsoft.apimanagement/service","microsoft.appconfiguration/configurationstores","microsoft.appplatform/spring","microsoft.attestation/attestationproviders","microsoft.automation/automationaccounts","microsoft.autonomousdevelopmentplatform/accounts","microsoft.autonomousdevelopmentplatform/datapools","microsoft.autonomousdevelopmentplatform/workspaces","microsoft.avs/privateclouds","microsoft.azurestackresourcemonitor/storageaccountmonitor","microsoft.batch/batchaccounts","microsoft.batchai/workspaces","microsoft.blockchain/blockchainmembers","microsoft.blockchain/cordamembers","microsoft.botservice/botservices","microsoft.cache/redis","microsoft.cache/redisenterprise","microsoft.cdn/cdnwebapplicationfirewallpolicies","microsoft.cdn/profiles","microsoft.cdn/profiles/endpoints","microsoft.classiccompute/domainnames","microsoft.classiccompute/virtualmachines","microsoft.classicnetwork/networksecuritygroups","microsoft.classicstorage/storageaccounts","microsoft.cognitiveservices/accounts","microsoft.communication/communicationservices","microsoft.compute/disks","microsoft.compute/virtualmachines","microsoft.compute/virtualmachinescalesets","microsoft.connectedcache/cachenodes","microsoft.connectedvehicle/platformaccounts","microsoft.containerinstance/containergroups","microsoft.containerregistry/registries","microsoft.containerservice/managedclusters","microsoft.customerinsights/hubs","microsoft.customproviders/resourceproviders","microsoft.d365customerinsights/instances","microsoft.dashboard/grafana","microsoft.databoxedge/databoxedgedevices","microsoft.databricks/workspaces","microsoft.datacollaboration/workspaces","microsoft.datafactory/datafactories","microsoft.datafactory/factories","microsoft.datalakeanalytics/accounts","microsoft.datalakestore/accounts","microsoft.datashare/accounts","microsoft.dbformariadb/servers","microsoft.dbformysql/flexibleservers","microsoft.dbformysql/servers","microsoft.dbforpostgresql/flexibleservers","microsoft.dbforpostgresql/servergroupsv2","microsoft.dbforpostgresql/servers","microsoft.dbforpostgresql/serversv2","microsoft.desktopvirtualization/applicationgroups","microsoft.desktopvirtualization/hostpools","microsoft.desktopvirtualization/scalingplans","microsoft.desktopvirtualization/workspaces","microsoft.devices/elasticpools/iothubtenants","microsoft.devices/iothubs","microsoft.devices/provisioningservices","microsoft.digitaltwins/digitaltwinsinstances","microsoft.documentdb/cassandraclusters","microsoft.documentdb/databaseaccounts","microsoft.eventgrid/domains","microsoft.eventgrid/partnernamespaces","microsoft.eventgrid/partnertopics","microsoft.eventgrid/systemtopics","microsoft.eventgrid/topics","microsoft.eventhub/clusters","microsoft.eventhub/namespaces","microsoft.experimentation/experimentworkspaces","microsoft.fabric.admin/fabriclocations","microsoft.hdinsight/clusters","microsoft.healthcareapis/services","microsoft.healthcareapis/workspaces/dicomservices","microsoft.healthcareapis/workspaces/fhirservices","microsoft.insights/autoscalesettings","microsoft.insights/components","microsoft.insights/qos","microsoft.iotcentral/iotapps","microsoft.keyvault/managedhsms","microsoft.keyvault/vaults","microsoft.kubernetes/connectedclusters","microsoft.kusto/clusters","microsoft.loadtestservice/loadtests","microsoft.logic/integrationaccounts","microsoft.logic/integrationserviceenvironments","microsoft.logic/workflows","microsoft.machinelearningservices/workspaces","microsoft.media/mediaservices","microsoft.media/mediaservices/liveevents","microsoft.media/mediaservices/streamingendpoints","microsoft.media/videoanalyzers","microsoft.netapp/netappaccounts/capacitypools","microsoft.netapp/netappaccounts/capacitypools/volumes","microsoft.network/applicationgateways","microsoft.network/azurefirewalls","microsoft.network/bastionhosts","microsoft.network/connections","microsoft.network/dnszones","microsoft.network/expressroutecircuits","microsoft.network/expressroutegateways","microsoft.network/expressrouteports","microsoft.network/frontdoors","microsoft.network/loadbalancers","microsoft.network/natgateways","microsoft.network/networkinterfaces","microsoft.network/networksecuritygroups","microsoft.network/networksecurityperimeters","microsoft.network/networkvirtualappliances","microsoft.network/networkwatchers","microsoft.network/networkwatchers/connectionmonitors","microsoft.network/p2svpngateways","microsoft.network/privateendpoints","microsoft.network/privatelinkservices","microsoft.network/publicipaddresses","microsoft.network/trafficmanagerprofiles","microsoft.network/virtualnetworkgateways","microsoft.network/virtualnetworks","microsoft.network/vpngateways","microsoft.networkfunction/azuretrafficcollectors","microsoft.notificationhubs/namespaces","microsoft.notificationhubs/namespaces/notificationhubs","microsoft.openlogisticsplatform/workspaces","microsoft.operationalinsights/workspaces","microsoft.operationsmanagement/solutions","microsoft.peering/peeringservices","microsoft.powerbi/tenants","microsoft.powerbi/tenants/workspaces","microsoft.powerbidedicated/capacities","microsoft.purview/accounts","microsoft.recoveryservices/vaults","microsoft.relay/namespaces","microsoft.resources/subscriptions","microsoft.resources/subscriptions/resourcegroups","microsoft.search/searchservices","microsoft.security/antimalwaresettings","microsoft.securityinsights/settings","microsoft.servicebus/namespaces","microsoft.signalrservice/signalr","microsoft.signalrservice/webpubsub","microsoft.singularity/accounts","microsoft.sql/managedinstances","microsoft.sql/managedinstances/databases","microsoft.sql/servers/databases","microsoft.sql/servers/elasticpools","microsoft.storage/storageaccounts","microsoft.storage/storageaccounts/blobservices","microsoft.storage/storageaccounts/fileservices","microsoft.storage/storageaccounts/queueservices","microsoft.storage/storageaccounts/tableservices","microsoft.storagecache/caches","microsoft.storagesync/storagesyncservices","microsoft.streamanalytics/streamingjobs","microsoft.synapse/workspaces","microsoft.synapse/workspaces/bigdatapools","microsoft.synapse/workspaces/kustopools","microsoft.synapse/workspaces/scopepools","microsoft.synapse/workspaces/sqlpools","microsoft.timeseriesinsights/environments","microsoft.timeseriesinsights/environments/eventsources","microsoft.videoindexer/accounts","microsoft.vmwarecloudsimple/virtualmachines","microsoft.web/hostingenvironments","microsoft.web/hostingenvironments/workerpools","microsoft.web/serverfarms","microsoft.web/sites","microsoft.web/sites/slots"].map((e=>`"${e}"`)).join(",");class mt extends Br.CK{constructor(e,r){super(e),pt(this,"resourcePath",void 0),pt(this,"resultLimit",200),pt(this,"azureMonitorDatasource",void 0),pt(this,"supportedMetricNamespaces",""),pt(this,"logLocationsMap",new Map),pt(this,"logLocations",[]),pt(this,"search",(async(e,r)=>{let t="resources";"logs"===r&&(t+="\n      | union resourcecontainers"),t+=`\n        | where id contains "${e}"\n        ${await this.filterByType(r)}\n        | order by tolower(name) asc\n        | limit ${this.resultLimit}\n      `;const{data:s}=await this.makeResourceGraphRequest(t);return s.map((e=>{var r,t;const s=Qe(e.id);if(!s||!(s.resourceName||s.resourceGroup||s.subscription))throw new Error("unable to fetch resource details");let o=null!==(r=s.subscription)&&void 0!==r?r:"",i=xe.Subscription;return s.resourceName?(o=s.resourceName,i=xe.Resource):s.resourceGroup&&(o=s.resourceGroup,i=xe.ResourceGroup),{name:e.name,id:o,uri:e.id,resourceGroupName:e.resourceGroup,type:i,typeLabel:lt[e.type]||e.type,location:(null===(t=this.logLocationsMap.get(e.location))||void 0===t?void 0:t.displayName)||e.location}}))})),pt(this,"filterByType",(async e=>(""===this.supportedMetricNamespaces&&"logs"!==e&&await this.fetchAllNamespaces(),"logs"===e?`| where type in (${dt})`:`| where type in (${this.supportedMetricNamespaces})`))),this.resourcePath=`${k}`,this.azureMonitorDatasource=r}async fetchInitialRows(e,r){const t=await this.getSubscriptions();if(0===this.logLocationsMap.size&&(this.logLocationsMap=await this.getLogsLocations(t),this.logLocations=Array.from(this.logLocationsMap.values()).map((e=>`"${e.name}"`))),!r)return t;let s=t;if(r.subscription){const t=`/subscriptions/${r.subscription}/resourceGroups/${r.resourceGroup}`;if(r.resourceGroup){const t=await this.getResourceGroupsBySubscriptionId(r.subscription,e);s=Xe(s,`/subscriptions/${r.subscription}`,t)}if(r.resourceName){s=Xe(s,t,await this.getResourcesForResourceGroup(t,e))}}return s}async fetchAndAppendNestedRow(e,r,t){const s=r.type===xe.Subscription?await this.getResourceGroupsBySubscriptionId(r.id,t):await this.getResourcesForResourceGroup(r.id,t);return Xe(e,r.uri,s)}async getSubscriptions(){let e,r=[],t=!1;for(;!t;){let s={};e&&(s={$skipToken:e});const o=await this.makeResourceGraphRequest("\n    resources\n    | join kind=inner (\n              ResourceContainers\n                | where type == 'microsoft.resources/subscriptions'\n                | project subscriptionName=name, subscriptionURI=id, subscriptionId\n              ) on subscriptionId\n    | summarize count() by subscriptionName, subscriptionURI, subscriptionId\n    | order by subscriptionName desc\n  ",1,s);if(!o.data.length)throw new Error("No subscriptions were found");r=r.concat(o.data),e=o.$skipToken,t=!e}return r.map((e=>({name:e.subscriptionName,id:e.subscriptionId,uri:`/subscriptions/${e.subscriptionId}`,typeLabel:"Subscription",type:xe.Subscription,children:[]})))}async getResourceGroupsBySubscriptionId(e,r){const t=`\n    resources\n     | join kind=inner (\n       ResourceContainers\n       | where type == 'microsoft.resources/subscriptions/resourcegroups'\n       | project resourceGroupURI=id, resourceGroupName=name, resourceGroup, subscriptionId\n     ) on resourceGroup, subscriptionId\n\n     ${await this.filterByType(r)}\n     | where subscriptionId == '${e}'\n     | summarize count() by resourceGroupName, resourceGroupURI\n     | order by resourceGroupURI asc`;let s,o=[],i=!1;for(;!i;){let e={};s&&(e={$skipToken:s});const r=await this.makeResourceGraphRequest(t,1,e);o=o.concat(r.data),s=r.$skipToken,i=!s}return o.map((e=>{const r=Qe(e.resourceGroupURI);if(!r||!r.resourceGroup)throw new Error("unable to fetch resource groups");return{name:e.resourceGroupName,uri:e.resourceGroupURI,id:r.resourceGroup,type:xe.ResourceGroup,typeLabel:"Resource Group",children:[]}}))}async getResourcesForResourceGroup(e,r){if(!this.logLocations)return[];const{data:t}=await this.makeResourceGraphRequest(`\n      resources\n      | where id hasprefix "${e}"\n      ${await this.filterByType(r)} and location in (${this.logLocations})\n    `);return t.map((e=>{var r;const t=Qe(e.id);if(!t||!t.resourceName)throw new Error("unable to fetch resource details");return{name:e.name,id:t.resourceName,uri:e.id,resourceGroupName:e.resourceGroup,type:xe.Resource,typeLabel:lt[e.type]||e.type,location:(null===(r=this.logLocationsMap.get(e.location))||void 0===r?void 0:r.displayName)||e.location}}))}async getResourceURIDisplayProperties(e){var r;const{subscription:t,resourceGroup:s,resourceName:o}=null!==(r=Fe(e))&&void 0!==r?r:{};if(!t)throw new Error("Invalid resource URI passed");const i=`/subscriptions/${t}`,a=`\n    resourcecontainers\n    | where type == "microsoft.resources/subscriptions"\n    | where id =~ "${i}"\n    | project subscriptionName=name, subscriptionId\n\n    | join kind=leftouter (\n      resourcecontainers            \n            | where type == "microsoft.resources/subscriptions/resourcegroups"\n            | where id =~ "${`${i}/resourceGroups/${s}`}"\n            | project resourceGroupName=name, resourceGroup, subscriptionId\n        ) on subscriptionId\n\n        | join kind=leftouter (\n          resources\n            | where id =~ "${e}"\n            | project resourceName=name, subscriptionId\n        ) on subscriptionId\n\n        | project subscriptionName, resourceGroupName, resourceName\n    `,{data:n}=await this.makeResourceGraphRequest(a);if(!n.length)throw new Error("unable to fetch resource details");const{subscriptionName:c,resourceGroupName:u,resourceName:l}=n[0];return{subscription:c||t,resourceGroup:u||s,resourceName:l||o}}async getResourceURIFromWorkspace(e){const{data:r}=await this.makeResourceGraphRequest(`\n      resources\n      | where properties['customerId'] == "${e}"\n      | project id\n    `);if(!r.length)throw new Error("unable to find resource for workspace "+e);return r[0].id}async makeResourceGraphRequest(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2?arguments[2]:void 0;try{return await this.postResource(this.resourcePath+"/providers/Microsoft.ResourceGraph/resources?api-version=2021-03-01",{query:e,options:Object.assign({resultFormat:"objectArray"},t)})}catch(t){if(r>0)return this.makeResourceGraphRequest(e,r-1);throw t}}async fetchAllNamespaces(){const e=await this.getSubscriptions();let r=[];for await(const t of e){const e=await this.azureMonitorDatasource.getMetricNamespaces({resourceUri:`/subscriptions/${t.id}`},!0);if(e){const t=e.map((e=>`"${e.value.toLocaleLowerCase()}"`));r=r.concat(t)}}if(0===r.length)throw new Error("Unable to resolve a list of valid metric namespaces. Validate the datasource configuration is correct and required permissions have been granted for all subscriptions. Grafana requires at least the Reader role to be assigned.");this.supportedMetricNamespaces=(0,p.uniq)(r).join(",")}async getLogsLocations(e){const r=e.map((e=>e.id)),t=await this.azureMonitorDatasource.getLocations(r),s=await this.azureMonitorDatasource.getProvider("Microsoft.Insights"),o=null==s?void 0:s.resourceTypes.find((e=>"logs"===e.resourceType));if(!o)return t;const i=o.locations.map((e=>({displayName:e,name:"",supportsLogs:!0}))),a=new Map;for(const e of i){var n;const r=(null===(n=Array.from(t.values()).find((r=>e.displayName===r.displayName)))||void 0===n?void 0:n.name)||"";""!==r&&a.set(r,Object.assign({},e,{name:r}))}return a}}function ft(e){var r,t,s,o,i;const a="string"==typeof e.rawQuery?e.rawQuery:null,n="string"==typeof e.workspace?e.workspace:null;if(!a||!n||null!==(r=e.target)&&void 0!==r&&null!==(t=r.azureLogAnalytics)&&void 0!==t&&t.query)return e;const c=Object.assign({},null!==(s=e.target)&&void 0!==s?s:{},{refId:null!==(o=null===(i=e.target)||void 0===i?void 0:i.refId)&&void 0!==o?o:"Anno",queryType:z.LogAnalytics,azureLogAnalytics:{query:a,resource:n}});return Object.assign({},e,{rawQuery:void 0,workspace:void 0,subscription:void 0,queryType:void 0,target:c})}var ht=t(3363),gt=t(58193),vt=t(68633);const bt=e=>({subscriptions:e.match(/^Subscriptions\(\)/i),resourceGroups:e.match(/^ResourceGroups\(\)/i),resourceGroupsWithSub:e.match(/^ResourceGroups\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespaces:e.match(/^Namespaces\(([^\)]+?)(,\s?([^,]+?))?\)/i),namespacesWithSub:e.match(/^Namespaces\(([^,]+?),\s?([^,]+?)\)/i),resourceNames:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?)\)/i),resourceNamesWithSub:e.match(/^ResourceNames\(([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),metricNamespace:e.match(/^MetricNamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamespaceWithSub:e.match(/^metricnamespace\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNames:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?)\)/i),metricNamesWithSub:e.match(/^MetricNames\(([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?([^,]+?),\s?(.+?)\)/i),appInsightsMetricNameQuery:e.match(/^AppInsightsMetricNames\(\)/i),appInsightsGroupByQuery:e.match(/^AppInsightsGroupBys\(([^\)]+?)(,\s?([^,]+?))?\)/i),workspacesQuery:e.match(/^workspaces\(\)/i),workspacesQueryWithSub:e.match(/^workspaces\(["']?([^\)]+?)["']?\)/i)}),yt=async(e,r)=>"string"!=typeof e?e:(e=>{const r=bt(e);return Object.keys(r).some((e=>!!r[e]))})(e)?((e,r)=>{const t=bt(e),s=r.azureMonitorDatasource.defaultSubscriptionId;return{refId:"A",queryType:z.GrafanaTemplateVariableFn,grafanaTemplateVariableFn:t.appInsightsMetricNameQuery?{rawQuery:e,kind:"AppInsightsMetricNameQuery"}:t.appInsightsGroupByQuery?{kind:"AppInsightsGroupByQuery",rawQuery:e,metricName:t.appInsightsGroupByQuery[1]}:t.subscriptions?{kind:"SubscriptionsQuery",rawQuery:e}:t.resourceGroupsWithSub?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:t.resourceGroupsWithSub[1]}:t.resourceGroups&&s?{kind:"ResourceGroupsQuery",rawQuery:e,subscription:s}:t.namespacesWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t.namespacesWithSub[1],resourceGroup:t.namespacesWithSub[2]}:t.namespaces&&s?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s,resourceGroup:t.namespaces[1]}:t.resourceNamesWithSub?{kind:"ResourceNamesQuery",rawQuery:e,subscription:t.resourceNamesWithSub[1],resourceGroup:t.resourceNamesWithSub[2],metricNamespace:t.resourceNamesWithSub[3]}:t.resourceNames&&s?{kind:"ResourceNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.resourceNames[1],metricNamespace:t.resourceNames[2]}:t.metricNamespaceWithSub?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:t.metricNamespaceWithSub[1],resourceGroup:t.metricNamespaceWithSub[2],metricNamespace:t.metricNamespaceWithSub[3],resourceName:t.metricNamespaceWithSub[4]}:t.metricNamespace&&s?{kind:"MetricNamespaceQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNamespace[1],metricNamespace:t.metricNamespace[2],resourceName:t.metricNamespace[3]}:t.metricNames&&s&&-1===t.metricNames[3].indexOf(",")?{kind:"MetricNamesQuery",rawQuery:e,subscription:s,resourceGroup:t.metricNames[1],metricNamespace:t.metricNames[2],resourceName:t.metricNames[3]}:t.metricNamesWithSub?{kind:"MetricNamesQuery",rawQuery:e,subscription:t.metricNamesWithSub[1],resourceGroup:t.metricNamesWithSub[2],metricNamespace:t.metricNamesWithSub[3],resourceName:t.metricNamesWithSub[4]}:t.workspacesQueryWithSub?{kind:"WorkspacesQuery",rawQuery:e,subscription:(t.workspacesQueryWithSub[1]||"").trim()}:t.workspacesQuery&&s?{kind:"WorkspacesQuery",rawQuery:e,subscription:s}:{kind:"SubscriptionsQuery",rawQuery:e},subscription:s}})(e,r.datasource):(async(e,r)=>{const t=r.azureMonitorDatasource.defaultSubscriptionId;let s="";if(e){const e=r.azureLogAnalyticsDatasource.getDeprecatedDefaultWorkSpace();s=e?Ve(e)?await r.resourcePickerData.getResourceURIFromWorkspace(e):e:await r.azureLogAnalyticsDatasource.getFirstWorkspace()||""}return{refId:"A",queryType:z.LogAnalytics,azureLogAnalytics:{query:e,resource:s},subscription:t}})(e,r.datasource),wt=async(e,r)=>{let t=await yt(e,r);return j.v.featureToggles.azLegacyTemplateVariables||t.queryType!==z.GrafanaTemplateVariableFn||(t=(e=>{const{queryType:r,grafanaTemplateVariableFn:t}=e;if(r!==z.GrafanaTemplateVariableFn||!t)return e;const s=Object.assign({},e);switch("subscription"in t&&(s.subscription=t.subscription),"resourceGroup"in t&&(s.resourceGroup=t.resourceGroup),"metricNamespace"in t&&(s.namespace=t.metricNamespace),"resourceName"in t&&(s.resource=t.resourceName),t.kind){case"SubscriptionsQuery":s.queryType=z.SubscriptionsQuery;break;case"ResourceGroupsQuery":s.queryType=z.ResourceGroupsQuery;break;case"ResourceNamesQuery":s.queryType=z.ResourceNamesQuery;break;case"MetricNamespaceQuery":case"MetricDefinitionsQuery":s.queryType=z.NamespacesQuery;break;case"MetricNamesQuery":s.queryType=z.MetricNamesQuery;break;case"WorkspacesQuery":s.queryType=z.WorkspacesQuery}return s})(t)),t},kt=e=>{var r;let{query:t,updateQuery:s,datasource:o}=e;const[i,n]=(0,a.useState)("");(0,a.useEffect)((()=>{var e;n((null===(e=t.grafanaTemplateVariableFn)||void 0===e?void 0:e.rawQuery)||"")}),[null===(r=t.grafanaTemplateVariableFn)||void 0===r?void 0:r.rawQuery]);const c=(0,a.useCallback)((e=>{yt(e,{datasource:o}).then((r=>{r.queryType===z.GrafanaTemplateVariableFn?s(r):s(Object.assign({},t,{grafanaTemplateVariableFn:{kind:"UnknownQuery",rawQuery:e}}))}))}),[o,t,s]);return(0,Q.jsx)(T._,{label:"Grafana template variable function",children:(0,Q.jsx)(we.I,{placeholder:"type a grafana template variable function, ex: Subscriptions()",value:i,onChange:e=>{n(e.target.value)},onBlur:()=>c(i)})})};var St,jt;const zt={label:"-",value:""},xt=e=>{const{query:r,onChange:t,datasource:s}=e,o=[{label:"Subscriptions",value:z.SubscriptionsQuery},{label:"Resource Groups",value:z.ResourceGroupsQuery},{label:"Namespaces",value:z.NamespacesQuery},{label:"Resource Names",value:z.ResourceNamesQuery},{label:"Metric Names",value:z.MetricNamesQuery},{label:"Workspaces",value:z.WorkspacesQuery},{label:"Resource Graph",value:z.AzureResourceGraph},{label:"Logs",value:z.LogAnalytics}];"object"==typeof e.query&&e.query.queryType===z.GrafanaTemplateVariableFn&&o.push({label:"Grafana Query Function",value:z.GrafanaTemplateVariableFn});const[i,n]=(0,a.useState)({label:"Template Variables",options:[]}),[c,u]=(0,a.useState)(!1),[d,m]=(0,a.useState)(!1),[f,h]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!1),[S,j]=(0,a.useState)([]),[x,N]=(0,a.useState)([]),[A,M]=(0,a.useState)([]),[C,G]=(0,a.useState)([]),[I,R]=K(),O="string"==typeof r?"":r.queryType;(0,a.useEffect)((()=>{wt(r,{datasource:s}).then((e=>{t(e)}))}),[r,s,t]),(0,a.useEffect)((()=>{switch(u(!1),m(!1),h(!1),v(!1),y(!1),k(!1),O){case z.ResourceGroupsQuery:case z.WorkspacesQuery:u(!0);break;case z.NamespacesQuery:u(!0),m(!0);break;case z.ResourceNamesQuery:u(!0),m(!0),h(!0);break;case z.MetricNamesQuery:u(!0),v(!0),y(!0),k(!0)}}),[O]),(0,a.useEffect)((()=>{const e=[];s.getVariablesRaw().forEach((r=>{(0,p.get)(r,"query.queryType")!==O&&e.push({label:r.label||r.name,value:`$${r.name}`})})),n({label:"Template Variables",options:e})}),[s,O]),(0,le.Z)((()=>{s.getSubscriptions().then((e=>{j(e.map((e=>({label:e.text,value:e.value}))))}))}));const D="object"==typeof r&&r.subscription;(0,a.useEffect)((()=>{D&&s.getResourceGroups(D).then((e=>{N(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,D]);const E="object"==typeof r&&r.resourceGroup||"";(0,a.useEffect)((()=>{D&&s.getMetricNamespaces(D,E).then((e=>{M(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,D,E]);const L="object"==typeof r&&r.namespace||"";if((0,a.useEffect)((()=>{D&&s.getResourceNames(D,E,L).then((e=>{G(e.map((e=>({label:e.text,value:e.value}))))}))}),[s,D,E,L]),"string"==typeof r)return null;const F=e=>{t(e)};return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(T._,{label:"Select query type",labelWidth:20,"data-testid":P.variableEditor.queryType.input,children:(0,Q.jsx)(q.Ph,{"aria-label":"select query type",onChange:e=>{e.value&&t(Object.assign({},r,{queryType:e.value,subscription:void 0,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:o,width:25,value:O})}),r.queryType===z.LogAnalytics&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(vr,{subscriptionId:r.subscription,query:r,datasource:s,onChange:F,variableOptionGroup:i,setError:R,hideFormatAs:!0}),I&&(0,Q.jsxs)(Q.Fragment,{children:[St||(St=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]}),r.queryType===z.GrafanaTemplateVariableFn&&(0,Q.jsx)(kt,{query:r,updateQuery:e.onChange,datasource:s}),c&&(0,Q.jsx)(T._,{label:"Select subscription",labelWidth:20,"data-testid":P.variableEditor.subscription.input,children:(0,Q.jsx)(q.Ph,{"aria-label":"select subscription",onChange:e=>{e.value&&t(Object.assign({},r,{subscription:e.value,resourceGroup:void 0,namespace:void 0,resource:void 0}))},options:S.concat(i),width:25,value:r.subscription||null})}),(g||d)&&(0,Q.jsx)(T._,{label:"Select resource group",labelWidth:20,"data-testid":P.variableEditor.resourceGroup.input,children:(0,Q.jsx)(q.Ph,{"aria-label":"select resource group",onChange:e=>{t(Object.assign({},r,{resourceGroup:e.value,namespace:void 0,resource:void 0}))},options:g?x.concat(i):x.concat(i,zt),width:25,value:r.resourceGroup||null,placeholder:g?void 0:"Optional"})}),(b||f)&&(0,Q.jsx)(T._,{label:"Select namespace",labelWidth:20,"data-testid":P.variableEditor.namespace.input,children:(0,Q.jsx)(q.Ph,{"aria-label":"select namespace",onChange:e=>{t(Object.assign({},r,{namespace:e.value,resource:void 0}))},options:b?A.concat(i):A.concat(i,zt),width:25,value:r.namespace||null,placeholder:b?void 0:"Optional"})}),w&&(0,Q.jsx)(T._,{label:"Select resource",labelWidth:20,"data-testid":P.variableEditor.resource.input,children:(0,Q.jsx)(q.Ph,{"aria-label":"select resource",onChange:e=>{t(Object.assign({},r,{resource:e.value}))},options:C.concat(i),width:25,value:r.resource||null})}),r.queryType===z.AzureResourceGraph&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(ie,{subscriptionId:s.azureLogAnalyticsDatasource.defaultSubscriptionId,query:r,datasource:s,onChange:F,variableOptionGroup:i,setError:R}),I&&(0,Q.jsxs)(Q.Fragment,{children:[jt||(jt=(0,Q.jsx)(me,{v:2})),(0,Q.jsx)(l.b,{severity:"error",title:"An error occurred while requesting metadata from Azure Monitor",children:I})]})]})]})};class Nt extends gt.Mg{constructor(e){var r,t,s;super(),s=xt,(t="editor")in(r=this)?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,this.datasource=e,this.datasource=e,this.query=this.query.bind(this)}query(e){return(0,Jr.D)((async()=>{const r=await wt(e.targets[0],{datasource:this.datasource});try{switch(r.queryType){case z.SubscriptionsQuery:const t=await this.datasource.getSubscriptions();return{data:null!=t&&t.length?[(0,vt.g0)(t)]:[]};case z.ResourceGroupsQuery:if(r.subscription){const e=await this.datasource.getResourceGroups(r.subscription);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}case z.NamespacesQuery:if(r.subscription){const e=await this.datasource.getMetricNamespaces(r.subscription,r.resourceGroup);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}case z.ResourceNamesQuery:if(r.subscription){const e=await this.datasource.getResourceNames(r.subscription,r.resourceGroup,r.namespace);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}case z.MetricNamesQuery:if(r.subscription&&r.resourceGroup&&r.namespace&&r.resource){const e=await this.datasource.getMetricNames(r.subscription,r.resourceGroup,r.namespace,r.resource);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}case z.WorkspacesQuery:if(r.subscription){const e=await this.datasource.getAzureLogAnalyticsWorkspaces(r.subscription);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}case z.GrafanaTemplateVariableFn:if(r.grafanaTemplateVariableFn){const e=await this.callGrafanaTemplateVariableFn(r.grafanaTemplateVariableFn);return{data:null!=e&&e.length?[(0,vt.g0)(e)]:[]}}default:e.targets[0]=r;const s=await(0,ht.n)(this.datasource.query(e));return{data:s.data,error:s.error?new Error(J(s.error)):void 0}}}catch(e){return{data:[],error:new Error(J(e))}}})())}callGrafanaTemplateVariableFn(e){return"SubscriptionsQuery"===e.kind?this.datasource.getSubscriptions():"ResourceGroupsQuery"===e.kind?this.datasource.getResourceGroups(this.replaceVariable(e.subscription)):"ResourceNamesQuery"===e.kind?this.datasource.getResourceNames(this.replaceVariable(e.subscription),this.replaceVariable(e.resourceGroup),this.replaceVariable(e.metricNamespace)):"MetricNamespaceQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNamespaces(e,!0):"MetricNamesQuery"===e.kind?this.datasource.azureMonitorDatasource.getMetricNames(e):"WorkspacesQuery"===e.kind?this.datasource.azureLogAnalyticsDatasource.getWorkspaces(this.replaceVariable(e.subscription)):null}replaceVariable(e){return(0,c.J)().replace((e||"").trim())}}function At(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class Mt extends Br.CK{constructor(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,Hr.J)();super(e),At(this,"annotations",{prepareAnnotation:ft}),At(this,"azureMonitorDatasource",void 0),At(this,"azureLogAnalyticsDatasource",void 0),At(this,"resourcePickerData",void 0),At(this,"azureResourceGraphDatasource",void 0),At(this,"pseudoDatasource",{}),this.templateSrv=r,this.azureMonitorDatasource=new ct(e),this.azureLogAnalyticsDatasource=new ot(e),this.azureResourceGraphDatasource=new ut(e),this.resourcePickerData=new mt(e,this.azureMonitorDatasource),this.pseudoDatasource={[z.AzureMonitor]:this.azureMonitorDatasource,[z.LogAnalytics]:this.azureLogAnalyticsDatasource,[z.AzureResourceGraph]:this.azureResourceGraphDatasource},this.variables=new Nt(this)}filterQuery(e){var r,t;if(!e.queryType)return!0;const s=this.pseudoDatasource[e.queryType];return null===(r=null==s||null===(t=s.filterQuery)||void 0===t?void 0:t.call(s,e))||void 0===r||r}query(e){const r=new Map;for(const t of e.targets){const s=Pr(t);if(!s.queryType||s.hide||!Ct(s))continue;if(!r.has(s.queryType)){const t=(0,p.cloneDeep)(e);t.requestId=`${t.requestId}-${s.refId}`,t.targets=[],r.set(s.queryType,t)}const o=r.get(s.queryType);null==o||o.targets.push(s)}const t=Array.from(r.entries()).map((e=>{let[r,t]=e;const s=this.pseudoDatasource[r];if(!s)throw new Error("Data source not created for query type "+r);return s.query(t)}));return 1===t.length?t[0]:t.length>1?(0,Wr.D)(t).pipe((0,_r.U)((e=>{const r=[];for(const t of e)for(const e of t.data)r.push(e);return{state:Ur.Gu.Done,data:r}}))):(0,Xr.of)({state:Ur.Gu.Done,data:[]})}targetContainsTemplate(e){if(e.subscription&&this.templateSrv.containsTemplate(e.subscription))return!0;let r;return e.queryType===z.AzureMonitor?r=JSON.stringify(e.azureMonitor):e.queryType===z.LogAnalytics?r=JSON.stringify(e.azureLogAnalytics):e.queryType===z.AzureResourceGraph&&(r=JSON.stringify([e.azureResourceGraph,e.subscriptions])),!!r&&this.templateSrv.containsTemplate(r)}async annotationQuery(e){return this.azureLogAnalyticsDatasource.annotationQuery(e)}getResourceGroups(e){return this.azureMonitorDatasource.getResourceGroups(this.templateSrv.replace(e))}getMetricNamespaces(e,r){let t=`/subscriptions/${e}`;return r&&(t+=`/resourceGroups/${r};`),this.azureMonitorDatasource.getMetricNamespaces({resourceUri:t},!0)}getResourceNames(e,r,t){return this.azureMonitorDatasource.getResourceNames(this.templateSrv.replace(e),this.templateSrv.replace(r),this.templateSrv.replace(t))}getMetricNames(e,r,t,s){return this.azureMonitorDatasource.getMetricNames({subscription:e,resourceGroup:r,metricNamespace:t,resourceName:s})}getAzureLogAnalyticsWorkspaces(e){return this.azureLogAnalyticsDatasource.getWorkspaces(e)}getSubscriptions(){return this.azureMonitorDatasource.getSubscriptions()}interpolateVariablesInQueries(e,r){return e.map((e=>{var t;if(!e.queryType)return e;const s=this.pseudoDatasource[e.queryType];return Object.assign({datasource:null==s?void 0:s.getRef()},null!==(t=null==s?void 0:s.applyTemplateVariables(e,r))&&void 0!==t?t:e)}))}getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}getVariablesRaw(){return this.templateSrv.getVariables()}}function Ct(e){switch(e.queryType){case z.AzureMonitor:return!!e.azureMonitor;case z.LogAnalytics:return!!e.azureLogAnalytics;case z.AzureResourceGraph:return!!e.azureResourceGraph;case z.GrafanaTemplateVariableFn:return!!e.grafanaTemplateVariableFn;default:return!1}}var Gt=t(14285),It=t(31181);const Rt=new s.hf(Mt).setConfigEditor(B).setQueryEditor($r);(0,i.N$)().subscribe(o.Pl,(e=>{let{payload:{dashboardId:r,orgId:t,userId:s,grafanaVersion:o,queries:i}}=e;const a=i[Gt.id];let n={[z.AzureMonitor]:{hidden:0,visible:0},[z.LogAnalytics]:{hidden:0,visible:0},[z.AzureResourceGraph]:{hidden:0,visible:0}};var c;a.forEach((e=>{e.queryType!==z.AzureMonitor&&e.queryType!==z.LogAnalytics&&e.queryType!==z.AzureResourceGraph||n[e.queryType][e.hide?"hidden":"visible"]++})),a&&a.length>0&&(c={grafana_version:o,dashboard_id:r,org_id:t,azure_monitor_queries:n[z.AzureMonitor].visible,azure_log_analytics_queries:n[z.LogAnalytics].visible,azure_resource_graph_queries:n[z.AzureResourceGraph].visible,azure_monitor_queries_hidden:n[z.AzureMonitor].hidden,azure_log_analytics_queries_hidden:n[z.LogAnalytics].hidden,azure_resource_graph_queries_hidden:n[z.AzureResourceGraph].hidden},(0,It.ff)("grafana_ds_azuremonitor_dashboard_loaded",c))}))},64421:(e,r,t)=>{function s(e){for(var r=arguments.length,t=Array(r>1?r-1:0),s=1;s<r;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+e+(t.length?" "+t.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function o(e){return!!e&&!!e[X]}function i(e){var r;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return t===Object||"function"==typeof t&&Function.toString.call(t)===_}(e)||Array.isArray(e)||!!e[W]||!!(null===(r=e.constructor)||void 0===r?void 0:r[W])||d(e)||m(e))}function a(e,r,t){void 0===t&&(t=!1),0===n(e)?(t?Object.keys:U)(e).forEach((function(s){t&&"symbol"==typeof s||r(s,e[s],e)})):e.forEach((function(t,s){return r(s,t,e)}))}function n(e){var r=e[X];return r?r.i>3?r.i-4:r.i:Array.isArray(e)?1:d(e)?2:m(e)?3:0}function c(e,r){return 2===n(e)?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function u(e,r){return 2===n(e)?e.get(r):e[r]}function l(e,r,t){var s=n(e);2===s?e.set(r,t):3===s?(e.delete(r),e.add(t)):e[r]=t}function p(e,r){return e===r?0!==e||1/e==1/r:e!=e&&r!=r}function d(e){return Q&&e instanceof Map}function m(e){return F&&e instanceof Set}function f(e){return e.o||e.t}function h(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var r=B(e);delete r[X];for(var t=U(r),s=0;s<t.length;s++){var o=t[s],i=r[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(r[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),r)}function g(e,r){return void 0===r&&(r=!1),b(e)||o(e)||!i(e)||(n(e)>1&&(e.set=e.add=e.clear=e.delete=v),Object.freeze(e),r&&a(e,(function(e,r){return g(r,!0)}),!0)),e}function v(){s(2)}function b(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function y(e){var r=H[e];return r||s(18,e),r}function w(){return E}function k(e,r){r&&(y("Patches"),e.u=[],e.s=[],e.v=r)}function S(e){j(e),e.p.forEach(x),e.p=null}function j(e){e===E&&(E=e.l)}function z(e){return E={p:[],l:E,h:e,m:!0,_:0}}function x(e){var r=e[X];0===r.i||1===r.i?r.j():r.O=!0}function N(e,r){r._=r.p.length;var t=r.p[0],o=void 0!==e&&e!==t;return r.h.g||y("ES5").S(r,e,o),o?(t[X].P&&(S(r),s(4)),i(e)&&(e=A(r,e),r.l||C(r,e)),r.u&&y("Patches").M(t[X].t,e,r.u,r.s)):e=A(r,t,[]),S(r),r.u&&r.v(r.u,r.s),e!==$?e:void 0}function A(e,r,t){if(b(r))return r;var s=r[X];if(!s)return a(r,(function(o,i){return M(e,s,r,o,i,t)}),!0),r;if(s.A!==e)return r;if(!s.P)return C(e,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=4===s.i||5===s.i?s.o=h(s.k):s.o;a(3===s.i?new Set(o):o,(function(r,i){return M(e,s,o,r,i,t)})),C(e,o,!1),t&&e.u&&y("Patches").R(s,t,e.u,e.s)}return s.o}function M(e,r,t,s,a,n){if(o(a)){var u=A(e,a,n&&r&&3!==r.i&&!c(r.D,s)?n.concat(s):void 0);if(l(t,s,u),!o(u))return;e.m=!1}if(i(a)&&!b(a)){if(!e.h.F&&e._<1)return;A(e,a),r&&r.A.l||C(e,a)}}function C(e,r,t){void 0===t&&(t=!1),e.h.F&&e.m&&g(r,t)}function G(e,r){var t=e[X];return(t?f(t):e)[r]}function I(e,r){if(r in e)for(var t=Object.getPrototypeOf(e);t;){var s=Object.getOwnPropertyDescriptor(t,r);if(s)return s;t=Object.getPrototypeOf(t)}}function R(e){e.P||(e.P=!0,e.l&&R(e.l))}function T(e){e.o||(e.o=h(e.t))}function q(e,r,t){var s=d(r)?y("MapSet").N(r,t):m(r)?y("MapSet").T(r,t):e.g?function(e,r){var t=Array.isArray(e),s={i:t?1:0,A:r?r.A:w(),P:!1,I:!1,D:{},l:r,t:e,k:null,o:null,j:null,C:!1},o=s,i=J;t&&(o=[s],i=K);var a=Proxy.revocable(o,i),n=a.revoke,c=a.proxy;return s.k=c,s.j=n,c}(r,t):y("ES5").J(r,t);return(t?t.A:w()).p.push(s),s}function O(e){return o(e)||s(22,e),function e(r){if(!i(r))return r;var t,s=r[X],o=n(r);if(s){if(!s.P&&(s.i<4||!y("ES5").K(s)))return s.t;s.I=!0,t=D(r,o),s.I=!1}else t=D(r,o);return a(t,(function(r,o){s&&u(s.t,r)===o||l(t,r,e(o))})),3===o?new Set(t):t}(e)}function D(e,r){switch(r){case 2:return new Map(e);case 3:return Array.from(e)}return h(e)}t.d(r,{ZP:()=>re});var P,E,L="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Q="undefined"!=typeof Map,F="undefined"!=typeof Set,V="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,$=L?Symbol.for("immer-nothing"):((P={})["immer-nothing"]=!0,P),W=L?Symbol.for("immer-draftable"):"__$immer_draftable",X=L?Symbol.for("immer-state"):"__$immer_state",_=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),U="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,B=Object.getOwnPropertyDescriptors||function(e){var r={};return U(e).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})),r},H={},J={get:function(e,r){if(r===X)return e;var t=f(e);if(!c(t,r))return function(e,r,t){var s,o=I(r,t);return o?"value"in o?o.value:null===(s=o.get)||void 0===s?void 0:s.call(e.k):void 0}(e,t,r);var s=t[r];return e.I||!i(s)?s:s===G(e.t,r)?(T(e),e.o[r]=q(e.A.h,s,e)):s},has:function(e,r){return r in f(e)},ownKeys:function(e){return Reflect.ownKeys(f(e))},set:function(e,r,t){var s=I(f(e),r);if(null==s?void 0:s.set)return s.set.call(e.k,t),!0;if(!e.P){var o=G(f(e),r),i=null==o?void 0:o[X];if(i&&i.t===t)return e.o[r]=t,e.D[r]=!1,!0;if(p(t,o)&&(void 0!==t||c(e.t,r)))return!0;T(e),R(e)}return e.o[r]===t&&"number"!=typeof t&&(void 0!==t||r in e.o)||(e.o[r]=t,e.D[r]=!0,!0)},deleteProperty:function(e,r){return void 0!==G(e.t,r)||r in e.t?(e.D[r]=!1,T(e),R(e)):delete e.D[r],e.o&&delete e.o[r],!0},getOwnPropertyDescriptor:function(e,r){var t=f(e),s=Reflect.getOwnPropertyDescriptor(t,r);return s?{writable:!0,configurable:1!==e.i||"length"!==r,enumerable:s.enumerable,value:t[r]}:s},defineProperty:function(){s(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){s(12)}},K={};a(J,(function(e,r){K[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),K.deleteProperty=function(e,r){return K.set.call(this,e,r,void 0)},K.set=function(e,r,t){return J.set.call(this,e[0],r,t,e[0])};var Z=function(){function e(e){var r=this;this.g=V,this.F=!0,this.produce=function(e,t,o){if("function"==typeof e&&"function"!=typeof t){var a=t;t=e;var n=r;return function(e){var r=this;void 0===e&&(e=a);for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return n.produce(e,(function(e){var s;return(s=t).call.apply(s,[r,e].concat(o))}))}}var c;if("function"!=typeof t&&s(6),void 0!==o&&"function"!=typeof o&&s(7),i(e)){var u=z(r),l=q(r,e,void 0),p=!0;try{c=t(l),p=!1}finally{p?S(u):j(u)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then((function(e){return k(u,o),N(e,u)}),(function(e){throw S(u),e})):(k(u,o),N(c,u))}if(!e||"object"!=typeof e){if(void 0===(c=t(e))&&(c=e),c===$&&(c=void 0),r.F&&g(c,!0),o){var d=[],m=[];y("Patches").M(e,c,d,m),o(d,m)}return c}s(21,e)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var s=arguments.length,o=Array(s>1?s-1:0),i=1;i<s;i++)o[i-1]=arguments[i];return r.produceWithPatches(t,(function(r){return e.apply(void 0,[r].concat(o))}))};var s,o,i=r.produce(e,t,(function(e,r){s=e,o=r}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,s,o]})):[i,s,o]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var r=e.prototype;return r.createDraft=function(e){i(e)||s(8),o(e)&&(e=O(e));var r=z(this),t=q(this,e,void 0);return t[X].C=!0,j(r),t},r.finishDraft=function(e,r){var t=(e&&e[X]).A;return k(t,r),N(void 0,t)},r.setAutoFreeze=function(e){this.F=e},r.setUseProxies=function(e){e&&!V&&s(20),this.g=e},r.applyPatches=function(e,r){var t;for(t=r.length-1;t>=0;t--){var s=r[t];if(0===s.path.length&&"replace"===s.op){e=s.value;break}}t>-1&&(r=r.slice(t+1));var i=y("Patches").$;return o(e)?i(e,r):this.produce(e,(function(e){return i(e,r)}))},e}(),Y=new Z,ee=Y.produce;Y.produceWithPatches.bind(Y),Y.setAutoFreeze.bind(Y),Y.setUseProxies.bind(Y),Y.applyPatches.bind(Y),Y.createDraft.bind(Y),Y.finishDraft.bind(Y);const re=ee}}]);
//# sourceMappingURL=8112.11c30528734a2fe7fc11.js.map