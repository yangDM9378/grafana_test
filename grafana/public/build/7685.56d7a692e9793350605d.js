"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7685],{7685:(e,t,n)=>{n.d(t,{H:()=>J});var a,r,s=n(68404),o=n(39498),i=n(8910),l=n(71031),c=n(64850),d=n(79195),u=n(52423),h=n(25004),g=n(46889),p=n(4645),f=n(70800),m=n(16755),x=n(64313),v=n(45916);function b(e){let{dataSourceName:t,isDefault:n,onDefaultChange:a,onNameChange:r,alertingSupported:s}=e;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j,{enabled:s}),(0,v.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,v.jsxs)("div",{className:"gf-form-inline",children:[(0,v.jsx)("div",{className:"gf-form max-width-30",children:(0,v.jsx)(g._,{label:"Name",tooltip:"The name is used when you select the data source in panels. The default data source is 'preselected in new panels.",grow:!0,children:(0,v.jsx)(p.I,{id:"basic-settings-name",type:"text",value:t,placeholder:"Name",onChange:e=>r(e.currentTarget.value),required:!0,"aria-label":h.wl.pages.DataSource.name})})}),(0,v.jsx)(g._,{label:"Default",labelWidth:8,children:(0,v.jsx)(f.x,{id:"basic-settings-default",value:n,onChange:e=>{a(e.currentTarget.checked)}})})]})})]})}function j(e){let{enabled:t}=e;const n=(0,m.wW)(S);return(0,v.jsx)("div",{className:n.badge,children:t?a||(a=(0,v.jsx)(x.C,{color:"green",icon:"check-circle",text:"Alerting supported"})):r||(r=(0,v.jsx)(x.C,{color:"orange",icon:"exclamation-triangle",text:"Alerting not supported"}))})}const S=e=>({badge:u.css`
    margin-bottom: ${e.spacing(2)};
  `});var y=n(8006),C=n(68374);function w(e){let{canSave:t,canDelete:n,onDelete:a,onSubmit:r,onTest:s,exploreUrl:o}=e;const i=C.Vt.hasPermission(c.bW.DataSourcesExplore);return(0,v.jsxs)("div",{className:"gf-form-button-row",children:[(0,v.jsx)(y.zx,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back(),children:"Back"}),(0,v.jsx)(y.Qj,{variant:"secondary",fill:"solid",href:o,disabled:!i,children:"Explore"}),(0,v.jsx)(y.zx,{type:"button",variant:"destructive",disabled:!n,onClick:a,"aria-label":h.wl.pages.DataSource.delete,children:"Delete"}),t&&(0,v.jsx)(y.zx,{type:"submit",variant:"primary",disabled:!t,onClick:e=>r(e),"aria-label":h.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!t&&(0,v.jsx)(y.zx,{variant:"primary",onClick:s,children:"Test"})]})}let D;!function(e){e.OpenSource="Open Source",e.Pro="Pro",e.Enterprise="Enterprise"}(D||(D={}));var I=n(2843),k=n(66803),M=n(46782);function E(e){var t;let{dataSource:n}=e,a="",r="";if(n.readOnly||(null!==(t=n.version)&&void 0!==t?t:0)>2)return null;if(M.vc.buildInfo.edition!==D.OpenSource)return null;switch(n.type){case"prometheus":a="Prometheus",r="Loki";break;case"loki":a="Loki",r="Prometheus";break;default:return null}return(0,v.jsx)(k.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(e,t)=>e?null:(0,v.jsxs)(I.b,{title:`Configure your ${a} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{t(!0)},children:["Or skip the effort and get ",a," (and ",r,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,v.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${n.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})}function O(){return(0,v.jsx)(I.b,{"aria-label":h.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}var N,P;function T(e){let{dataSourceRights:t,onDelete:n}=e;const{readOnly:a,hasDeleteRights:r}=t,s=!a&&r;return(0,v.jsxs)(v.Fragment,{children:[a&&(N||(N=(0,v.jsx)(O,{}))),(0,v.jsxs)("div",{className:"gf-form-button-row",children:[s&&(0,v.jsx)(y.zx,{type:"submit",variant:"destructive",onClick:n,children:"Delete"}),(0,v.jsx)(y.zx,{variant:"secondary",fill:"outline",type:"button",onClick:()=>history.back(),children:"Back"})]})]})}function U(){return P||(P=(0,v.jsx)(I.b,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}function B(e){let{plugin:t,pageId:n}=e;if(!t||!t.configPages)return null;const a=t.configPages.find((e=>{let{id:t}=e;return t===n}));return a?(0,v.jsx)(a.body,{plugin:t,query:{}}):(0,v.jsxs)("div",{children:["Page not found: ",a]})}var V=n(82897),z=n(70194);function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A extends s.PureComponent{constructor(e){super(e),q(this,"element",null),q(this,"component",void 0),q(this,"scopeProps",void 0),q(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,V.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,z.w)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var n;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,V.cloneDeep)(this.props.dataSource),null===(n=this.component)||void 0===n||n.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,v.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&s.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var R,Y,W,F,_=n(35390);function $(e){let{state:t}=e;return(0,v.jsxs)("div",{className:"gf-form",children:[R||(R=(0,v.jsx)("div",{className:"gf-form-label width-10",children:"Plugin state"})),(0,v.jsx)("div",{className:"gf-form-label gf-form-label--transparent",children:(0,v.jsx)(_.u,{state:t})})]})}function H(e){var t,n;let{testingStatus:a}=e;const r="error"===(null==a?void 0:a.status),s=null==a?void 0:a.message,o=null==a||null===(t=a.details)||void 0===t?void 0:t.message,i=null==a||null===(n=a.details)||void 0===n?void 0:n.verboseMessage;return s?(0,v.jsx)("div",{className:"gf-form-group p-t-2",children:(0,v.jsx)(I.b,{severity:r?"error":"success",title:s,"aria-label":h.wl.pages.DataSource.alert,children:(null==a?void 0:a.details)&&(0,v.jsxs)(v.Fragment,{children:[o,i?(0,v.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:i}):null]})})}):null}function J(e){let{uid:t,pageId:n}=e;(0,d.E)(t);const a=(0,c.I0)(),r=(0,d.wl)(t),s=(0,d.Qs)(r.type),o=(0,d._l)(),i=(0,d.YY)(t),l=(0,d.IA)(t),u=(0,d.q6)(),h=(0,d.hw)(t),g=(0,d.qj)();return(0,v.jsx)(G,{pageId:n,dataSource:r,dataSourceMeta:s,dataSourceSettings:o,dataSourceRights:i,exploreUrl:l,onDelete:u,onDefaultChange:e=>a((0,d.yr)(e)),onNameChange:e=>a((0,d.BX)(e)),onOptionsChange:e=>a((0,d.rl)(e)),onTest:h,onUpdate:g})}function G(e){var t,n,a;let{pageId:r,dataSource:s,dataSourceMeta:c,dataSourceSettings:d,dataSourceRights:u,exploreUrl:h,onDelete:g,onDefaultChange:p,onNameChange:f,onOptionsChange:m,onTest:x,onUpdate:j}=e;const{plugin:S,loadError:y,testingStatus:C,loading:D}=d,{readOnly:I,hasWriteRights:k,hasDeleteRights:M}=u,N=s.id>0,P=null===(t=(0,i.F)())||void 0===t?void 0:t.getInstanceSettings(s.uid),V=Boolean(null!==(n=null==P||null===(a=P.meta)||void 0===a?void 0:a.alerting)&&void 0!==n&&n),z="alertmanager"===(null==P?void 0:P.type),q=V||z,R=async e=>{e.preventDefault(),await j(Object.assign({},s)),x()};return y?(0,v.jsx)(T,{dataSourceRights:u,onDelete:g}):D?Y||(Y=(0,v.jsx)(l.Z,{})):N&&P?r?(0,v.jsxs)(o.n,{instanceSettings:P,children:[(0,v.jsx)(B,{pageId:r,plugin:S}),";"]}):(0,v.jsxs)("form",{onSubmit:R,children:[!k&&(W||(W=(0,v.jsx)(U,{}))),I&&(F||(F=(0,v.jsx)(O,{}))),c.state&&(0,v.jsx)($,{state:c.state}),(0,v.jsx)(E,{dataSource:s}),(0,v.jsx)(b,{dataSourceName:s.name,isDefault:s.isDefault,onDefaultChange:p,onNameChange:f,alertingSupported:q}),S&&(0,v.jsx)(o.n,{instanceSettings:P,children:(0,v.jsx)(A,{plugin:S,dataSource:s,dataSourceMeta:c,onModelChange:m})}),(0,v.jsx)(H,{testingStatus:C}),(0,v.jsx)(w,{onSubmit:R,onDelete:g,onTest:x,exploreUrl:h,canSave:!I&&k,canDelete:!I&&M})]}):null}},46732:(e,t,n)=>{n.d(t,{V:()=>s});var a=n(68404),r=n(65022);const s=(0,a.createContext)(r.n)},46216:(e,t,n)=>{n.d(t,{E:()=>m,IA:()=>D,MF:()=>M,OU:()=>j,Qs:()=>I,YY:()=>E,_l:()=>k,d7:()=>O,hw:()=>x,nH:()=>S,q6:()=>C,qj:()=>y,wi:()=>b,wl:()=>w,zJ:()=>v});var a=n(68404),r=n(274),s=n(40264),o=n(2247),i=n(68374),l=n(85829),c=n(64850),d=n(8105),u=n(5316),h=n(46732),g=n(93220),p=n(46525),f=n(23940);const m=e=>{const t=(0,c.I0)();(0,a.useEffect)((()=>(t((0,u.M9)(e)),function(){t((0,s.e)({cleanupAction:e=>e.dataSourceSettings=p.fk}))})),[e,t])},x=e=>{const t=(0,c.I0)();return()=>t((0,u.kY)(e))},v=()=>{const e=(0,c.I0)();(0,a.useEffect)((()=>{e((0,u.bZ)())}),[e])},b=e=>{const t=(0,c.I0)();(0,a.useEffect)((()=>{t((0,u.gv)(e))}),[t,e])},j=()=>{const e=(0,c.I0)();(0,a.useEffect)((()=>{e((0,u.Kj)())}),[e])},S=()=>{const e=(0,c.I0)(),t=O();return n=>{e((0,u.J_)(n,t.Edit))}},y=()=>{const e=(0,c.I0)();return async t=>e((0,u.oe)(t))},C=()=>{const e=(0,c.I0)(),{name:t}=(0,c.v9)((e=>e.dataSources.dataSource));return()=>{o.Z.publish(new d.VJ({title:"Delete",text:`Are you sure you want to delete the "${t}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>e((0,u.F5)())}))}},w=e=>(0,c.v9)((t=>(0,f.f6)(t.dataSources,e))),D=e=>{const t=w(e),n=JSON.stringify({datasource:t.name,context:"explore"});return r.Cj.renderUrl("/explore",{left:n})},I=e=>(0,c.v9)((t=>(0,f.G4)(t.dataSources,e))),k=()=>(0,c.v9)((e=>e.dataSourceSettings)),M=(e,t)=>{const n=w(e),{plugin:a,loadError:r,loading:s}=k(),o=(0,c.v9)((e=>e.navIndex)),i=t?`datasource-${t}-${e}`:`datasource-settings-${e}`;if(r){const e={text:r,subTitle:"Data Source Error",icon:"exclamation-triangle"};return{node:e,main:e}}return s||!a?(0,l.ht)(o,i,(0,g.xG)("settings")):(0,l.ht)(o,i,(0,g.nI)((0,g.B1)(n,a),t||"settings"))},E=e=>{const t=w(e);return{readOnly:!0===t.readOnly,hasWriteRights:i.Vt.hasPermissionInMetadata(c.bW.DataSourcesWrite,t),hasDeleteRights:i.Vt.hasPermissionInMetadata(c.bW.DataSourcesDelete,t)}},O=()=>(0,a.useContext)(h.V)},79195:(e,t,n)=>{n.d(t,{BX:()=>s.BX,E:()=>r.E,Ht:()=>s.Ht,I5:()=>o.I5,IA:()=>r.IA,IO:()=>o.IO,MF:()=>r.MF,OU:()=>r.OU,Qs:()=>r.Qs,Vj:()=>a.V,YY:()=>r.YY,_l:()=>r._l,d7:()=>r.d7,hw:()=>r.hw,mt:()=>o.mt,nH:()=>r.nH,q6:()=>r.q6,qj:()=>r.qj,r7:()=>o.r7,rl:()=>s.rl,wi:()=>r.wi,wl:()=>r.wl,yr:()=>s.yr,zJ:()=>r.zJ,zT:()=>s.zT});n(5316);var a=n(46732),r=n(46216),s=(n(93220),n(46525)),o=n(23940)},35390:(e,t,n)=>{n.d(t,{u:()=>o});n(68404);var a=n(15546),r=n(64313),s=n(45916);const o=e=>{const t=function(e){switch(e){case a.BV.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case a.BV.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case a.BV.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,s.jsx)(r.C,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=7685.56d7a692e9793350605d.js.map