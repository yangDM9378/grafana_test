"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{62232:(e,s,r)=>{r.d(s,{Z:()=>D,v:()=>N});var n,a,i,t,l=r(52423),o=r(68404),d=r(54316),c=r(25004),h=r(65737),u=r(3218),m=r(71980),x=r(65678),g=r(37625),f=r(83744),j=r(82261),p=r(48239),b=r(14402),v=r(70917),y=r(8006),C=r(50191),w=r(71438),U=r(35448),S=r(89103),k=r(13498),L=r(45916);function z(e,s,r){return s in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}const P=[{value:"",label:(0,U.t)("shared-preferences.theme.default-label","Default")},{value:"dark",label:(0,U.t)("shared-preferences.theme.dark-label","Dark")},{value:"light",label:(0,U.t)("shared-preferences.theme.light-label","Light")}];const I=Boolean(h.v.featureToggles.internationalization);class N extends o.PureComponent{constructor(e){super(e),z(this,"service",void 0),z(this,"onSubmitForm",(async()=>{if(!this.props.onConfirm||await this.props.onConfirm()){const{homeDashboardUID:e,theme:s,timezone:r,weekStart:n,locale:a,queryHistory:i}=this.state;await this.service.update({homeDashboardUID:e,theme:s,timezone:r,weekStart:n,locale:a,queryHistory:i}),window.location.reload()}})),z(this,"onThemeChanged",(e=>{this.setState({theme:e})})),z(this,"onTimeZoneChanged",(e=>{e&&this.setState({timezone:e})})),z(this,"onWeekStartChanged",(e=>{this.setState({weekStart:e})})),z(this,"onHomeDashboardChanged",(e=>{this.setState({homeDashboardUID:e})})),z(this,"onLocaleChanged",(e=>{this.setState({locale:e})})),this.service=new k.y(e.resourceUri),this.state={theme:"",timezone:"",weekStart:"",locale:"",queryHistory:{homeTab:""}}}async componentDidMount(){const e=await this.service.load();this.setState({homeDashboardUID:e.homeDashboardUID,theme:e.theme,timezone:e.timezone,weekStart:e.weekStart,locale:e.locale,queryHistory:e.queryHistory})}render(){const{theme:e,timezone:s,weekStart:r,homeDashboardUID:l,locale:o}=this.state,{disabled:h}=this.props,C=K(),k=function(){const e=S.lE.map((e=>({value:e.code,label:e.name})));return[{value:"",label:(0,U.t)("common.locale.default","Default")},...e]}();return(0,L.jsx)(u.l,{onSubmit:this.onSubmitForm,children:()=>{var u;return(0,L.jsxs)(m.C,{label:n||(n=(0,L.jsx)(U.cC,{i18nKey:"shared-preferences.title",children:"Preferences"})),disabled:h,children:[(0,L.jsx)(x.g,{label:(0,U.t)("shared-preferences.fields.theme-label","UI Theme"),children:(0,L.jsx)(g.S,{options:P,value:null===(u=P.find((s=>s.value===e)))||void 0===u?void 0:u.value,onChange:this.onThemeChanged})}),(0,L.jsx)(x.g,{label:(0,L.jsx)(f._,{htmlFor:"home-dashboard-select",children:(0,L.jsx)("span",{className:C.labelText,children:a||(a=(0,L.jsx)(U.cC,{i18nKey:"shared-preferences.fields.home-dashboard-label",children:"Home Dashboard"}))})}),"data-testid":"User preferences home dashboard drop down",children:(0,L.jsx)(w.o,{value:l,onChange:e=>{var s;return this.onHomeDashboardChanged(null!==(s=null==e?void 0:e.uid)&&void 0!==s?s:"")},defaultOptions:!0,isClearable:!0,placeholder:(0,U.t)("shared-preferences.fields.home-dashboard-placeholder","Default dashboard"),inputId:"home-dashboard-select"})}),(0,L.jsx)(x.g,{label:(0,U.t)("shared-dashboard.fields.timezone-label","Timezone"),"data-testid":c.wl.components.TimeZonePicker.containerV2,children:(0,L.jsx)(j.O,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,L.jsx)(x.g,{label:(0,U.t)("shared-preferences.fields.week-start-label","Week start"),"data-testid":c.wl.components.WeekStartPicker.containerV2,children:(0,L.jsx)(p.z,{value:r,onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),I?(0,L.jsx)(x.g,{label:(0,L.jsxs)(f._,{htmlFor:"locale-select",children:[(0,L.jsx)("span",{className:C.labelText,children:i||(i=(0,L.jsx)(U.cC,{i18nKey:"shared-preferences.fields.locale-label",children:"Language"}))}),(0,L.jsx)(b.a,{featureState:d.CQ.beta})]}),"data-testid":"User preferences language drop down",children:(0,L.jsx)(v.Ph,{value:k.find((e=>e.value===o)),onChange:e=>{var s;return this.onLocaleChanged(null!==(s=e.value)&&void 0!==s?s:"")},options:k,placeholder:(0,U.t)("shared-preferences.fields.locale-placeholder","Choose language"),inputId:"locale-select"})}):null,(0,L.jsx)("div",{className:"gf-form-button-row",children:(0,L.jsx)(y.zx,{type:"submit",variant:"primary","data-testid":c.wl.components.UserProfile.preferencesSaveButton,children:t||(t=(0,L.jsx)(U.cC,{i18nKey:"common.save",children:"Save"}))})})]})}})}}const D=N,K=(0,C.B)((()=>({labelText:l.css`
      margin-right: 6px;
    `})))},94892:(e,s,r)=>{r.r(s),r.d(s,{UserProfileEditPage:()=>ee,default:()=>se});var n,a,i,t,l,o=r(68404),d=r(36635),c=r(50986),h=r(54761),u=r(37417),m=r(62232),x=r(25004),g=r(38953),f=r(8006),j=r(35448),p=r(45916);class b extends o.PureComponent{render(){const{isLoading:e,orgs:s,user:r}=this.props;return e?n||(n=(0,p.jsx)(g.u,{text:"Loading organizations..."})):0===s.length?null:(0,p.jsxs)("div",{children:[a||(a=(0,p.jsx)("h3",{className:"page-sub-heading",children:(0,p.jsx)(j.cC,{i18nKey:"user-orgs.title",children:"Organizations"})})),(0,p.jsx)("div",{className:"gf-form-group",children:(0,p.jsxs)("table",{className:"filter-table form-inline","data-testid":x.wl.components.UserProfile.orgsTable,children:[i||(i=(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-orgs.name-column",children:"Name"})}),(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-orgs.role-column",children:"Role"})}),(0,p.jsx)("th",{})]})})),(0,p.jsx)("tbody",{children:s.map(((e,s)=>(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:e.name}),(0,p.jsx)("td",{children:e.role}),(0,p.jsx)("td",{className:"text-right",children:e.orgId===(null==r?void 0:r.orgId)?t||(t=(0,p.jsx)(f.zx,{variant:"secondary",size:"sm",disabled:!0,children:(0,p.jsx)(j.cC,{i18nKey:"user-orgs.current-org-button",children:"Current"})})):(0,p.jsx)(f.zx,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(e)},children:l||(l=(0,p.jsx)(j.cC,{i18nKey:"user-orgs.select-org-button",children:"Select organisation"}))})})]},s)))})]})})]})}}const v=b;var y,C,w,U,S,k,L,z,P=r(3218),I=r(71980),N=r(65678),D=r(4645),K=r(21888),T=r(99500),O=r(46782);const{disableLoginForm:A}=O.ZP,q=e=>{var s;let{user:r,isSavingUser:n,updateProfile:a}=e;const i=null!==(s=r&&r.isExternal)&&void 0!==s&&s,t=i&&r&&r.authLabels?r.authLabels[0]:"",l=t?` (Synced via ${t})`:"",o=A||i;return(0,p.jsx)(P.l,{onSubmit:e=>{a(e)},validateOn:"onBlur",children:e=>{var s,a,i;let{register:t,errors:d}=e;return(0,p.jsxs)(I.C,{label:y||(y=(0,p.jsx)(j.cC,{i18nKey:"user-profile.title",children:"Edit profile"})),children:[(0,p.jsx)(N.g,{label:(0,j.t)("user-profile.fields.name-label","Name")+l,invalid:!!d.name,error:C||(C=(0,p.jsx)(j.cC,{i18nKey:"user-profile.fields.name-error",children:"Name is required"})),disabled:o,children:(0,p.jsx)(D.I,Object.assign({},t("name",{required:!0}),{id:"edit-user-profile-name",placeholder:(0,j.t)("user-profile.fields.name-label","Name"),defaultValue:null!==(s=null==r?void 0:r.name)&&void 0!==s?s:"",suffix:w||(w=(0,p.jsx)(Z,{}))}))}),(0,p.jsx)(N.g,{label:(0,j.t)("user-profile.fields.email-label","Email")+l,invalid:!!d.email,error:U||(U=(0,p.jsx)(j.cC,{i18nKey:"user-profile.fields.email-error",children:"Email is required"})),disabled:o,children:(0,p.jsx)(D.I,Object.assign({},t("email",{required:!0}),{id:"edit-user-profile-email",placeholder:(0,j.t)("user-profile.fields.email-label","Email"),defaultValue:null!==(a=null==r?void 0:r.email)&&void 0!==a?a:"",suffix:S||(S=(0,p.jsx)(Z,{}))}))}),(0,p.jsx)(N.g,{label:(0,j.t)("user-profile.fields.username-label","Username")+l,disabled:o,children:(0,p.jsx)(D.I,Object.assign({},t("login"),{id:"edit-user-profile-username",defaultValue:null!==(i=null==r?void 0:r.login)&&void 0!==i?i:"",placeholder:(0,j.t)("user-profile.fields.username-label","Username")+l,suffix:k||(k=(0,p.jsx)(Z,{}))}))}),(0,p.jsx)("div",{className:"gf-form-button-row",children:(0,p.jsx)(f.zx,{variant:"primary",disabled:n||o,"data-testid":x.wl.components.UserProfile.profileSaveButton,type:"submit",children:L||(L=(0,p.jsx)(j.cC,{i18nKey:"common.save",children:"Save"}))})})]})}})},Z=()=>A?z||(z=(0,p.jsx)(K.u,{content:"Login details locked because they are managed in another system.",children:(0,p.jsx)(T.J,{name:"lock"})})):null;var E,H,B,F,V,W=r(36509);class $ extends o.PureComponent{render(){const{isLoading:e,sessions:s,revokeUserSession:r}=this.props;return e?E||(E=(0,p.jsx)(g.u,{text:(0,p.jsx)(j.cC,{i18nKey:"user-sessions.loading",children:"Loading sessions..."})})):(0,p.jsx)("div",{children:s.length>0&&(0,p.jsxs)(p.Fragment,{children:[H||(H=(0,p.jsx)("h3",{className:"page-sub-heading",children:"Sessions"})),(0,p.jsx)("div",{className:"gf-form-group",children:(0,p.jsxs)("table",{className:"filter-table form-inline","data-testid":x.wl.components.UserProfile.sessionsTable,children:[B||(B=(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-session.seen-at-column",children:"Last seen"})}),(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-session.created-at-column",children:"Logged on"})}),(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-session.ip-column",children:"IP address"})}),(0,p.jsx)("th",{children:(0,p.jsx)(j.cC,{i18nKey:"user-session.browser-column",children:"Browser & OS"})}),(0,p.jsx)("th",{})]})})),(0,p.jsx)("tbody",{children:s.map(((e,s)=>(0,p.jsxs)("tr",{children:[e.isActive?F||(F=(0,p.jsx)("td",{children:"Now"})):(0,p.jsx)("td",{children:e.seenAt}),(0,p.jsx)("td",{children:(0,j.$q)(e.createdAt,{dateStyle:"long"})}),(0,p.jsx)("td",{children:e.clientIp}),(0,p.jsxs)("td",{children:[e.browser," on ",e.os," ",e.osVersion]}),(0,p.jsx)("td",{children:(0,p.jsx)(f.zx,{size:"sm",variant:"destructive",onClick:()=>r(e.id),"aria-label":(0,W.t)("user-session.revoke","Revoke user session"),children:V||(V=(0,p.jsx)(T.J,{name:"power"}))})})]},s)))})]})})]})})}}const _=$;var J,M,R;class Q extends o.PureComponent{render(){const{isLoading:e,teams:s}=this.props;return e?J||(J=(0,p.jsx)(g.u,{text:"Loading teams..."})):0===s.length?null:(0,p.jsxs)("div",{children:[M||(M=(0,p.jsx)("h3",{className:"page-sub-heading",children:"Teams"})),(0,p.jsx)("div",{className:"gf-form-group",children:(0,p.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[R||(R=(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{}),(0,p.jsx)("th",{children:"Name"}),(0,p.jsx)("th",{children:"Email"}),(0,p.jsx)("th",{children:"Members"})]})})),(0,p.jsx)("tbody",{children:s.map(((e,s)=>(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{className:"width-4 text-center",children:(0,p.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:""})}),(0,p.jsx)("td",{children:e.name}),(0,p.jsx)("td",{children:e.email}),(0,p.jsx)("td",{children:e.memberCount})]},s)))})]})})]})}}var G,X=r(63273);const Y={initUserProfilePage:X.PA,revokeUserSession:X.cc,changeUserOrg:X.hz,updateUserProfile:X.Lj};function ee(e){let{orgsAreLoading:s,sessionsAreLoading:r,teamsAreLoading:n,initUserProfilePage:a,orgs:i,sessions:t,teams:l,isUpdating:o,user:d,revokeUserSession:x,changeUserOrg:g,updateUserProfile:f}=e;return(0,c.Z)((()=>a())),(0,p.jsx)(u.T,{navId:"profile/settings",children:(0,p.jsx)(u.T.Contents,{isLoading:!d,children:(0,p.jsxs)(h.wc,{spacing:"md",children:[(0,p.jsx)(q,{updateProfile:f,isSavingUser:o,user:d}),G||(G=(0,p.jsx)(m.Z,{resourceUri:"user"})),(0,p.jsx)(Q,{isLoading:n,teams:l}),(0,p.jsx)(v,{isLoading:s,setUserOrg:g,orgs:i,user:d}),(0,p.jsx)(_,{isLoading:r,revokeUserSession:x,sessions:t})]})})})}const se=(0,d.connect)((function(e){const s=e.user,{user:r,teams:n,orgs:a,sessions:i,teamsAreLoading:t,orgsAreLoading:l,sessionsAreLoading:o,isUpdating:d}=s;return{orgsAreLoading:l,sessionsAreLoading:o,teamsAreLoading:t,orgs:a,sessions:i,teams:n,isUpdating:d,user:r}}),Y)(ee)},63273:(e,s,r)=>{r.d(s,{Cp:()=>t,II:()=>o,Lj:()=>h,PA:()=>l,cc:()=>d,hz:()=>c});var n=r(65737),a=r(40455),i=r(69638);function t(e){return async function(s){s((0,i.zc)({updating:!0})),await a.h.changePassword(e),s((0,i.zc)({updating:!1}))}}function l(){return async function(e){await e(o()),e((async function(e){e((0,i.qD)());const s=await a.h.loadTeams();e((0,i.PL)({teams:s}))})),e((async function(e){e((0,i.$S)());const s=await a.h.loadOrgs();e((0,i.Ns)({orgs:s}))})),e((async function(e){e((0,i.Uk)());const s=await a.h.loadSessions();e((0,i.z0)({sessions:s}))}))}}function o(){return async function(e){const s=await a.h.loadUser();e((0,i.aw)({user:s}))}}function d(e){return async function(s){s((0,i.zc)({updating:!0})),await a.h.revokeUserSession(e),s((0,i.p$)({tokenId:e}))}}function c(e){return async function(s){s((0,i.zc)({updating:!0})),await a.h.setUserOrg(e),window.location.href=n.v.appSubUrl+"/profile"}}function h(e){return async function(s){s((0,i.zc)({updating:!0})),await a.h.updateUserProfile(e),await s(o()),s((0,i.zc)({updating:!1}))}}},50986:(e,s,r)=>{r.d(s,{Z:()=>a});var n=r(31423);const a=function(e){(0,n.Z)((function(){e()}))}}}]);
//# sourceMappingURL=UserProfileEditPage.28f6f599a938e9796210.js.map