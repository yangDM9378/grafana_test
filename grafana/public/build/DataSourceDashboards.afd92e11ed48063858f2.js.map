{"version":3,"file":"DataSourceDashboards.afd92e11ed48063858f2.js","mappings":"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","sources":["webpack://grafana/./public/app/features/datasources/components/DashboardsTable.tsx","webpack://grafana/./public/app/features/datasources/components/DataSourceDashboards.tsx","webpack://grafana/./public/app/features/datasources/pages/DataSourceDashboardsPage.tsx","webpack://grafana/./public/app/features/datasources/state/contexts.ts","webpack://grafana/./public/app/features/datasources/state/hooks.ts"],"sourcesContent":["import React from 'react';\n\nimport { Button, Icon } from '@grafana/ui';\nimport { PluginDashboard } from 'app/types';\n\nexport interface Props {\n  // List of plugin dashboards to show in the table\n  dashboards: PluginDashboard[];\n  // Callback used when the user clicks on importing a dashboard\n  onImport: (dashboard: PluginDashboard, overwrite: boolean) => void;\n  // Callback used when the user clicks on removing a dashboard\n  onRemove: (dashboard: PluginDashboard) => void;\n}\n\nexport function DashboardsTable({ dashboards, onImport, onRemove }: Props) {\n  function buttonText(dashboard: PluginDashboard) {\n    return dashboard.revision !== dashboard.importedRevision ? 'Update' : 'Re-import';\n  }\n\n  return (\n    <table className=\"filter-table\">\n      <tbody>\n        {dashboards.map((dashboard, index) => {\n          return (\n            <tr key={`${dashboard.dashboardId}-${index}`}>\n              <td className=\"width-1\">\n                <Icon name=\"apps\" />\n              </td>\n              <td>\n                {dashboard.imported ? (\n                  <a href={dashboard.importedUrl}>{dashboard.title}</a>\n                ) : (\n                  <span>{dashboard.title}</span>\n                )}\n              </td>\n              <td style={{ textAlign: 'right' }}>\n                {!dashboard.imported ? (\n                  <Button variant=\"secondary\" size=\"sm\" onClick={() => onImport(dashboard, false)}>\n                    Import\n                  </Button>\n                ) : (\n                  <Button variant=\"secondary\" size=\"sm\" onClick={() => onImport(dashboard, true)}>\n                    {buttonText(dashboard)}\n                  </Button>\n                )}\n                {dashboard.imported && (\n                  <Button\n                    aria-label=\"Delete dashboard\"\n                    icon=\"trash-alt\"\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    onClick={() => onRemove(dashboard)}\n                  />\n                )}\n              </td>\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n}\n\nexport default DashboardsTable;\n","import React, { useEffect } from 'react';\n\nimport PageLoader from 'app/core/components/PageLoader/PageLoader';\nimport { importDashboard, removeDashboard } from 'app/features/dashboard/state/actions';\nimport { loadPluginDashboards } from 'app/features/plugins/admin/state/actions';\nimport { PluginDashboard, StoreState, useDispatch, useSelector } from 'app/types';\n\nimport DashboardTable from '../components/DashboardsTable';\nimport { useLoadDataSource } from '../state';\n\nexport type Props = {\n  // The UID of the data source\n  uid: string;\n};\n\nexport function DataSourceDashboards({ uid }: Props) {\n  useLoadDataSource(uid);\n\n  const dispatch = useDispatch();\n  const dataSource = useSelector((s: StoreState) => s.dataSources.dataSource);\n  const dashboards = useSelector((s: StoreState) => s.plugins.dashboards);\n  const isLoading = useSelector((s: StoreState) => s.plugins.isLoadingPluginDashboards);\n\n  useEffect(() => {\n    // Load plugin dashboards only when the datasource has loaded\n    if (dataSource.id > 0) {\n      dispatch(loadPluginDashboards());\n    }\n  }, [dispatch, dataSource]);\n\n  const onImportDashboard = (dashboard: PluginDashboard, overwrite: boolean) => {\n    dispatch(\n      importDashboard(\n        {\n          pluginId: dashboard.pluginId,\n          path: dashboard.path,\n          overwrite,\n          inputs: [\n            {\n              name: '*',\n              type: 'datasource',\n              pluginId: dataSource.type,\n              value: dataSource.name,\n            },\n          ],\n        },\n        dashboard.title\n      )\n    );\n  };\n\n  const onRemoveDashboard = ({ uid }: PluginDashboard) => {\n    dispatch(removeDashboard(uid));\n  };\n\n  return (\n    <DataSourceDashboardsView\n      dashboards={dashboards}\n      isLoading={isLoading}\n      onImportDashboard={onImportDashboard}\n      onRemoveDashboard={onRemoveDashboard}\n    />\n  );\n}\n\nexport type ViewProps = {\n  isLoading: boolean;\n  dashboards: PluginDashboard[];\n  onImportDashboard: (dashboard: PluginDashboard, overwrite: boolean) => void;\n  onRemoveDashboard: (dashboard: PluginDashboard) => void;\n};\n\nexport const DataSourceDashboardsView = ({\n  isLoading,\n  dashboards,\n  onImportDashboard,\n  onRemoveDashboard,\n}: ViewProps) => {\n  if (isLoading) {\n    return <PageLoader />;\n  }\n\n  return <DashboardTable dashboards={dashboards} onImport={onImportDashboard} onRemove={onRemoveDashboard} />;\n};\n","import React from 'react';\n\nimport { Page } from 'app/core/components/Page/Page';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\n\nimport { DataSourceDashboards } from '../components/DataSourceDashboards';\nimport { useDataSourceSettingsNav } from '../state';\n\nexport interface Props extends GrafanaRouteComponentProps<{ uid: string }> {}\n\nexport function DataSourceDashboardsPage(props: Props) {\n  const uid = props.match.params.uid;\n  const nav = useDataSourceSettingsNav(uid, 'dashboards');\n\n  return (\n    <Page navId=\"datasources\" pageNav={nav.main}>\n      <Page.Contents>\n        <DataSourceDashboards uid={uid} />\n      </Page.Contents>\n    </Page>\n  );\n}\n\nexport default DataSourceDashboardsPage;\n","import { createContext } from 'react';\n\nimport { DATASOURCES_ROUTES } from '../constants';\nimport { DataSourcesRoutes } from '../types';\n\n// The purpose of this context is to be able to override the data-sources routes (used for links for example) used under\n// the app/features/datasources modules, so we can reuse them more easily in different parts of the application (e.g. under Connections)\nexport const DataSourcesRoutesContext = createContext<DataSourcesRoutes>(DATASOURCES_ROUTES);\n","import { useContext, useEffect } from 'react';\n\nimport { DataSourcePluginMeta, DataSourceSettings, NavModelItem, urlUtil } from '@grafana/data';\nimport { cleanUpAction } from 'app/core/actions/cleanUp';\nimport appEvents from 'app/core/app_events';\nimport { contextSrv } from 'app/core/core';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { AccessControlAction, useDispatch, useSelector } from 'app/types';\nimport { ShowConfirmModalEvent } from 'app/types/events';\n\nimport { DataSourceRights } from '../types';\n\nimport {\n  initDataSourceSettings,\n  testDataSource,\n  loadDataSource,\n  loadDataSources,\n  loadDataSourcePlugins,\n  addDataSource,\n  updateDataSource,\n  deleteLoadedDataSource,\n} from './actions';\nimport { DataSourcesRoutesContext } from './contexts';\nimport { getDataSourceLoadingNav, buildNavModel, getDataSourceNav } from './navModel';\nimport { initialDataSourceSettingsState } from './reducers';\nimport { getDataSource, getDataSourceMeta } from './selectors';\n\nexport const useInitDataSourceSettings = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(initDataSourceSettings(uid));\n\n    return function cleanUp() {\n      dispatch(\n        cleanUpAction({\n          cleanupAction: (state) => (state.dataSourceSettings = initialDataSourceSettingsState),\n        })\n      );\n    };\n  }, [uid, dispatch]);\n};\n\nexport const useTestDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  return () => dispatch(testDataSource(uid));\n};\n\nexport const useLoadDataSources = () => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSources());\n  }, [dispatch]);\n};\n\nexport const useLoadDataSource = (uid: string) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSource(uid));\n  }, [dispatch, uid]);\n};\n\nexport const useLoadDataSourcePlugins = () => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(loadDataSourcePlugins());\n  }, [dispatch]);\n};\n\nexport const useAddDatasource = () => {\n  const dispatch = useDispatch();\n  const dataSourcesRoutes = useDataSourcesRoutes();\n\n  return (plugin: DataSourcePluginMeta) => {\n    dispatch(addDataSource(plugin, dataSourcesRoutes.Edit));\n  };\n};\n\nexport const useUpdateDatasource = () => {\n  const dispatch = useDispatch();\n\n  return async (dataSource: DataSourceSettings) => dispatch(updateDataSource(dataSource));\n};\n\nexport const useDeleteLoadedDataSource = () => {\n  const dispatch = useDispatch();\n  const { name } = useSelector((state) => state.dataSources.dataSource);\n\n  return () => {\n    appEvents.publish(\n      new ShowConfirmModalEvent({\n        title: 'Delete',\n        text: `Are you sure you want to delete the \"${name}\" data source?`,\n        yesText: 'Delete',\n        icon: 'trash-alt',\n        onConfirm: () => dispatch(deleteLoadedDataSource()),\n      })\n    );\n  };\n};\n\nexport const useDataSource = (uid: string) => {\n  return useSelector((state) => getDataSource(state.dataSources, uid));\n};\n\nexport const useDataSourceExploreUrl = (uid: string) => {\n  const dataSource = useDataSource(uid);\n  const exploreState = JSON.stringify({ datasource: dataSource.name, context: 'explore' });\n  const exploreUrl = urlUtil.renderUrl('/explore', { left: exploreState });\n\n  return exploreUrl;\n};\n\nexport const useDataSourceMeta = (pluginType: string): DataSourcePluginMeta => {\n  return useSelector((state) => getDataSourceMeta(state.dataSources, pluginType));\n};\n\nexport const useDataSourceSettings = () => {\n  return useSelector((state) => state.dataSourceSettings);\n};\n\nexport const useDataSourceSettingsNav = (dataSourceId: string, pageId: string | null) => {\n  const dataSource = useDataSource(dataSourceId);\n  const { plugin, loadError, loading } = useDataSourceSettings();\n  const navIndex = useSelector((state) => state.navIndex);\n  const navIndexId = pageId ? `datasource-${pageId}-${dataSourceId}` : `datasource-settings-${dataSourceId}`;\n\n  if (loadError) {\n    const node: NavModelItem = {\n      text: loadError,\n      subTitle: 'Data Source Error',\n      icon: 'exclamation-triangle',\n    };\n\n    return {\n      node: node,\n      main: node,\n    };\n  }\n\n  if (loading || !plugin) {\n    return getNavModel(navIndex, navIndexId, getDataSourceLoadingNav('settings'));\n  }\n\n  return getNavModel(navIndex, navIndexId, getDataSourceNav(buildNavModel(dataSource, plugin), pageId || 'settings'));\n};\n\nexport const useDataSourceRights = (uid: string): DataSourceRights => {\n  const dataSource = useDataSource(uid);\n  const readOnly = dataSource.readOnly === true;\n  const hasWriteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesWrite, dataSource);\n  const hasDeleteRights = contextSrv.hasPermissionInMetadata(AccessControlAction.DataSourcesDelete, dataSource);\n\n  return {\n    readOnly,\n    hasWriteRights,\n    hasDeleteRights,\n  };\n};\n\nexport const useDataSourcesRoutes = () => {\n  return useContext(DataSourcesRoutesContext);\n};\n"],"names":["dashboards","onImport","onRemove","buttonText","dashboard","revision","importedRevision","className","map","index","name","imported","href","importedUrl","title","style","textAlign","variant","size","onClick","icon","dashboardId","DataSourceDashboards","uid","useLoadDataSource","dispatch","useDispatch","dataSource","useSelector","s","dataSources","plugins","isLoading","isLoadingPluginDashboards","useEffect","id","loadPluginDashboards","DataSourceDashboardsView","onImportDashboard","overwrite","importDashboard","pluginId","path","inputs","type","value","onRemoveDashboard","removeDashboard","PageLoader","DataSourceDashboardsPage","props","match","params","nav","useDataSourceSettingsNav","Page","navId","pageNav","main","DataSourcesRoutesContext","createContext","DATASOURCES_ROUTES","useInitDataSourceSettings","initDataSourceSettings","cleanUpAction","cleanupAction","state","dataSourceSettings","initialDataSourceSettingsState","useTestDataSource","testDataSource","useLoadDataSources","loadDataSources","loadDataSource","useLoadDataSourcePlugins","loadDataSourcePlugins","useAddDatasource","dataSourcesRoutes","useDataSourcesRoutes","plugin","addDataSource","Edit","useUpdateDatasource","async","updateDataSource","useDeleteLoadedDataSource","appEvents","ShowConfirmModalEvent","text","yesText","onConfirm","deleteLoadedDataSource","useDataSource","getDataSource","useDataSourceExploreUrl","exploreState","JSON","stringify","datasource","context","urlUtil","left","useDataSourceMeta","pluginType","getDataSourceMeta","useDataSourceSettings","dataSourceId","pageId","loadError","loading","navIndex","navIndexId","node","subTitle","getNavModel","getDataSourceLoadingNav","getDataSourceNav","buildNavModel","useDataSourceRights","readOnly","hasWriteRights","contextSrv","AccessControlAction","hasDeleteRights","useContext"],"sourceRoot":""}