"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6031],{56027:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var r=n(52423),l=n(82897),o={id:"promql",extensions:[".promql"],aliases:["Prometheus","prometheus","prom","Prom","promql","Promql","promQL","PromQL"],mimetypes:[],loader:function(){return Promise.all([n.e(9870),n.e(3019)]).then(n.bind(n,59490))}},i=n(68404),u=n(3088),s=n(44288),a=n(25004),c=n(16755),d=n(82173);function f(){const e=new Map;return e.set("expandSuggestionDocs",(!0).toString()),{onDidChangeValue:e=>{},onDidChangeTarget:e=>{},onWillSaveState:e=>{},get:(t,n,r)=>{var l;return null!==(l=e.get(t))&&void 0!==l?l:r},getBoolean:(t,n,r)=>{const l=e.get(t);return void 0!==l?"true"===l:r},getNumber:(t,n,r)=>{const l=e.get(t);return void 0!==l?parseInt(l,10):r},store:(t,n,r,l)=>{null==n?e.delete(t):e.set(t,n.toString())},remove:(t,n)=>{e.delete(t)},keys:(t,n)=>Array.from(e.keys()),logStorage:()=>{console.log("logStorage: not implemented")},migrate:()=>Promise.resolve(void 0),isNew:e=>!0,flush:e=>Promise.resolve(void 0)}}let m=null;var g=n(6116),p=n(38261);class h extends Error{constructor(e){super("should never happen")}}async function y(e){return(await e.getAllMetricNames()).map((e=>({type:"METRIC_NAME",label:e.name,insertText:e.name,detail:`${e.name} : ${e.type}`,documentation:e.help})))}const v=p.r8.map((e=>{var t;return{type:"FUNCTION",label:e.label,insertText:null!==(t=e.insertText)&&void 0!==t?t:"",detail:e.detail,documentation:e.documentation}}));async function C(e){const t=await y(e);return[...v,...t]}const L=["$__interval","$__range","$__rate_interval","1m","5m","10m","30m","1h","1d"].map((e=>({type:"DURATION",label:e,insertText:e})));function b(e,t){const n=[...t];void 0!==e&&n.push({name:"__name__",value:e,op:"="});return`{${n.map((e=>`${e.name}${e.op}"${(0,g.U9)(e.value)}"`)).join(",")}}`}async function N(e,t,n,r,l){const o=await async function(e,t,n){if(void 0===e&&0===t.length)return n.getAllLabelNames();{const r=b(e,t);return await n.getSeriesLabels(r,t)}}(e,r,l);return o.map((e=>({type:"LABEL_NAME",label:e,insertText:`${e}${t}`,triggerOnInsert:n})))}async function E(e,t,n,r,l){const o=await async function(e,t,n,r){if(void 0===e&&0===n.length)return r.getLabelValues(t);{const l=b(e,n);return await r.getSeriesValues(t,l)}}(e,t,r,l);return o.map((e=>({type:"LABEL_VALUE",label:e,insertText:n?e:`"${e}"`})))}async function _(e,t){switch(e.type){case"IN_DURATION":return L;case"IN_FUNCTION":case"AT_ROOT":return C(t);case"EMPTY":{const e=await y(t),n=await async function(e){return(await e.getHistory()).slice(0,10).map((e=>({type:"HISTORY",label:e,insertText:e})))}(t);return[...n,...v,...e]}case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return async function(e,t,n){return N(e,"=",!0,t,n)}(e.metricName,e.otherLabels,t);case"IN_GROUPING":return async function(e,t,n){return N(e,"",!1,t,n)}(e.metricName,e.otherLabels,t);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return E(e.metricName,e.labelName,e.betweenQuotes,e.otherLabels,t);default:throw new h(e)}}var I=n(74899);function A(e,t){switch(t){case"parent":return e.parent;case"firstChild":return e.firstChild;case"lastChild":return e.lastChild;case"nextSibling":return e.nextSibling;default:throw new h(t)}}function T(e,t){let n=e;for(const[e,r]of t){if(n=A(n,e),null===n)return null;if(n.type.id!==r)return null}return n}function w(e,t){return t.slice(e.from,e.to)}function S(e,t){return e.every(((e,n)=>e===t[n]))}const M=[{path:[I.m$,I.m6],fun:function(e,t,n){if(function(e){return null!==B(e,0)}(e))return null;const r=T(e,[["firstChild",I.z5]]);if(null!==r){if(!t.slice(r.to,n).includes(","))return null}const l=T(e,[["parent",I.m6],["firstChild",I.tz],["firstChild",I.xb]]),o=R(e,t);if(null===l)return{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:o};return{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",metricName:w(l,t),otherLabels:o}}},{path:[I.vD],fun:function(e,t,n){return{type:"AT_ROOT"}}},{path:[I.yY],fun:function(e,t,n){return{type:"IN_FUNCTION"}}},{path:[I.nv,I.Zm],fun:P},{path:[0,I.Zm],fun:P},{path:[0,I.uM],fun:function(e,t,n){return{type:"IN_DURATION"}}},{path:[I.XT],fun:function(e,t,n){const r=T(e,[["parent",I.Ip],["parent",I.aZ]]);if(null===r)return null;const l=r.getChild(I.yY);if(null===l)return null;const o=B(l,I.tz);if(null===o)return null;const i=T(o,[["firstChild",I.xb]]);if(null===i)return null;return{type:"IN_GROUPING",metricName:w(i,t),otherLabels:[]}}}],x=new Map([[I.M5,"="],[I.f0,"=~"],[I.IJ,"!="],[I.JW,"!~"]]);function O(e,t){if(e.type.id!==I.Zm)return null;const n=T(e,[["firstChild",I.m0]]);if(null===n)return null;const r=T(n,[["nextSibling",I.e8]]);if(null===r)return null;const l=function(e){var t;const n=e.firstChild;return null===n?null:null!==(t=x.get(n.type.id))&&void 0!==t?t:null}(r);if(null===l)return null;const o=T(e,[["lastChild",I.nv]]);if(null===o)return null;const i=w(n,t),u=function(e){const t=e.slice(1,e.length-1);if(e.startsWith('"')&&e.endsWith('"'))return t.replace(/\\"/,'"');if(e.startsWith("'")&&e.endsWith("'"))return t.replace(/\\'/,"'");if(e.startsWith("`")&&e.endsWith("`"))return t;throw new Error("FIXME: invalid string literal")}(w(o,t));return{name:i,value:u,op:l}}function R(e,t){if(e.type.id!==I.m$)return[];let n=T(e,[["firstChild",I.z5]]);const r=[];for(;null!==n;){const e=T(n,[["lastChild",I.Zm]]);if(null===e)return[];const l=O(e,t);null!==l&&r.push(l),n=T(n,[["firstChild",I.z5]])}return r.reverse(),r}function B(e,t){if(e.type.id===t)return e;const n=function(e){let t=e.firstChild;const n=[];for(;null!==t;)n.push(t),t=t.nextSibling;return n}(e);for(const e of n){const n=B(e,t);if(null!==n)return n}return null}function P(e,t,n){const r=!e.type.isError,l=T(e,[["parent",I.Zm]]);if(null===l)return null;const o=T(l,[["firstChild",I.m0]]);if(null===o)return null;const i=w(o,t),u=T(l,[["parent",I.z5]]);if(null===u)return null;let s=u,a=null;for(;null===a;){const e=s.parent;if(null===e)return null;const{id:t}=e.type;switch(t){case I.z5:s=e;continue;case I.m$:a=e;continue;default:return null}}const c=R(a,t).filter((e=>e.name!==i)),d=T(a,[["parent",I.m6],["firstChild",I.tz],["firstChild",I.xb]]);if(null===d)return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:i,betweenQuotes:r,otherLabels:c};return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",metricName:w(d,t),labelName:i,betweenQuotes:r,otherLabels:c}}function $(e,t){switch(e){case"DURATION":return t.languages.CompletionItemKind.Unit;case"FUNCTION":return t.languages.CompletionItemKind.Variable;case"HISTORY":return t.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;case"METRIC_NAME":return t.languages.CompletionItemKind.Constructor;default:throw new h(e)}}function W(e,t){return{triggerCharacters:["{",",","[","(","=","~"," ",'"'],provideCompletionItems:(n,r)=>{const l=n.getWordAtPosition(r),o=null!=l?e.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:l.startColumn,endColumn:l.endColumn}):e.Range.fromPositions(r),i={column:r.column,lineNumber:r.lineNumber},u=n.getOffsetAt(i),s=function(e,t){if(""===e)return{type:"EMPTY"};const n=I.E2.parse(e),r=function(e,t){const n=e.cursorAt(t);for(;;){if(n.from===t&&n.to===t){const{node:e}=n;if(e.type.isError)return e}if(!n.next())break}return null}(n,t),l=null!=r?r.cursor():n.cursorAt(t),o=l.node,i=[l.type.id];for(;l.parent();)i.push(l.type.id);for(let n of M)if(S(n.path,i))return n.fun(o,e,t);return null}(n.getValue(),u);return(null!=s?_(s,t):Promise.resolve([])).then((t=>{const n=t.length.toString().length;return{suggestions:t.map(((t,r)=>({kind:$(t.type,e),label:t.label,insertText:t.insertText,detail:t.detail,documentation:t.documentation,sortText:r.toString().padStart(n,"0"),range:o,command:t.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0})))}}))}}}var K=n(45916);const V={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,suggest:{showWords:!1},suggestFontSize:12,wordWrap:"on"},z=o.id;let D=!1;const U=e=>{const t=(0,s.Z)(),g=(0,i.useRef)((null===m&&(m={storageService:f()}),m)),p=(0,i.useRef)(null),{languageProvider:h,history:y,onBlur:v,onRunQuery:C,initialValue:L,placeholder:b,onChange:N}=e,E=(0,u.Z)(h),_=(0,u.Z)(y),I=(0,u.Z)(C),A=(0,u.Z)(v),T=(0,u.Z)(N),w=(0,i.useRef)(null),S=((e,t)=>({container:r.css`
      border-radius: ${e.shape.borderRadius()};
      border: 1px solid ${e.components.input.borderColor};
    `,placeholder:r.css`
      ::after {
        content: '${t}';
        font-family: ${e.typography.fontFamilyMonospace};
        opacity: 0.3;
      }
    `}))((0,c.l4)(),b);return(0,i.useEffect)((()=>()=>{var e;null===(e=w.current)||void 0===e||e.call(w)}),[]),(0,K.jsx)("div",{"aria-label":a.wl.components.QueryField.container,className:S.container,ref:p,children:(0,K.jsx)(d.o,{overrideServices:g.current,options:V,language:"promql",value:L,beforeMount:e=>{!function(e){if(!1===D){D=!0;const{aliases:t,extensions:n,mimetypes:r,loader:l}=o;e.languages.register({id:z,aliases:t,extensions:n,mimetypes:r}),l().then((t=>{e.languages.setMonarchTokensProvider(z,t.language),e.languages.setLanguageConfiguration(z,t.languageConfiguration)}))}}(e)},onMount:(e,r)=>{var o;const i=e.createContextKey("isEditorFocused"+t,!1);e.onDidBlurEditorWidget((()=>{i.set(!1),A.current(e.getValue())})),e.onDidFocusEditorText((()=>{i.set(!0)}));const u=W(r,{getHistory:()=>Promise.resolve(_.current.map((e=>e.query.expr)).filter((e=>void 0!==e))),getAllMetricNames:()=>{const{metrics:e,metricsMetadata:t}=E.current,n=e.map((e=>{var n,r;const l=null==t?void 0:t[e];return{name:e,help:null!==(n=null==l?void 0:l.help)&&void 0!==n?n:"",type:null!==(r=null==l?void 0:l.type)&&void 0!==r?r:""}}));return Promise.resolve(n)},getAllLabelNames:()=>Promise.resolve(E.current.getLabelKeys()),getLabelValues:e=>E.current.getLabelValues(e),getSeriesValues:E.current.getSeriesValues,getSeriesLabels:E.current.getSeriesLabels}),s=Object.assign({},u,{provideCompletionItems:(t,n,r,l)=>{var o;return(null===(o=e.getModel())||void 0===o?void 0:o.id)!==t.id?{suggestions:[]}:u.provideCompletionItems(t,n,r,l)}}),{dispose:a}=r.languages.registerCompletionItemProvider(z,s);w.current=a;const c=()=>{const t=p.current;if(null!==t){const n=e.getContentHeight();t.style.height=`${n+2}px`,t.style.width="100%";const r=t.clientWidth;e.layout({width:r,height:n})}};e.onDidContentSizeChange(c),c();const d=(0,l.debounce)((()=>{const t=e.getValue();T.current(t)}),300);if(null===(o=e.getModel())||void 0===o||o.onDidChangeContent((()=>{d()})),e.addCommand(r.KeyMod.Shift|r.KeyCode.Enter,(()=>{I.current(e.getValue())}),"isEditorFocused"+t),e.addCommand(r.KeyMod.CtrlCmd|r.KeyCode.KeyK,(function(){n.g.dispatchEvent(new KeyboardEvent("keydown",{key:"k",metaKey:!0}))})),b){const t=[{range:new r.Range(1,1,1,1),options:{className:S.placeholder,isWholeLine:!0}}];let n=[];const l=()=>{const r=e.getModel();if(!r)return;const l=0===r.getValueLength()?t:[];n=r.deltaDecorations(n,l)};l(),e.onDidChangeModelContent(l)}}})})}},3088:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(68404);const l=function(e){var t=(0,r.useRef)(e);return t.current=e,t}}}]);
//# sourceMappingURL=prom-query-field.fe19a4c33d10f38237bb.js.map