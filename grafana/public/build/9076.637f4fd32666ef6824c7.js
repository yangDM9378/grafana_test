"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9076],{73615:(e,l,a)=>{a.d(l,{J:()=>t});a(68404);var n=a(37417),s=a(45916);const t=e=>{let{children:l,pageId:a,pageNav:t,isLoading:i}=e;return(0,s.jsx)(n.T,{pageNav:t,navId:a,children:(0,s.jsx)(n.T.Contents,{isLoading:i,children:l})})}},31062:(e,l,a)=>{a.d(l,{Z:()=>k});var n=a(52423),s=a(68404),t=a(59052),i=a(16755),o=a(83744),r=a(4645),d=a(93194),u=a(65678),c=a(35258),v=a(8006),m=a(74846),x=a(70917),g=a(45916);const p=e=>{let{value:l,onChange:a,options:n,className:t,placeholder:i,width:o,custom:d,onCustomChange:u,disabled:c=!1,addLabel:v="+ Add new","aria-label":m}=e;const[p,b]=(0,s.useState)(d);(0,s.useEffect)((()=>{d&&b(d)}),[d]);const f=(0,s.useMemo)((()=>[...n,{value:"__add__",label:v}]),[n,v]);return p?(0,g.jsx)(r.I,{"aria-label":m,width:o,autoFocus:!d,value:l||"",placeholder:i,className:t,disabled:c,onChange:e=>a(e.currentTarget.value)}):(0,g.jsx)(x.Ph,{"aria-label":m,width:o,options:f,value:l,className:t,placeholder:i,disabled:c,onChange:e=>{const l=null==e?void 0:e.value;"__add__"===l?(b(!0),u&&u(!0),a("")):a(l)}})},b=["value","existingKeys","aria-label"];const f=e=>{let{value:l,existingKeys:a,"aria-label":n}=e,t=function(e,l){if(null==e)return{};var a,n,s={},t=Object.keys(e);for(n=0;n<t.length;n++)a=t[n],l.indexOf(a)>=0||(s[a]=e[a]);return s}(e,b);const i=(0,s.useMemo)((()=>Object.values(m.q6).filter((e=>!a.includes(e))).map((e=>({value:e,label:m.vY[e]})))),[a]);return(0,g.jsx)(p,Object.assign({"aria-label":n,value:l,options:i,custom:!!l&&!Object.values(m.q6).includes(l)},t))},h=["ref"];var j;const y=e=>({annotationValueInput:n.css`
    width: 426px;
  `,textarea:n.css`
    height: 76px;
  `,addAnnotationsButton:n.css`
    flex-grow: 0;
    align-self: flex-start;
    margin-left: 148px;
  `,flexColumn:n.css`
    display: flex;
    flex-direction: column;
  `,field:n.css`
    margin-bottom: ${e.spacing(.5)};
  `,flexRow:n.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;
  `,flexRowItemMargin:n.css`
    margin-left: ${e.spacing(.5)};
  `}),k=()=>{const e=(0,i.wW)(y),{control:l,register:a,watch:m,formState:{errors:x}}=(0,t.Gc)(),p=m("annotations"),b=(0,s.useCallback)((e=>p.filter(((l,a)=>a!==e)).map((e=>{let{key:l}=e;return l}))),[p]),{fields:k,append:w,remove:N}=(0,t.Dq)({control:l,name:"annotations"});return(0,g.jsxs)(g.Fragment,{children:[j||(j=(0,g.jsx)(o._,{children:"Summary and annotations"})),(0,g.jsxs)("div",{className:e.flexColumn,children:[k.map(((s,t)=>{var i,o,m,j,y,k,w,$,C,O,R,q,I,S,B;const L=null===(i=p[t])||void 0===i||null===(o=i.key)||void 0===o?void 0:o.toLocaleLowerCase().endsWith("url"),V=L?r.I:d.K;return(0,g.jsxs)("div",{className:e.flexRow,children:[(0,g.jsx)(u.g,{className:e.field,invalid:!(null===(m=x.annotations)||void 0===m||null===(j=m[t])||void 0===j||null===(y=j.key)||void 0===y||!y.message),error:null===(k=x.annotations)||void 0===k||null===(w=k[t])||void 0===w||null===($=w.key)||void 0===$?void 0:$.message,"data-testid":`annotation-key-${t}`,children:(0,g.jsx)(c.g,{name:`annotations.${t}.key`,defaultValue:s.key,render:e=>{let{}=e,l=function(e,l){if(null==e)return{};var a,n,s={},t=Object.keys(e);for(n=0;n<t.length;n++)a=t[n],l.indexOf(a)>=0||(s[a]=e[a]);return s}(e.field,h);return(0,g.jsx)(f,Object.assign({},l,{"aria-label":`Annotation detail ${t+1}`,existingKeys:b(t),width:18}))},control:l,rules:{required:{value:!(null===(C=p[t])||void 0===C||!C.value),message:"Required."}}})}),(0,g.jsx)(u.g,{className:(0,n.cx)(e.flexRowItemMargin,e.field),invalid:!(null===(O=x.annotations)||void 0===O||null===(R=O[t])||void 0===R||null===(q=R.value)||void 0===q||!q.message),error:null===(I=x.annotations)||void 0===I||null===(S=I[t])||void 0===S||null===(B=S.value)||void 0===B?void 0:B.message,children:(0,g.jsx)(V,Object.assign({"data-testid":`annotation-value-${t}`,className:(0,n.cx)(e.annotationValueInput,{[e.textarea]:!L})},a(`annotations.${t}.value`),{placeholder:L?"https://":"Text",defaultValue:s.value}))}),(0,g.jsx)(v.zx,{type:"button",className:e.flexRowItemMargin,"aria-label":"delete annotation",icon:"trash-alt",variant:"secondary",onClick:()=>N(t)})]},s.id)})),(0,g.jsx)(v.zx,{className:e.addAnnotationsButton,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{w({key:"",value:""})},children:"Add info"})]})]})}},87006:(e,l,a)=>{a.d(l,{Z:()=>V});var n=a(52423),s=a(82897),t=a(68404),i=a(59052),o=a(68522),r=a(8006),d=a(16755),u=a(38953),c=a(65678),v=a(66946),m=a(4645),x=a(83744),g=a(21888),p=a(99500),b=a(64850),f=a(76938),h=a(64834),j=a(70917),y=a(45916);const k=t.forwardRef((function(e,l){let{onChange:a,options:n,defaultValue:s,type:t,onOpenMenu:i=(()=>{})}=e;return(0,y.jsx)("div",{ref:l,children:(0,y.jsx)(c.g,{disabled:!1,"data-testid":`alertlabel-${t}-picker`,children:(0,y.jsx)(j.Ph,{placeholder:`Choose ${t}`,width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:a,onOpenMenu:i,options:n,maxMenuHeight:500,noOptionsMessage:"No labels found",defaultValue:s,allowCustomValue:!0})})})}));var w,N,$,C,O;function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((e=>({label:e,value:e})))}const q=e=>{let{remove:l,className:a,index:n}=e;return(0,y.jsx)(r.zx,{className:a,"aria-label":"delete label",icon:"trash-alt","data-testid":`delete-label-${n}`,variant:"secondary",onClick:()=>{l(n)}})},I=e=>{let{append:l,className:a}=e;return(0,y.jsx)(r.zx,{className:a,icon:"plus-circle",type:"button",variant:"secondary",onClick:()=>{l({key:"",value:""})},children:"Add label"})},S=e=>{let{dataSourceName:l}=e;const a=(0,d.wW)(L),{register:o,control:r,watch:m,formState:{errors:x},setValue:g}=(0,i.Gc)(),p=m("labels"),{fields:j,remove:N,append:$}=(0,i.Dq)({control:r,name:"labels"}),{loading:C,labelsByKey:O}=(e=>{const l=(0,b.I0)();(0,t.useEffect)((()=>{l((0,h.IA)(e))}),[l,e]);const a=(0,f._)((e=>e.rulerRules))[e],n=(null==a?void 0:a.result)||{},i=(0,s.compact)((0,s.flattenDeep)(Object.keys(n).map((e=>n[e].map((e=>e.rules.map((e=>e.labels)))))))),o={};return i.forEach((e=>{Object.entries(e).forEach((e=>{let[l,a]=e;o[l]=[...new Set([...o[l]||[],a])]}))})),{loading:null==a?void 0:a.loading,labelsByKey:o}})(l),[S,B]=(0,t.useState)(""),V=(0,t.useMemo)((()=>R(Object.keys(O))),[O]),M=(0,t.useCallback)((e=>R(O[e])),[O]),_=(0,t.useMemo)((()=>M(S)),[S,M]);return(0,y.jsxs)(y.Fragment,{children:[C&&(w||(w=(0,y.jsx)(u.u,{text:"Loading"}))),!C&&(0,y.jsxs)(y.Fragment,{children:[j.map(((e,l)=>{var s,t,i,r,d,u,m,b,f,h,j,w,$,C;return(0,y.jsx)("div",{children:(0,y.jsxs)("div",{className:(0,n.cx)(a.flexRow,a.centerAlignRow),children:[(0,y.jsx)(c.g,{className:a.labelInput,invalid:Boolean(null===(s=x.labels)||void 0===s||null===(t=s[l])||void 0===t||null===(i=t.key)||void 0===i?void 0:i.message),error:null===(r=x.labels)||void 0===r||null===(d=r[l])||void 0===d||null===(u=d.key)||void 0===u?void 0:u.message,"data-testid":`label-key-${l}`,children:(0,y.jsx)(k,Object.assign({},o(`labels.${l}.key`,{required:{value:Boolean(null===(m=p[l])||void 0===m?void 0:m.value),message:"Required."}}),{defaultValue:e.key?{label:e.key,value:e.key}:void 0,options:V,onChange:e=>{g(`labels.${l}.key`,e.value),B(e.value)},type:"key"}))}),(0,y.jsx)(v.W,{className:a.equalSign,children:"="}),(0,y.jsx)(c.g,{className:a.labelInput,invalid:Boolean(null===(b=x.labels)||void 0===b||null===(f=b[l])||void 0===f||null===(h=f.value)||void 0===h?void 0:h.message),error:null===(j=x.labels)||void 0===j||null===(w=j[l])||void 0===w||null===($=w.value)||void 0===$?void 0:$.message,"data-testid":`label-value-${l}`,children:(0,y.jsx)(k,Object.assign({},o(`labels.${l}.value`,{required:{value:Boolean(null===(C=p[l])||void 0===C?void 0:C.key),message:"Required."}}),{defaultValue:e.value?{label:e.value,value:e.value}:void 0,options:_,onChange:e=>{g(`labels.${l}.value`,e.value)},onOpenMenu:()=>{B(p[l].key)},type:"value"}))}),(0,y.jsx)(q,{className:a.deleteLabelButton,index:l,remove:N})]})},e.id)})),(0,y.jsx)(I,{className:a.addLabelButton,append:$})]})]})},B=()=>{const e=(0,d.wW)(L),{register:l,control:a,watch:s,formState:{errors:t}}=(0,i.Gc)(),o=s("labels"),{fields:r,remove:u,append:x}=(0,i.Dq)({control:a,name:"labels"});return(0,y.jsxs)(y.Fragment,{children:[r.map(((a,s)=>{var i,r,d,x,g,p,b,f,h,j,k,w,N,$;return(0,y.jsx)("div",{children:(0,y.jsxs)("div",{className:(0,n.cx)(e.flexRow,e.centerAlignRow),"data-testid":"alertlabel-input-wrapper",children:[(0,y.jsx)(c.g,{className:e.labelInput,invalid:!(null===(i=t.labels)||void 0===i||null===(r=i[s])||void 0===r||null===(d=r.key)||void 0===d||!d.message),error:null===(x=t.labels)||void 0===x||null===(g=x[s])||void 0===g||null===(p=g.key)||void 0===p?void 0:p.message,children:(0,y.jsx)(m.I,Object.assign({},l(`labels.${s}.key`,{required:{value:!(null===(b=o[s])||void 0===b||!b.value),message:"Required."}}),{placeholder:"key","data-testid":`label-key-${s}`,defaultValue:a.key}))}),(0,y.jsx)(v.W,{className:e.equalSign,children:"="}),(0,y.jsx)(c.g,{className:e.labelInput,invalid:!(null===(f=t.labels)||void 0===f||null===(h=f[s])||void 0===h||null===(j=h.value)||void 0===j||!j.message),error:null===(k=t.labels)||void 0===k||null===(w=k[s])||void 0===w||null===(N=w.value)||void 0===N?void 0:N.message,children:(0,y.jsx)(m.I,Object.assign({},l(`labels.${s}.value`,{required:{value:!(null===($=o[s])||void 0===$||!$.key),message:"Required."}}),{placeholder:"value","data-testid":`label-value-${s}`,defaultValue:a.value}))}),(0,y.jsx)(q,{className:e.deleteLabelButton,index:s,remove:u})]})},a.id)})),(0,y.jsx)(I,{className:e.addLabelButton,append:x})]})},L=e=>({icon:n.css`
      margin-right: ${e.spacing(.5)};
    `,wrapper:n.css`
      margin-bottom: ${e.spacing(4)};
    `,flexColumn:n.css`
      display: flex;
      flex-direction: column;
    `,flexRow:n.css`
      display: flex;
      flex-direction: row;
      justify-content: flex-start;

      & + button {
        margin-left: ${e.spacing(.5)};
      }
    `,deleteLabelButton:n.css`
      margin-left: ${e.spacing(.5)};
      align-self: flex-start;
    `,addLabelButton:n.css`
      flex-grow: 0;
      align-self: flex-start;
    `,centerAlignRow:n.css`
      align-items: baseline;
    `,equalSign:n.css`
      align-self: flex-start;
      width: 28px;
      justify-content: center;
      margin-left: ${e.spacing(.5)};
    `,labelInput:n.css`
      width: 175px;
      margin-bottom: ${e.spacing(1)};
      & + & {
        margin-left: ${e.spacing(1)};
      }
    `}),V=e=>{let{className:l,dataSourceName:a}=e;const s=(0,d.wW)(L);return(0,y.jsxs)("div",{className:(0,n.cx)(l,s.wrapper),children:[(0,y.jsx)(x._,{children:(0,y.jsxs)(o.Stack,{gap:.5,children:[N||(N=(0,y.jsx)("span",{children:"Custom Labels"})),(0,y.jsx)(g.u,{content:$||($=(0,y.jsx)("div",{children:"The dropdown only displays labels that you have previously used for alerts. Select a label from the dropdown or type in a new one."})),children:(0,y.jsx)(p.J,{className:s.icon,name:"info-circle",size:"sm"})})]})}),(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)("div",{className:s.flexRow,children:[C||(C=(0,y.jsx)(v.W,{width:18,children:"Labels"})),(0,y.jsxs)("div",{className:s.flexColumn,children:[a&&(0,y.jsx)(S,{dataSourceName:a}),!a&&(O||(O=(0,y.jsx)(B,{})))]})]})})]})}}}]);
//# sourceMappingURL=9076.637f4fd32666ef6824c7.js.map