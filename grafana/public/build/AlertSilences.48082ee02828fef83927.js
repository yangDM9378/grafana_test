"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1783],{34509:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ct});var n,r=a(68404),s=a(70356),l=a(2843),i=a(72767),c=a(64850),o=a(92431),d=a(39833),u=a(73615),m=a(62791),g=a(67921),h=a(52423),x=a(82897),p=a(59052),v=a(94255),f=a(13960),j=a(12717),b=a(88246),y=a(65737),A=a(16755),w=a(71980),S=a(65678),C=a(4645),N=a(93194),$=a(8006),q=a(19200),k=a(8157),R=a(34426),E=a(76938),M=a(64834),O=a(72710),I=a(42889),D=a(23691),T=a(5302),_=a(64313),z=a(36521),B=a(80458),Q=a(90062),Y=a(39440),W=a(18304),Z=a(45916);const V=()=>{const[e,t]=(0,r.useState)([]),a=(0,p.Gc)(),s=(0,c.I0)(),{watch:l}=a,i=l("matchers"),o=(0,A.wW)(G),d=[{id:"state",label:"State",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,Z.jsx)(W.l,{state:t.state})},size:"160px"},{id:"labels",label:"Labels",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,Z.jsx)(Q.s,{labels:t.labels})},size:"auto"},{id:"created",label:"Created",renderCell:function(e){let{data:{matchedInstance:t}}=e;return(0,Z.jsx)(Z.Fragment,{children:t.activeAt.startsWith("0001")?"-":(0,b.CQ)(t.activeAt).format("YYYY-MM-DD HH:mm:ss")})},size:"180px"}];(0,r.useEffect)((()=>{s((0,M.ei)())}),[s]);const u=(0,z.Zo)();return(0,v.Z)((()=>{const e=u.flatMap((e=>e.groups.flatMap((e=>e.rules.map((e=>e.promRule)).filter((e=>(0,B.x_)(e))).flatMap((e=>{var t;return(0,I.TZ)(null!==(t=e.alerts)&&void 0!==t?t:[],i)}))))));t(e)}),500,[u,i]),(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("h4",{className:o.title,children:["Affected alert instances",e.length>0?(0,Z.jsx)(_.C,{className:o.badge,color:"blue",text:e.length}):null]}),(0,Z.jsx)("div",{className:o.table,children:i.every((e=>!e.value&&!e.name))?n||(n=(0,Z.jsx)("span",{children:"Add a valid matcher to see affected alerts"})):(0,Z.jsx)(Y.t,{items:e,isExpandable:!1,cols:d,pagination:{itemsPerPage:5}})})]})};const G=e=>({table:h.css`
    max-width: ${e.breakpoints.values.lg}px;
  `,moreMatches:h.css`
    margin-top: ${e.spacing(1)};
  `,title:h.css`
    display: flex;
    align-items: center;
  `,badge:h.css`
    margin-left: ${e.spacing(1)};
  `});var H=a(35258),P=a(70917),F=a(23734);const K=["onChange","ref"];const L=e=>({wrapper:h.css`
      margin-top: ${e.spacing(2)};
    `,row:h.css`
      display: flex;
      align-items: flex-start;
      flex-direction: row;
      background-color: ${e.colors.background.secondary};
      padding: ${e.spacing(1)} ${e.spacing(1)} 0 ${e.spacing(1)};
      & > * + * {
        margin-left: ${e.spacing(2)};
      }
    `,removeButton:h.css`
      margin-left: ${e.spacing(1)};
      margin-top: ${e.spacing(2.5)};
    `,matcherOptions:h.css`
      min-width: 140px;
    `,matchers:h.css`
      max-width: ${e.breakpoints.values.sm}px;
      margin: ${e.spacing(1)} 0;
      padding-top: ${e.spacing(.5)};
    `}),J=e=>{let{className:t}=e;const a=(0,A.wW)(L),n=(0,p.Gc)(),{control:r,register:s,formState:{errors:l}}=n,{fields:i=[],append:c,remove:o}=(0,p.Dq)({name:"matchers"});return(0,Z.jsx)("div",{className:(0,h.cx)(t,a.wrapper),children:(0,Z.jsx)(S.g,{label:"Matching labels",required:!0,children:(0,Z.jsxs)("div",{children:[(0,Z.jsx)("div",{className:a.matchers,children:i.map(((e,t)=>{var n,c,d,u,m,g,h,x,p,v;return(0,Z.jsxs)("div",{className:a.row,"data-testid":"matcher",children:[(0,Z.jsx)(S.g,{label:"Label",invalid:!(null==l||null===(n=l.matchers)||void 0===n||null===(c=n[t])||void 0===c||!c.name),error:null==l||null===(d=l.matchers)||void 0===d||null===(u=d[t])||void 0===u||null===(m=u.name)||void 0===m?void 0:m.message,children:(0,Z.jsx)(C.I,Object.assign({},s(`matchers.${t}.name`,{required:{value:!0,message:"Required."}}),{defaultValue:e.name,placeholder:"label"}))}),(0,Z.jsx)(S.g,{label:"Operator",children:(0,Z.jsx)(H.g,{control:r,render:e=>{let{field:{onChange:t}}=e,n=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e.field,K);return(0,Z.jsx)(P.Ph,Object.assign({},n,{onChange:e=>t(e.value),className:a.matcherOptions,options:O.tA,"aria-label":"operator"}))},defaultValue:e.operator||O.tA[0].value,name:`matchers.${t}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,Z.jsx)(S.g,{label:"Value",invalid:!(null==l||null===(g=l.matchers)||void 0===g||null===(h=g[t])||void 0===h||!h.value),error:null==l||null===(x=l.matchers)||void 0===x||null===(p=x[t])||void 0===p||null===(v=p.value)||void 0===v?void 0:v.message,children:(0,Z.jsx)(C.I,Object.assign({},s(`matchers.${t}.value`,{required:{value:!0,message:"Required."}}),{defaultValue:e.value,placeholder:"value"}))}),i.length>1&&(0,Z.jsx)(F.h,{className:a.removeButton,tooltip:"Remove matcher",name:"trash-alt",onClick:()=>o(t),children:"Remove"})]},`${e.id}`)}))}),(0,Z.jsx)($.zx,{type:"button",icon:"plus",variant:"secondary",onClick:()=>{const e={name:"",value:"",operator:k._M.equal};c(e)},children:"Add matcher"})]})})})};var U=a(38942);const X=()=>{const{control:e,getValues:t}=(0,p.Gc)(),{field:{onChange:a,value:n},fieldState:{invalid:r}}=(0,p.bc)({name:"startsAt",control:e,rules:{validate:e=>t().endsAt>e}}),{field:{onChange:s,value:l},fieldState:{invalid:i}}=(0,p.bc)({name:"endsAt",control:e,rules:{validate:e=>t().startsAt<e}}),{field:{onChange:c,value:o}}=(0,p.bc)({name:"timeZone",control:e}),d=r||i,u=(0,b.CQ)(n),m=(0,b.CQ)(l);return(0,Z.jsx)(S.g,{className:ee.timeRange,label:"Silence start and end",error:d?"To is before or the same as from":"",invalid:d,children:(0,Z.jsx)(U.K,{value:{from:u,to:m,raw:{from:u,to:m}},timeZone:o,onChange:e=>{a((0,b.CQ)(e.from)),s((0,b.CQ)(e.to))},onChangeTimeZone:e=>c(e),hideTimeZone:!1,hideQuickRanges:!0,placeholder:"Select time range"})})},ee={timeRange:h.css`
    width: 400px;
  `};var te,ae,ne,re,se;const le=(e,t)=>{const a=new Date;if(t){var n;const e=Date.parse(t.endsAt)<Date.now()?{start:a,end:(0,f.Ks)(a,{hours:2})}:{start:new Date(t.startsAt),end:new Date(t.endsAt)};return{id:t.id,startsAt:e.start.toISOString(),endsAt:e.end.toISOString(),comment:t.comment,createdBy:t.createdBy,duration:(0,f.vT)(e),isRegex:!1,matchers:(null===(n=t.matchers)||void 0===n?void 0:n.map(O.cm))||[],matcherName:"",matcherValue:"",timeZone:j.Ys}}{const t=(0,f.Ks)(a,{hours:2});return Object.assign({id:"",startsAt:a.toISOString(),endsAt:t.toISOString(),comment:`created ${(0,b.CQ)().format("YYYY-MM-DD HH:mm")}`,createdBy:y.v.bootData.user.name,duration:"2h",isRegex:!1,matchers:[{name:"",value:"",operator:k._M.equal}],matcherName:"",matcherValue:"",timeZone:j.Ys},(e=>{const t={},a=e.get("comment"),n=e.getAll("matcher"),r=(0,I.RT)(n);return r.length&&(t.matchers=r.map(O.cm)),a&&(t.comment=a),t})(e))}},ie=e=>({field:h.css`
    margin: ${e.spacing(1,0)};
  `,textArea:h.css`
    max-width: ${e.breakpoints.values.sm}px;
  `,createdBy:h.css`
    width: 200px;
  `,flexRow:h.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-start;

    & > * {
      margin-right: ${e.spacing(1)};
    }
  `,silencePeriod:h.css`
    max-width: ${e.breakpoints.values.sm}px;
  `}),ce=e=>{var t,a;let{silence:n,alertManagerSourceName:s}=e;const[l]=(0,R.j)(),i=(0,r.useMemo)((()=>le(l,n)),[n,l]),o=(0,p.cI)({defaultValues:i}),d=(0,c.I0)(),u=(0,A.wW)(ie),{loading:m}=(0,E._)((e=>e.updateSilence));(0,q.x)((e=>e.unifiedAlerting.updateSilence=T.oq));const{register:g,handleSubmit:j,formState:k,watch:I,setValue:_,clearErrors:z}=o,B=I("duration"),Q=I("startsAt"),Y=I("endsAt"),[W,G]=(0,r.useState)(B);(0,v.Z)((()=>{if((0,f.qb)(Q)&&(0,f.qb)(Y))if(B!==W)_("endsAt",(0,b.CQ)((0,f.Ks)(new Date(Q),(0,f.RA)(B))).toISOString()),G(B);else{const e=new Date(Q).valueOf();if(new Date(Y).valueOf()>e){const e=(0,f.vT)({start:new Date(Q),end:new Date(Y)});_("duration",e),G(e)}}}),700,[z,B,Y,W,_,Q]);const H=Boolean(y.v.bootData.user.isSignedIn&&y.v.bootData.user.name);return(0,Z.jsx)(p.RV,Object.assign({},o,{children:(0,Z.jsxs)("form",{onSubmit:j((e=>{const{id:t,startsAt:a,endsAt:n,comment:r,createdBy:l,matchers:i}=e,c=i.map(O._J),o=(0,x.pickBy)({id:t,startsAt:a,endsAt:n,comment:r,createdBy:l,matchers:c},(e=>!!e));d((0,M.QY)({alertManagerSourceName:s,payload:o,exitOnSave:!0,successMessage:"Silence "+(o.id?"updated":"created")}))})),children:[(0,Z.jsxs)(w.C,{label:""+(n?"Recreate silence":"Create silence"),children:[(0,Z.jsxs)("div",{className:(0,h.cx)(u.flexRow,u.silencePeriod),children:[te||(te=(0,Z.jsx)(X,{})),(0,Z.jsx)(S.g,{label:"Duration",invalid:!!k.errors.duration,error:k.errors.duration&&("required"===k.errors.duration.type?"Required field":k.errors.duration.message),children:(0,Z.jsx)(C.I,Object.assign({className:u.createdBy},g("duration",{validate:e=>0===Object.keys((0,f.RA)(e)).length?"Invalid duration. Valid example: 1d 4h (Available units: y, M, w, d, h, m, s)":void 0}),{id:"duration"}))})]}),ae||(ae=(0,Z.jsx)(J,{})),(0,Z.jsx)(S.g,{className:(0,h.cx)(u.field,u.textArea),label:"Comment",required:!0,error:null===(t=k.errors.comment)||void 0===t?void 0:t.message,invalid:!!k.errors.comment,children:(0,Z.jsx)(N.K,Object.assign({},g("comment",{required:{value:!0,message:"Required."}}),{rows:5,placeholder:"Details about the silence"}))}),!H&&(0,Z.jsx)(S.g,{className:(0,h.cx)(u.field,u.createdBy),label:"Created By",required:!0,error:null===(a=k.errors.createdBy)||void 0===a?void 0:a.message,invalid:!!k.errors.createdBy,children:(0,Z.jsx)(C.I,Object.assign({},g("createdBy",{required:{value:!0,message:"Required."}}),{placeholder:"Who's creating the silence"}))}),ne||(ne=(0,Z.jsx)(V,{}))]}),(0,Z.jsxs)("div",{className:u.flexRow,children:[m&&(re||(re=(0,Z.jsx)($.zx,{disabled:!0,icon:"fa fa-spinner",variant:"primary",children:"Saving..."}))),!m&&(se||(se=(0,Z.jsx)($.zx,{type:"submit",children:"Submit"}))),(0,Z.jsx)($.Qj,{href:(0,D.eQ)("alerting/silences",s),variant:"secondary",fill:"outline",children:"Cancel"})]})]})}))};var oe=a(42914),de=a(68522),ue=a(32889),me=a(99500),ge=a(19512),he=a(59196),xe=a(96535),pe=a(60277);const ve=["className"];const fe=e=>{let{className:t}=e,a=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,ve);const n=(0,A.wW)(je);return(0,Z.jsx)($.zx,Object.assign({variant:"secondary",size:"xs",className:(0,h.cx)(n.wrapper,t)},a))},je=e=>({wrapper:h.css`
    height: 24px;
    font-size: ${e.typography.bodySmall.fontSize};
  `});var be,ye=a(83221),Ae=a(74562),we=a(334),Se=a(75442);const Ce=e=>{let{alertManagerSourceName:t}=e;const a=(0,xe.QX)(t);return he.Vt.hasAccess(a.create,he.Vt.isEditor)?(0,Z.jsx)(Se.Z,{title:"You haven't created any silences yet",buttonIcon:"bell-slash",buttonLink:(0,D.eQ)("alerting/silence/new",t),buttonTitle:"New silence"}):be||(be=(0,Z.jsx)(we._,{callToActionElement:(0,Z.jsx)("div",{}),message:"No silences found."}))};var Ne,$e=a(18033),qe=a(23542),ke=a(40711);const Re=e=>{let{alert:t,className:a}=e;const[n,s]=(0,r.useState)(!0),l=(0,f.vT)({start:new Date(t.startsAt),end:new Date(t.endsAt)}),i=Object.entries(t.labels).reduce(((e,t)=>{let[a,n]=t;return"alertname"!==a&&"__alert_rule_title__"!==a||(e=n),e}),"");return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)("tr",{className:a,children:[(0,Z.jsx)("td",{children:(0,Z.jsx)(qe.U,{isCollapsed:n,onToggle:e=>s(e)})}),(0,Z.jsx)("td",{children:(0,Z.jsx)(ke.G,{state:t.status.state})}),(0,Z.jsxs)("td",{children:["for ",l," seconds"]}),(0,Z.jsx)("td",{children:i})]}),!n&&(0,Z.jsxs)("tr",{className:a,children:[Ne||(Ne=(0,Z.jsx)("td",{})),(0,Z.jsx)("td",{colSpan:5,children:(0,Z.jsx)(Q.s,{labels:t.labels})})]})]})};var Ee,Me;const Oe=e=>({tableMargin:h.css`
    margin-bottom: ${e.spacing(1)};
  `,colState:h.css`
    width: 110px;
  `,colName:h.css`
    width: 65%;
  `}),Ie=e=>{let{silencedAlerts:t}=e;const a=(0,A.wW)($e.D),n=(0,A.wW)(Oe);return t.length?(0,Z.jsxs)("table",{className:(0,h.cx)(a.table,n.tableMargin),children:[(0,Z.jsxs)("colgroup",{children:[(0,Z.jsx)("col",{className:a.colExpand}),(0,Z.jsx)("col",{className:n.colState}),Ee||(Ee=(0,Z.jsx)("col",{})),(0,Z.jsx)("col",{className:n.colName})]}),Me||(Me=(0,Z.jsx)("thead",{children:(0,Z.jsxs)("tr",{children:[(0,Z.jsx)("th",{}),(0,Z.jsx)("th",{children:"State"}),(0,Z.jsx)("th",{}),(0,Z.jsx)("th",{children:"Alert name"})]})})),(0,Z.jsx)("tbody",{children:t.map(((e,t)=>(0,Z.jsx)(Re,{alert:e,className:t%2==0?a.evenRow:""},e.fingerprint)))})]}):null},De=e=>{let{silence:t}=e;const{startsAt:a,endsAt:n,comment:r,createdBy:s,silencedAlerts:l}=t,i=(0,A.wW)(Te),c="YYYY-MM-DD HH:mm",o=oe.parse(a),d=oe.parse(n),u=(0,f.vT)({start:new Date(a),end:new Date(n)});return(0,Z.jsxs)("div",{className:i.container,children:[(0,Z.jsx)("div",{className:i.title,children:"Comment"}),(0,Z.jsx)("div",{children:r}),(0,Z.jsx)("div",{className:i.title,children:"Schedule"}),(0,Z.jsx)("div",{children:`${null==o?void 0:o.format(c)} - ${null==d?void 0:d.format(c)}`}),(0,Z.jsx)("div",{className:i.title,children:"Duration"}),(0,Z.jsxs)("div",{children:[" ",u]}),(0,Z.jsx)("div",{className:i.title,children:"Created by"}),(0,Z.jsxs)("div",{children:[" ",s]}),(0,Z.jsx)("div",{className:i.title,children:"Affected alerts"}),(0,Z.jsx)(Ie,{silencedAlerts:l})]})},Te=e=>({container:h.css`
    display: grid;
    grid-template-columns: 1fr 9fr;
    grid-row-gap: 1rem;
  `,title:h.css`
    color: ${e.colors.text.primary};
  `,row:h.css`
    margin: ${e.spacing(1,0)};
  `});var _e=a(54743);const ze={[k.As.Active]:"good",[k.As.Expired]:"neutral",[k.As.Pending]:"neutral"},Be=e=>{let{state:t}=e;return(0,Z.jsx)(_e.i,{state:ze[t],children:t})};var Qe,Ye,We=a(83744),Ze=a(21888),Ve=a(37625);const Ge=Object.entries(k.As).map((e=>{let[t,a]=e;return{label:t,value:a}})),He=()=>(0,x.uniqueId)("query-string-"),Pe=()=>{const[e,t]=(0,r.useState)(He()),[a,n]=(0,ge.K)(),{queryString:s,silenceState:l}=(0,D.pF)(a),i=(0,A.wW)(Fe),c=(0,x.debounce)((e=>{const t=e.target;n({queryString:t.value||null})}),400),o=!!(s&&s.length>3)&&0===(0,O.Zh)(s).length;return(0,Z.jsxs)("div",{className:i.flexRow,children:[(0,Z.jsx)(S.g,{className:i.rowChild,label:Qe||(Qe=(0,Z.jsx)(We._,{children:(0,Z.jsxs)(de.Stack,{gap:.5,children:[(0,Z.jsx)("span",{children:"Search by matchers"}),(0,Z.jsx)(Ze.u,{content:(0,Z.jsxs)("div",{children:["Filter silences by matchers using a comma separated list of matchers, ie:",(0,Z.jsx)("pre",{children:"severity=critical, instance=~cluster-us-.+"})]}),children:(0,Z.jsx)(me.J,{name:"info-circle",size:"sm"})})]})})),invalid:o,error:o?"Query must use valid matcher syntax":null,children:(0,Z.jsx)(C.I,{className:i.searchInput,prefix:Ye||(Ye=(0,Z.jsx)(me.J,{name:"search"})),onChange:c,defaultValue:null!=s?s:"",placeholder:"Search","data-testid":"search-query-input"},e)}),(0,Z.jsx)(S.g,{className:i.rowChild,label:"State",children:(0,Z.jsx)(Ve.S,{options:Ge,value:l,onChange:e=>{n({silenceState:e})}})}),(s||l)&&(0,Z.jsx)("div",{className:i.rowChild,children:(0,Z.jsx)($.zx,{variant:"secondary",icon:"times",onClick:()=>{n({queryString:null,silenceState:null}),setTimeout((()=>t(He())))},children:"Clear filters"})})]})},Fe=e=>({searchInput:h.css`
    width: 360px;
  `,flexRow:h.css`
    display: flex;
    flex-direction: row;
    align-items: flex-end;
    padding-bottom: ${e.spacing(2)};
    border-bottom: 1px solid ${e.colors.border.strong};
  `,rowChild:h.css`
    margin-right: ${e.spacing(1)};
    margin-bottom: 0;
    max-height: 52px;
  `,fieldLabel:h.css`
    font-size: 12px;
    font-weight: 500;
  `});var Ke,Le,Je,Ue;const Xe=e=>{const[t]=(0,ge.K)();return(0,r.useMemo)((()=>{const{queryString:a,silenceState:n}=(0,D.pF)(t),r=null==t?void 0:t.silenceIds;return e.filter((e=>{if("string"==typeof r){if(!r.split(",").includes(e.id))return!1}if(a){if(!(0,O.Zh)(a).every((t=>{var a;return null===(a=e.matchers)||void 0===a?void 0:a.some((e=>{let{name:a,value:n,isEqual:r,isRegex:s}=e;return t.name===a&&t.value===n&&t.isEqual===r&&t.isRegex===s}))})))return!1}if(n){if(!(e.status.state===n))return!1}return!0}))}),[t,e])},et=e=>({topButtonContainer:h.css`
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
  `,addNewSilence:h.css`
    margin: ${e.spacing(2,0)};
  `,callout:h.css`
    background-color: ${e.colors.background.secondary};
    border-top: 3px solid ${e.colors.info.border};
    border-radius: 2px;
    height: 62px;
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-top: ${e.spacing(2)};

    & > * {
      margin-left: ${e.spacing(1)};
    }
  `,calloutIcon:h.css`
    color: ${e.colors.info.text};
  `,editButton:h.css`
    margin-left: ${e.spacing(.5)};
  `});const tt=e=>{let{silences:t,alertManagerAlerts:a,alertManagerSourceName:n}=e;const s=(0,A.wW)(et),[l]=(0,ge.K)(),i=Xe(t),o=(0,xe.QX)(n),{silenceState:d}=(0,D.pF)(l),u=!!i.length&&(void 0===d||d===k.As.Expired),m=function(e){const t=(0,c.I0)(),a=(0,A.wW)(et),n=(0,xe.QX)(e);return(0,r.useMemo)((()=>{const r=a=>{t((0,M.yO)(e,a))},s=[{id:"state",label:"State",renderCell:function(e){let{data:{status:t}}=e;return(0,Z.jsx)(Be,{state:t.state})},size:"88px"},{id:"matchers",label:"Matching labels",renderCell:function(e){let{data:{matchers:t}}=e;return(0,Z.jsx)(Ae.g,{matchers:t||[]})},size:9},{id:"alerts",label:"Alerts",renderCell:function(e){let{data:{silencedAlerts:t}}=e;return(0,Z.jsx)("span",{"data-testid":"alerts",children:t.length})},size:1},{id:"schedule",label:"Schedule",renderCell:function(e){let{data:{startsAt:t,endsAt:a}}=e;const n=oe.parse(t),r=oe.parse(a),s="YYYY-MM-DD HH:mm";return(0,Z.jsxs)(Z.Fragment,{children:[" ",null==n?void 0:n.format(s)," ","-",Je||(Je=(0,Z.jsx)("br",{})),null==r?void 0:r.format(s)]})},size:"150px"}];return he.Vt.hasAccess(n.update,he.Vt.isEditor)&&s.push({id:"actions",label:"Actions",renderCell:function(t){let{data:n}=t;return(0,Z.jsxs)(de.Stack,{gap:.5,children:["expired"===n.status.state?(0,Z.jsx)(ue.r,{href:(0,D.eQ)(`/alerting/silence/${n.id}/edit`,e),children:Ue||(Ue=(0,Z.jsx)(fe,{icon:"sync",children:"Recreate"}))}):(0,Z.jsx)(fe,{icon:"bell",onClick:()=>r(n.id),children:"Unsilence"}),"expired"!==n.status.state&&(0,Z.jsx)(ye.A,{className:a.editButton,to:(0,D.eQ)(`/alerting/silence/${n.id}/edit`,e),icon:"pen",tooltip:"edit"})]})},size:"147px"}),s}),[e,t,a,n])}(n),g=(0,r.useMemo)((()=>i.map((e=>{const t=(n=e.id,a.filter((e=>e.status.silencedBy.includes(n))));var n;return{id:e.id,data:Object.assign({},e,{silencedAlerts:t})}}))),[i,a]);return(0,Z.jsxs)("div",{"data-testid":"silences-table",children:[!!t.length&&(0,Z.jsxs)(Z.Fragment,{children:[Ke||(Ke=(0,Z.jsx)(Pe,{})),(0,Z.jsx)(pe.q,{actions:[o.create],fallback:he.Vt.isEditor,children:(0,Z.jsx)("div",{className:s.topButtonContainer,children:(0,Z.jsx)(ue.r,{href:(0,D.eQ)("/alerting/silence/new",n),children:(0,Z.jsx)($.zx,{className:s.addNewSilence,icon:"plus",children:"New Silence"})})})}),g.length?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Y.t,{items:g,cols:m,isExpandable:!0,renderExpandedContent:e=>{let{data:t}=e;return(0,Z.jsx)(De,{silence:t})}}),u&&(0,Z.jsxs)("div",{className:s.callout,children:[(0,Z.jsx)(me.J,{className:s.calloutIcon,name:"info-circle"}),Le||(Le=(0,Z.jsx)("span",{children:"Expired silences are automatically deleted after 5 days."}))]})]}):"No matching silences found"]}),!t.length&&(0,Z.jsx)(Ce,{alertManagerSourceName:n})]})};var at=a(69066),nt=a(46150);const rt={icon:"bell-slash",breadcrumbs:[{title:"Silences",url:"alerting/silences"}]};var st,lt,it=a(74846);const ct=(0,i.Pf)((()=>{var e,t,a;const n=(0,nt.k)("instance"),[i,h]=(0,at.k)(n),x=(0,c.I0)(),p=(0,E._)((e=>e.silences)),v=(0,E._)((e=>e.amAlerts)),f=i?v[i]||T.oq:void 0,j=(0,s.TH)(),b=function(){const{isExact:e,path:t}=(0,s.$B)(),[a,n]=(0,r.useState)();return(0,r.useEffect)((()=>{"/alerting/silence/new"===t?n(Object.assign({},rt,{id:"silence-new",text:"Add silence"})):"/alerting/silence/:id/edit"===t&&n(Object.assign({},rt,{id:"silence-edit",text:"Edit silence"}))}),[t,e]),a}(),y=j.pathname.endsWith("/alerting/silences"),{currentData:A}=o.T.useDiscoverAmFeaturesQuery({amSourceName:null!=i?i:""},{skip:!i});(0,r.useEffect)((()=>{function e(){i&&(x((0,M.je)(i)),x((0,M.dB)(i)))}e();const t=setInterval((()=>e),it.cm);return()=>{clearInterval(t)}}),[i,x]);const{result:w,loading:S,error:C}=i&&p[i]||T.oq,N=(0,r.useCallback)((e=>w&&w.find((t=>t.id===e))),[w]),$=(null==C||null===(e=C.message)||void 0===e?void 0:e.includes("the Alertmanager is not configured"))&&(null==A?void 0:A.lazyConfigInit);return i?(0,Z.jsxs)(u.J,{pageId:"silences",isLoading:S,pageNav:b,children:[(0,Z.jsx)(d.P,{disabled:!y,current:i,onChange:h,dataSources:n}),(0,Z.jsx)(m.u,{currentAlertmanager:i}),$&&(lt||(lt=(0,Z.jsx)(l.b,{title:"The selected Alertmanager has no configuration",severity:"warning",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."}))),C&&!S&&!$&&(0,Z.jsx)(l.b,{severity:"error",title:"Error loading silences",children:C.message||"Unknown error."}),(null==f?void 0:f.error)&&!(null!=f&&f.loading)&&!$&&(0,Z.jsx)(l.b,{severity:"error",title:"Error loading Alertmanager alerts",children:(null===(t=f.error)||void 0===t?void 0:t.message)||"Unknown error."}),w&&!C&&(0,Z.jsxs)(s.rs,{children:[(0,Z.jsx)(s.AW,{exact:!0,path:"/alerting/silences",children:(0,Z.jsx)(tt,{silences:w,alertManagerAlerts:null!==(a=null==f?void 0:f.result)&&void 0!==a?a:[],alertManagerSourceName:i})}),(0,Z.jsx)(s.AW,{exact:!0,path:"/alerting/silence/new",children:(0,Z.jsx)(ce,{alertManagerSourceName:i})}),(0,Z.jsx)(s.AW,{exact:!0,path:"/alerting/silence/:id/edit",children:e=>{let{match:t}=e;return(null==t?void 0:t.params.id)&&(0,Z.jsx)(ce,{silence:N(t.params.id),alertManagerSourceName:i})}})]})]}):y?(0,Z.jsx)(u.J,{pageId:"silences",pageNav:b,children:(0,Z.jsx)(g.I,{availableAlertManagers:n})}):st||(st=(0,Z.jsx)(s.l_,{to:"/alerting/silences"}))}),{style:"page"})},23559:(e,t,a)=>{a.d(t,{h:()=>n});const n=a(47175).C.injectEndpoints({endpoints:e=>({getAlertmanagerChoiceStatus:e.query({query:()=>({url:"/api/v1/ngalert"}),providesTags:["AlertmanagerChoice"]}),getExternalAlertmanagerConfig:e.query({query:()=>({url:"/api/v1/ngalert/admin_config"}),providesTags:["AlertmanagerChoice"]}),getExternalAlertmanagers:e.query({query:()=>({url:"/api/v1/ngalert/alertmanagers"}),transformResponse:e=>e.data}),saveExternalAlertmanagersConfig:e.mutation({query:e=>({url:"/api/v1/ngalert/admin_config",method:"POST",data:e}),invalidatesTags:["AlertmanagerChoice"]})})})},73615:(e,t,a)=>{a.d(t,{J:()=>s});a(68404);var n=a(37417),r=a(45916);const s=e=>{let{children:t,pageId:a,pageNav:s,isLoading:l}=e;return(0,r.jsx)(n.T,{pageNav:s,navId:a,children:(0,r.jsx)(n.T.Contents,{isLoading:l,children:t})})}},60277:(e,t,a)=>{a.d(t,{q:()=>s});a(68404);var n=a(59196),r=a(45916);const s=e=>{let{actions:t,children:a,fallback:s=!0}=e;return t.some((e=>n.Vt.hasAccess(e,s)))?(0,r.jsx)(r.Fragment,{children:a}):null}},62791:(e,t,a)=>{a.d(t,{u:()=>d});var n=a(52423),r=(a(68404),a(16755)),s=a(2843),l=a(8157),i=a(23559),c=a(43271),o=a(45916);function d(e){let{currentAlertmanager:t}=e;const a=(0,r.wW)(u),{useGetAlertmanagerChoiceStatusQuery:n}=i.h,{currentData:d}=n(),m=t===c.GC;if(!((null==d?void 0:d.alertmanagersChoice)&&[l.TE.External,l.TE.All].includes(null==d?void 0:d.alertmanagersChoice))||!m)return null;const g=d.numExternalAlertmanagers>0;return d.alertmanagersChoice===l.TE.External?(0,o.jsxs)(s.b,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,o.jsx)("div",{className:a.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):d.alertmanagersChoice===l.TE.All&&g?(0,o.jsxs)(s.b,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,o.jsx)("div",{className:a.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const u=e=>({adminHint:n.css`
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.bodySmall.fontWeight};
  `})},67921:(e,t,a)=>{a.d(t,{I:()=>g});a(68404);var n,r,s,l,i=a(2843),c=a(69066),o=a(39833),d=a(45916);const u=()=>n||(n=(0,d.jsx)(i.b,{title:"No Alertmanager found",severity:"warning",children:"We could not find any external Alertmanagers and you may not have access to the built-in Grafana Alertmanager."})),m=()=>r||(r=(0,d.jsx)(i.b,{title:"Selected Alertmanager not found. Select a different Alertmanager.",severity:"warning",children:"Selected Alertmanager no longer exists or you may not have permission to access it."})),g=e=>{let{availableAlertManagers:t}=e;const[a,n]=(0,c.k)(t),r=t.length>0;return(0,d.jsx)("div",{children:r?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(o.P,{onChange:n,dataSources:t}),s||(s=(0,d.jsx)(m,{}))]}):l||(l=(0,d.jsx)(u,{}))})}},83221:(e,t,a)=>{a.d(t,{A:()=>i});a(68404);var n=a(21888),r=a(8006),s=a(45916);const l=["tooltip","icon","to","target","onClick","className","tooltipPlacement"];const i=e=>{let{tooltip:t,icon:a,to:i,target:c,onClick:o,className:d,tooltipPlacement:u="top"}=e,m=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,l);const g="string"==typeof t?t:void 0;return(0,s.jsx)(n.u,{content:t,placement:u,children:i?(0,s.jsx)(r.Qj,Object.assign({variant:"secondary",fill:"text",icon:a,href:i,size:"sm",target:c},m,{"aria-label":g})):(0,s.jsx)(r.zx,Object.assign({className:d,variant:"secondary",fill:"text",size:"sm",icon:a,type:"button",onClick:o},m,{"aria-label":g}))})}},40711:(e,t,a)=>{a.d(t,{G:()=>i});a(68404);var n=a(8157),r=a(54743),s=a(45916);const l={[n.Z9.Active]:"bad",[n.Z9.Unprocessed]:"neutral",[n.Z9.Suppressed]:"info"},i=e=>{let{state:t}=e;return(0,s.jsx)(r.i,{state:l[t],children:t})}},74562:(e,t,a)=>{a.d(t,{g:()=>c});var n=a(52423),r=(a(68404),a(16755)),s=a(76961),l=a(72710),i=a(45916);const c=e=>{let{matchers:t}=e;const a=(0,r.wW)(o);return(0,i.jsx)("div",{children:(0,i.jsx)(s.P,{className:a.tags,tags:t.map((e=>`${e.name}${(0,l.zy)(e)}${e.value}`))})})},o=()=>({tags:n.css`
    justify-content: flex-start;
  `})},69066:(e,t,a)=>{a.d(t,{k:()=>c});var n=a(68404),r=a(19512),s=a(78130),l=a(74846),i=a(43271);function c(e){const[t,a]=(0,r.K)(),c=function(e){return(0,n.useCallback)((t=>e.map((e=>e.name)).includes(t)),[e])}(e),o=(0,n.useCallback)((e=>{c(e)&&(e===i.GC?(s.Z.delete(l.de),a({[l.c4]:null})):(s.Z.set(l.de,e),a({[l.c4]:e})))}),[a,c]),d=t[l.c4];if(d&&"string"==typeof d)return c(d)?[d,o]:[void 0,o];const u=s.Z.get(l.de);return u&&"string"==typeof u&&c(u)?(o(u),[u,o]):c(i.GC)?[i.GC,o]:[void 0,o]}},46150:(e,t,a)=>{a.d(t,{k:()=>s});var n=a(68404),r=a(43271);function s(e){return(0,n.useMemo)((()=>(0,r.LE)(e)),[e])}},36521:(e,t,a)=>{a.d(t,{Kd:()=>o,Zo:()=>c});var n=a(82897),r=a(68404),s=a(43271),l=a(80458),i=a(76938);function c(e){const t=(0,i._)((e=>e.promRules)),a=(0,i._)((e=>e.rulerRules)),n=(0,r.useRef)({}),c=(0,r.useMemo)((()=>{if(e){const t=(0,s.o_)(e);if(!t)throw new Error(`Unknown rules source: ${e}`);return[t]}return(0,s.h_)()}),[e]);return(0,r.useMemo)((()=>c.map((e=>{var r,i;const c=(0,s.jq)(e)?e.name:e,o=null===(r=t[c])||void 0===r?void 0:r.result,m=null===(i=a[c])||void 0===i?void 0:i.result,g=n.current[c];if(g&&g.promRules===o&&g.rulerRules===m)return g.result;const h={};Object.entries(m||{}).forEach((t=>{let[a,n]=t;const r={rulesSource:e,name:a,groups:[]};h[a]=r,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.groups=t.map((t=>{const a={name:t.name,interval:t.interval,source_tenants:t.source_tenants,rules:[]};return a.rules=t.rules.map((t=>d(t,e,a))),a}))}(r,n)})),null==o||o.forEach((t=>{let{name:a,groups:n}=t;!function(e,t){const a=new Map;e.groups.forEach((e=>a.set(e.name,e))),t.forEach((t=>{var n;let r=a.get(t.name);r||(r={name:t.name,rules:[]},e.groups.push(r),a.set(t.name,r));const i=new Map;r.rules.forEach((e=>{const t=i.get(e.name);t?t.push(e):i.set(e.name,[e])})),(null!==(n=t.rules)&&void 0!==n?n:[]).forEach((t=>{const a=function(e,t,a){const n=t.get(e.name);if(!n)return;if((0,s.HY)(a))return n[0];const r=n.find((t=>!t.promRule&&u(t,e,!0)));if(r)return r;const l=n.find((t=>!t.promRule&&u(t,e,!1)));if(l)return l;return}(t,i,e.rulesSource);a?a.promRule=t:r.rules.push(function(e,t,a){return{name:e.name,query:e.query,labels:e.labels||{},annotations:(0,l.x_)(e)&&e.annotations||{},promRule:e,namespace:t,group:a}}(t,e,r))}))}))}(h[a]=h[a]||{rulesSource:e,name:a,groups:[]},n)}));const x=Object.values(h);return n.current[c]={promRules:o,rulerRules:m,result:x},x})).flat()),[t,a,c])}function o(e){return e.map((e=>{const t=Object.assign({},e,{groups:[]});var a;return t.groups.push({name:"default",rules:(a=e.groups.flatMap((e=>e.rules)),a.sort(((e,t)=>e.name.localeCompare(t.name))))}),t}))}function d(e,t,a){return(0,l.cG)(e)?{name:e.alert,query:e.expr,labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}:(0,l.yF)(e)?{name:e.record,query:e.expr,labels:e.labels||{},annotations:{},rulerRule:e,namespace:t,group:a}:{name:e.grafana_alert.title,query:"",labels:e.labels||{},annotations:e.annotations||{},rulerRule:e,namespace:t,group:a}}function u(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.name===t.name&&(0,n.isEqual)([a?m(e.query):"",e.labels,e.annotations],[a?m(t.query):"",t.labels||{},(0,l.x_)(t)&&t.annotations||{}])}function m(e){return e.length>1&&"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,-1)),(e=e.replace(/\s|\n/g,"")).split("").sort().join("")}},34426:(e,t,a)=>{a.d(t,{j:()=>l});var n=a(68404),r=a(70356),s=a(80795);function l(){const{search:e}=(0,r.TH)();return[(0,n.useMemo)((()=>new URLSearchParams(e)),[e]),(0,n.useCallback)(((e,t)=>{s.E1.partial(e,t)}),[])]}},18033:(e,t,a)=>{a.d(t,{D:()=>r});var n=a(52423);const r=e=>({table:n.css`
    width: 100%;
    border-radius: ${e.shape.borderRadius()};
    border: solid 1px ${e.colors.border.weak};
    background-color: ${e.colors.background.secondary};

    th {
      padding: ${e.spacing(1)};
    }

    td {
      padding: 0 ${e.spacing(1)};
    }

    tr {
      height: 38px;
    }
  `,evenRow:n.css`
    background-color: ${e.colors.background.primary};
  `,colExpand:n.css`
    width: 36px;
  `,actionsCell:n.css`
    text-align: right;
    width: 1%;
    white-space: nowrap;

    & > * + * {
      margin-left: ${e.spacing(.5)};
    }
  `})}}]);
//# sourceMappingURL=AlertSilences.48082ee02828fef83927.js.map