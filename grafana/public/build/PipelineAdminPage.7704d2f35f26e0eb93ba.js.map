{"version":3,"file":"PipelineAdminPage.7704d2f35f26e0eb93ba.js","mappings":"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","sources":["webpack://grafana/./public/app/features/live/pages/AddNewRule.tsx","webpack://grafana/./public/app/features/live/pages/RuleSettingsEditor.tsx","webpack://grafana/./public/app/features/live/pages/RuleSettingsArray.tsx","webpack://grafana/./public/app/features/live/pages/RuleTest.tsx","webpack://grafana/./public/app/features/live/pages/utils.ts","webpack://grafana/./public/app/features/live/pages/RuleModal.tsx","webpack://grafana/./public/app/features/live/pages/PipelineTable.tsx","webpack://grafana/./public/app/features/live/pages/PipelineAdminPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\n\nimport { DataSourceRef, LiveChannelScope, SelectableValue } from '@grafana/data';\nimport { DataSourcePicker, getBackendSrv } from '@grafana/runtime';\nimport { Input, Field, Button, ValuePicker, HorizontalGroup } from '@grafana/ui';\nimport { useAppNotification } from 'app/core/copy/appNotification';\n\nimport { Rule } from './types';\n\ninterface Props {\n  onRuleAdded: (rule: Rule) => void;\n}\n\ntype PatternType = 'ds' | 'any';\n\nconst patternTypes: Array<SelectableValue<PatternType>> = [\n  {\n    label: 'Data source',\n    description: 'Configure a channel scoped to a data source instance',\n    value: 'ds',\n  },\n  {\n    label: 'Any',\n    description: 'Enter an arbitray channel pattern',\n    value: 'any',\n  },\n];\n\nexport function AddNewRule({ onRuleAdded }: Props) {\n  const [patternType, setPatternType] = useState<PatternType>();\n  const [pattern, setPattern] = useState<string>();\n  const [patternPrefix, setPatternPrefix] = useState<string>('');\n  const [datasource, setDatasource] = useState<DataSourceRef>();\n  const notifyApp = useAppNotification();\n\n  const onSubmit = () => {\n    if (!pattern) {\n      notifyApp.error('Enter path');\n      return;\n    }\n    if (patternType === 'ds' && !patternPrefix.length) {\n      notifyApp.error('Select datasource');\n      return;\n    }\n\n    getBackendSrv()\n      .post(`api/live/channel-rules`, {\n        pattern: patternPrefix + pattern,\n        settings: {\n          converter: {\n            type: 'jsonAuto',\n          },\n          frameOutputs: [\n            {\n              type: 'managedStream',\n            },\n          ],\n        },\n      })\n      .then((v: any) => {\n        console.log('ADDED', v);\n        setPattern(undefined);\n        setPatternType(undefined);\n        onRuleAdded(v.rule);\n      })\n      .catch((e) => {\n        notifyApp.error('Error adding rule', e);\n        e.isHandled = true;\n      });\n  };\n\n  if (patternType) {\n    return (\n      <div>\n        <HorizontalGroup>\n          {patternType === 'any' && (\n            <Field label=\"Pattern\">\n              <Input\n                value={pattern ?? ''}\n                onChange={(e) => setPattern(e.currentTarget.value)}\n                placeholder=\"scope/namespace/path\"\n              />\n            </Field>\n          )}\n          {patternType === 'ds' && (\n            <>\n              <Field label=\"Data source\">\n                <DataSourcePicker\n                  current={datasource}\n                  onChange={(ds) => {\n                    setDatasource(ds);\n                    setPatternPrefix(`${LiveChannelScope.DataSource}/${ds.uid}/`);\n                  }}\n                />\n              </Field>\n              <Field label=\"Path\">\n                <Input value={pattern ?? ''} onChange={(e) => setPattern(e.currentTarget.value)} placeholder=\"path\" />\n              </Field>\n            </>\n          )}\n\n          <Field label=\"\">\n            <Button onClick={onSubmit} variant={pattern?.length ? 'primary' : 'secondary'}>\n              Add\n            </Button>\n          </Field>\n\n          <Field label=\"\">\n            <Button variant=\"secondary\" onClick={() => setPatternType(undefined)}>\n              Cancel\n            </Button>\n          </Field>\n        </HorizontalGroup>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <ValuePicker\n        label=\"Add channel rule\"\n        variant=\"secondary\"\n        size=\"md\"\n        icon=\"plus\"\n        menuPlacement=\"auto\"\n        isFullWidth={false}\n        options={patternTypes}\n        onChange={(v) => setPatternType(v.value)}\n      />\n    </div>\n  );\n}\n","import React from 'react';\n\nimport { CodeEditor, Select } from '@grafana/ui';\n\nimport { RuleType, RuleSetting, PipeLineEntitiesInfo } from './types';\n\ninterface Props {\n  ruleType: RuleType;\n  onChange: (value: RuleSetting) => void;\n  value: RuleSetting;\n  entitiesInfo: PipeLineEntitiesInfo;\n}\n\nexport const RuleSettingsEditor = ({ onChange, value, ruleType, entitiesInfo }: Props) => {\n  return (\n    <>\n      <Select\n        key={ruleType}\n        options={entitiesInfo[ruleType]}\n        placeholder=\"Select an option\"\n        value={value?.type ?? ''}\n        onChange={(value) => {\n          // set the body with example\n          const type = value.value;\n          onChange({\n            type,\n            [type]: entitiesInfo.getExample(ruleType, type),\n          });\n        }}\n      />\n      <CodeEditor\n        height={'50vh'}\n        value={value ? JSON.stringify(value[value.type], null, '\\t') : ''}\n        showLineNumbers={true}\n        readOnly={false}\n        language=\"json\"\n        showMiniMap={false}\n        onBlur={(text: string) => {\n          const body = JSON.parse(text);\n          onChange({\n            type: value.type,\n            [value.type]: body,\n          });\n        }}\n      />\n    </>\n  );\n};\n","import React, { useState } from 'react';\n\nimport { SelectableValue } from '@grafana/data';\nimport { Select } from '@grafana/ui';\n\nimport { RuleSettingsEditor } from './RuleSettingsEditor';\nimport { RuleType, RuleSetting, PipeLineEntitiesInfo } from './types';\n\ninterface Props {\n  ruleType: RuleType;\n  onChange: (value: RuleSetting[]) => void;\n  value: RuleSetting[];\n  entitiesInfo: PipeLineEntitiesInfo;\n}\n\nexport const RuleSettingsArray = ({ onChange, value, ruleType, entitiesInfo }: Props) => {\n  const [index, setIndex] = useState<number>(0);\n  const arr = value ?? [];\n  const onRuleChange = (v: RuleSetting) => {\n    if (!value) {\n      onChange([v]);\n    } else {\n      const copy = [...value];\n      copy[index] = v;\n      onChange(copy);\n    }\n  };\n  // create array of value.length + 1\n  let indexArr: Array<SelectableValue<number>> = [];\n  for (let i = 0; i <= arr.length; i++) {\n    indexArr.push({\n      label: `${ruleType}: ${i}`,\n      value: i,\n    });\n  }\n\n  return (\n    <>\n      <Select\n        placeholder=\"Select an index\"\n        options={indexArr}\n        value={index}\n        onChange={(index) => {\n          // set index to find the correct setting\n          setIndex(index.value!);\n        }}\n      ></Select>\n      <RuleSettingsEditor onChange={onRuleChange} value={arr[index]} ruleType={ruleType} entitiesInfo={entitiesInfo} />\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport React, { useState } from 'react';\n\nimport { dataFrameFromJSON, getDisplayProcessor } from '@grafana/data';\nimport { getBackendSrv, config } from '@grafana/runtime';\nimport { Button, CodeEditor, Table, Field } from '@grafana/ui';\n\nimport { ChannelFrame, Rule } from './types';\n\ninterface Props {\n  rule: Rule;\n}\n\nexport const RuleTest = (props: Props) => {\n  const [response, setResponse] = useState<ChannelFrame[]>();\n  const [data, setData] = useState<string>();\n\n  const onBlur = (text: string) => {\n    setData(text);\n  };\n\n  const onClick = () => {\n    getBackendSrv()\n      .post(`api/live/pipeline-convert-test`, {\n        channelRules: [props.rule],\n        channel: props.rule.pattern,\n        data: data,\n      })\n      .then((data: any) => {\n        const t = data.channelFrames as any[];\n        if (t) {\n          setResponse(\n            t.map((f) => {\n              const frame = dataFrameFromJSON(f.frame);\n              for (const field of frame.fields) {\n                field.display = getDisplayProcessor({ field, theme: config.theme2 });\n              }\n              return { channel: f.channel, frame };\n            })\n          );\n        }\n      })\n      .catch((e) => {\n        setResponse(e);\n      });\n  };\n\n  return (\n    <div>\n      <CodeEditor\n        height={100}\n        value=\"\"\n        showLineNumbers={true}\n        readOnly={false}\n        language=\"json\"\n        showMiniMap={false}\n        onBlur={onBlur}\n      />\n\n      <Button onClick={onClick} className={styles.margin}>\n        Test\n      </Button>\n\n      {response?.length &&\n        response.map((r) => (\n          <Field key={r.channel} label={r.channel}>\n            <Table data={r.frame} width={700} height={Math.min(10 * r.frame.length + 10, 150)} showTypeIcons></Table>\n          </Field>\n        ))}\n    </div>\n  );\n};\n\nconst styles = {\n  margin: css`\n    margin-bottom: 15px;\n  `,\n};\n","import { getBackendSrv } from '@grafana/runtime';\n\nimport { PipelineListOption, PipeLineEntitiesInfo } from './types';\n\nexport async function getPipeLineEntities(): Promise<PipeLineEntitiesInfo> {\n  return await getBackendSrv()\n    .get(`api/live/pipeline-entities`)\n    .then((data) => {\n      return {\n        converter: transformLabel(data, 'converters'),\n        frameProcessors: transformLabel(data, 'frameProcessors'),\n        frameOutputs: transformLabel(data, 'frameOutputs'),\n        getExample: (ruleType, type) => {\n          return data[`${ruleType}s`]?.filter((option: PipelineListOption) => option.type === type)?.[0]?.['example'];\n        },\n      };\n    });\n}\n\nexport function transformLabel(data: any, key: keyof typeof data) {\n  if (Array.isArray(data)) {\n    return data.map((d) => ({\n      label: d[key],\n      value: d[key],\n    }));\n  }\n  return data[key].map((typeObj: PipelineListOption) => ({\n    label: typeObj.type,\n    value: typeObj.type,\n  }));\n}\n","import { css } from '@emotion/css';\nimport React, { useState, useMemo } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Modal, TabContent, TabsBar, Tab, Button } from '@grafana/ui';\n\nimport { RuleSettingsArray } from './RuleSettingsArray';\nimport { RuleSettingsEditor } from './RuleSettingsEditor';\nimport { RuleTest } from './RuleTest';\nimport { Rule, RuleType, PipeLineEntitiesInfo, RuleSetting } from './types';\nimport { getPipeLineEntities } from './utils';\n\ninterface Props {\n  rule: Rule;\n  isOpen: boolean;\n  onClose: () => void;\n  clickColumn: RuleType;\n}\ninterface TabInfo {\n  label: string;\n  type?: RuleType;\n  isTest?: boolean;\n  isConverter?: boolean;\n  icon?: string;\n}\nconst tabs: TabInfo[] = [\n  { label: 'Converter', type: 'converter', isConverter: true },\n  { label: 'Processors', type: 'frameProcessors' },\n  { label: 'Outputs', type: 'frameOutputs' },\n  { label: 'Test', isTest: true, icon: 'flask' },\n];\n\nexport const RuleModal = (props: Props) => {\n  const { isOpen, onClose, clickColumn } = props;\n  const [rule, setRule] = useState<Rule>(props.rule);\n  const [activeTab, setActiveTab] = useState<TabInfo | undefined>(tabs.find((t) => t.type === clickColumn));\n  // to show color of Save button\n  const [hasChange, setChange] = useState<boolean>(false);\n  const [ruleSetting, setRuleSetting] = useState<any>(activeTab?.type ? rule?.settings?.[activeTab.type] : undefined);\n  const [entitiesInfo, setEntitiesInfo] = useState<PipeLineEntitiesInfo>();\n\n  const onRuleSettingChange = (value: RuleSetting | RuleSetting[]) => {\n    setChange(true);\n    if (activeTab?.type) {\n      setRule({\n        ...rule,\n        settings: {\n          ...rule.settings,\n          [activeTab?.type]: value,\n        },\n      });\n    }\n    setRuleSetting(value);\n  };\n\n  // load pipeline entities info\n  useMemo(() => {\n    getPipeLineEntities().then((data) => {\n      setEntitiesInfo(data);\n    });\n  }, []);\n\n  const onSave = () => {\n    getBackendSrv()\n      .put(`api/live/channel-rules`, rule)\n      .then(() => {\n        setChange(false);\n        onClose();\n      })\n      .catch((e) => console.error(e));\n  };\n\n  return (\n    <Modal isOpen={isOpen} title={rule.pattern} onDismiss={onClose} closeOnEscape>\n      <TabsBar>\n        {tabs.map((tab, index) => {\n          return (\n            <Tab\n              key={index}\n              label={tab.label}\n              active={tab === activeTab}\n              icon={tab.icon as any}\n              onChangeTab={() => {\n                setActiveTab(tab);\n                if (tab.type) {\n                  // to notify children of the new rule\n                  setRuleSetting(rule?.settings?.[tab.type]);\n                }\n              }}\n            />\n          );\n        })}\n      </TabsBar>\n      <TabContent>\n        {entitiesInfo && rule && activeTab && (\n          <>\n            {activeTab?.isTest && <RuleTest rule={rule} />}\n            {activeTab.isConverter && (\n              <RuleSettingsEditor\n                onChange={onRuleSettingChange}\n                value={ruleSetting}\n                ruleType={'converter'}\n                entitiesInfo={entitiesInfo}\n              />\n            )}\n            {!activeTab.isConverter && activeTab.type && (\n              <RuleSettingsArray\n                onChange={onRuleSettingChange}\n                value={ruleSetting}\n                ruleType={activeTab.type}\n                entitiesInfo={entitiesInfo}\n              />\n            )}\n          </>\n        )}\n        <Button onClick={onSave} className={styles.save} variant={hasChange ? 'primary' : 'secondary'}>\n          Save\n        </Button>\n      </TabContent>\n    </Modal>\n  );\n};\n\nconst styles = {\n  save: css`\n    margin-top: 5px;\n  `,\n};\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Tag, IconButton } from '@grafana/ui';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\n\nimport { RuleModal } from './RuleModal';\nimport { Rule, Output, RuleType } from './types';\n\nfunction renderOutputTags(key: string, output?: Output): React.ReactNode {\n  if (!output?.type) {\n    return null;\n  }\n  return <Tag key={key} name={output.type} />;\n}\n\ninterface Props {\n  rules: Rule[];\n  onRuleChanged: () => void;\n  selectRule?: Rule;\n}\n\nexport const PipelineTable = (props: Props) => {\n  const { rules } = props;\n  const [isOpen, setOpen] = useState(false);\n  const [selectedRule, setSelectedRule] = useState<Rule>();\n  const [clickColumn, setClickColumn] = useState<RuleType>('converter');\n\n  const onRowClick = (rule: Rule, event?: any) => {\n    if (!rule) {\n      return;\n    }\n    let column = event?.target?.getAttribute('data-column');\n    if (!column || column === 'pattern') {\n      column = 'converter';\n    }\n    setClickColumn(column);\n    setSelectedRule(rule);\n    setOpen(true);\n  };\n\n  // Supports selecting a rule from external config (after add rule)\n  useEffect(() => {\n    if (props.selectRule) {\n      onRowClick(props.selectRule);\n    }\n  }, [props.selectRule]);\n\n  const onRemoveRule = (pattern: string) => {\n    getBackendSrv()\n      .delete(`api/live/channel-rules`, JSON.stringify({ pattern: pattern }))\n      .catch((e) => console.error(e))\n      .finally(() => {\n        props.onRuleChanged();\n      });\n  };\n\n  const renderPattern = (pattern: string) => {\n    if (pattern.startsWith('ds/')) {\n      const idx = pattern.indexOf('/', 4);\n      if (idx > 3) {\n        const uid = pattern.substring(3, idx);\n        const ds = getDatasourceSrv().getInstanceSettings(uid);\n        if (ds) {\n          return (\n            <div>\n              <Tag name={ds.name} colorIndex={1} /> &nbsp;\n              <span>{pattern.substring(idx + 1)}</span>\n            </div>\n          );\n        }\n      }\n    }\n    return pattern;\n  };\n\n  return (\n    <div>\n      <div className=\"admin-list-table\">\n        <table className=\"filter-table filter-table--hover form-inline\">\n          <thead>\n            <tr>\n              <th>Channel</th>\n              <th>Converter</th>\n              <th>Processor</th>\n              <th>Output</th>\n              <th style={{ width: 10 }}>&nbsp;</th>\n            </tr>\n          </thead>\n          <tbody>\n            {rules.map((rule) => (\n              <tr key={rule.pattern} onClick={(e) => onRowClick(rule, e)} className={styles.row}>\n                <td data-pattern={rule.pattern} data-column=\"pattern\">\n                  {renderPattern(rule.pattern)}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"converter\">\n                  {rule.settings?.converter?.type}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"processor\">\n                  {rule.settings?.frameProcessors?.map((processor) => (\n                    <span key={rule.pattern + processor.type}>{processor.type}</span>\n                  ))}\n                </td>\n                <td data-pattern={rule.pattern} data-column=\"output\">\n                  {rule.settings?.frameOutputs?.map((output) => (\n                    <span key={rule.pattern + output.type}>{renderOutputTags('out', output)}</span>\n                  ))}\n                </td>\n                <td>\n                  <IconButton\n                    name=\"trash-alt\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      onRemoveRule(rule.pattern);\n                    }}\n                  ></IconButton>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n      {isOpen && selectedRule && (\n        <RuleModal\n          rule={selectedRule}\n          isOpen={isOpen}\n          onClose={() => {\n            setOpen(false);\n          }}\n          clickColumn={clickColumn}\n        />\n      )}\n    </div>\n  );\n};\n\nconst styles = {\n  row: css`\n    cursor: pointer;\n  `,\n};\n","import React, { useEffect, useState, ChangeEvent } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Input } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { useNavModel } from 'app/core/hooks/useNavModel';\n\nimport { AddNewRule } from './AddNewRule';\nimport { PipelineTable } from './PipelineTable';\nimport { Rule } from './types';\n\nexport default function PipelineAdminPage() {\n  const [rules, setRules] = useState<Rule[]>([]);\n  const [defaultRules, setDefaultRules] = useState<any[]>([]);\n  const [newRule, setNewRule] = useState<Rule>();\n  const navModel = useNavModel('live-pipeline');\n  const [error, setError] = useState<string>();\n\n  const loadRules = () => {\n    getBackendSrv()\n      .get(`api/live/channel-rules`)\n      .then((data) => {\n        setRules(data.rules ?? []);\n        setDefaultRules(data.rules ?? []);\n      })\n      .catch((e) => {\n        if (e.data) {\n          setError(JSON.stringify(e.data, null, 2));\n        }\n      });\n  };\n\n  useEffect(() => {\n    loadRules();\n  }, []);\n\n  const onSearchQueryChange = (e: ChangeEvent<HTMLInputElement>) => {\n    if (e.target.value) {\n      setRules(rules.filter((rule) => rule.pattern.toLowerCase().includes(e.target.value.toLowerCase())));\n    } else {\n      setRules(defaultRules);\n    }\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        {error && <pre>{error}</pre>}\n        <div className=\"page-action-bar\">\n          <div className=\"gf-form gf-form--grow\">\n            <Input placeholder=\"Search pattern...\" onChange={onSearchQueryChange} />\n          </div>\n        </div>\n\n        <PipelineTable rules={rules} onRuleChanged={loadRules} selectRule={newRule} />\n\n        <AddNewRule\n          onRuleAdded={(r: Rule) => {\n            console.log('GOT', r, 'vs', rules[0]);\n            setNewRule(r);\n            loadRules();\n          }}\n        />\n      </Page.Contents>\n    </Page>\n  );\n}\n"],"names":["patternTypes","label","description","value","AddNewRule","onRuleAdded","patternType","setPatternType","useState","pattern","setPattern","patternPrefix","setPatternPrefix","datasource","setDatasource","notifyApp","useAppNotification","onSubmit","length","getBackendSrv","post","settings","converter","type","frameOutputs","then","v","console","log","undefined","rule","catch","e","error","isHandled","Field","Input","I","onChange","currentTarget","placeholder","DataSourcePicker","current","ds","LiveChannelScope","uid","Button","onClick","variant","ValuePicker","size","icon","menuPlacement","isFullWidth","options","RuleSettingsEditor","ruleType","entitiesInfo","Select","getExample","CodeEditor","height","JSON","stringify","showLineNumbers","readOnly","language","showMiniMap","onBlur","text","body","parse","RuleSettingsArray","index","setIndex","arr","indexArr","i","push","copy","RuleTest","props","response","setResponse","data","setData","channelRules","channel","t","channelFrames","map","f","frame","dataFrameFromJSON","field","fields","display","getDisplayProcessor","theme","config","className","styles","margin","r","Table","width","Math","min","showTypeIcons","css","transformLabel","key","Array","isArray","d","typeObj","tabs","isConverter","isTest","RuleModal","isOpen","onClose","clickColumn","setRule","activeTab","setActiveTab","find","hasChange","setChange","ruleSetting","setRuleSetting","setEntitiesInfo","onRuleSettingChange","useMemo","async","get","frameProcessors","filter","option","getPipeLineEntities","Modal","title","onDismiss","closeOnEscape","TabsBar","tab","Tab","active","onChangeTab","TabContent","put","save","renderOutputTags","output","Tag","name","PipelineTable","rules","setOpen","selectedRule","setSelectedRule","setClickColumn","onRowClick","event","column","target","getAttribute","useEffect","selectRule","renderPattern","startsWith","idx","indexOf","substring","getDatasourceSrv","getInstanceSettings","colorIndex","style","row","processor","IconButton","stopPropagation","delete","finally","onRuleChanged","PipelineAdminPage","setRules","defaultRules","setDefaultRules","newRule","setNewRule","navModel","useNavModel","setError","loadRules","Page","toLowerCase","includes"],"sourceRoot":""}