"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1454],{12176:(e,t,n)=>{n.d(t,{l:()=>Le});var s=n(68404),i=n(36635),a=n(115),r=n(29705),o=n(31423),l=n(52370),d=n(45916);function c(e){let{children:t,width:n,height:i,onLoad:a,onChange:r}=e;const h=(0,l.L)(),[p,u]=(0,s.useState)(!1),[g,m]=(0,s.useState)(!1),f=(0,s.useRef)(null);return(0,o.Z)((()=>{c.addCallback(h,(e=>{!p&&e.isIntersecting&&(u(!0),null==a||a()),m(e.isIntersecting),null==r||r(e.isIntersecting)}));const e=f.current;return e&&c.observer.observe(e),()=>{delete c.callbacks[h],e&&c.observer.unobserve(e),0===Object.keys(c.callbacks).length&&c.observer.disconnect()}})),(0,d.jsx)("div",{id:h,ref:f,style:{width:n,height:i},children:p&&("function"==typeof t?t({isInView:g}):t)})}c.callbacks={},c.addCallback=(e,t)=>c.callbacks[e]=t,c.observer=new IntersectionObserver((e=>{for(const t of e)c.callbacks[t.target.id](t)}),{rootMargin:"100px"});var h=n(9085),p=n.n(h),u=n(95484),g=n(28173),m=n(12717),f=n(25004),v=n(70194),b=n(80795),x=n(46782),C=n(42949),w=n(17321);function y(e){return/(d-solo|dashboard-solo)/.test(null==e?void 0:e.toLowerCase())}var S,k=n(53091),j=n(52423),I=n(16755),P=n(55910),D=n(99500),E=n(48951),O=n(54958),N=n(21888);const R=e=>{let{state:t,onClick:n}=e;const s=(0,I.wW)(T);return t===g.Gu.Loading?(0,d.jsx)("div",{className:"panel-loading",onClick:n,children:S||(S=(0,d.jsx)(N.u,{content:"Cancel query",children:(0,d.jsx)(D.J,{className:"panel-loading__spinner spin-clockwise",name:"sync"})}))}):t===g.Gu.Streaming?(0,d.jsx)("div",{className:"panel-loading",onClick:n,children:(0,d.jsx)("div",{title:"Streaming (click to stop)",className:s.streamIndicator})}):null};function T(e){return{streamIndicator:j.css`
      width: 10px;
      height: 10px;
      background: ${e.colors.text.disabled};
      box-shadow: 0 0 2px ${e.colors.text.disabled};
      border-radius: 50%;
      position: relative;
      top: 6px;
      right: 1px;
    `}}const V=["children"];const A=e=>{let{children:t}=e,n=function(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,V);const[i,a]=(0,s.useState)({x:0,y:0}),[r,o]=(0,s.useState)(!1),l=(0,s.useCallback)((e=>{(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3.5;return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)<=n})(i,L(e))&&o(!r)}),[i,r,o]),c=(0,s.useCallback)((e=>{a(L(e))}),[a]);return(0,d.jsx)("header",Object.assign({},n,{className:"panel-title-container",onClick:l,onMouseDown:c,children:t({panelMenuOpen:r,closeMenu:()=>o(!1)})}))};function L(e){return{x:e.clientX,y:e.clientY}}var F=n(73320);class M extends s.PureComponent{constructor(){var e,t,n,s;super(...arguments),e=this,s=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,d.jsx)("ul",{className:"dropdown-menu dropdown-menu--menu panel-menu",role:n?"":"menu",children:t.map(((t,n)=>(0,d.jsx)(F.u,{type:t.type,text:t.text,iconClassName:t.iconClassName,onClick:t.onClick,shortcut:t.shortcut,children:t.subMenu&&e.renderItems(t.subMenu,!0)},`${t.text}${n}`)))})},(n="renderItems")in(t=this)?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s}render(){return(0,d.jsx)("div",{className:"panel-menu-container dropdown open",children:this.renderItems(this.props.items)})}}var U=n(64850),z=n(31181),_=n(8910),q=n(35448),H=n(59196),Q=n(11848),$=n(13631),W=n(34944),B=n(43437),G=n(63454),J=n(25822);const Z=e=>{let{panel:t,dashboard:n,children:i}=e;const[a,r]=(0,s.useState)([]),o=(0,U.v9)((e=>{var n;return null===(n=(0,w.i)(e,t))||void 0===n?void 0:n.angularComponent}));return(0,s.useEffect)((()=>{r(function(e,t,n){const s=e=>{e.preventDefault(),b.E1.partial({viewPanel:t.id})},i=e=>{e.preventDefault(),b.E1.partial({editPanel:t.id})},a=n=>{n.preventDefault(),(0,$.Kq)(e,t)},r=e=>{e.preventDefault(),(0,$.oe)(t)},o=e=>{b.E1.partial({inspect:t.id,inspectTab:e}),(0,z.ff)("grafana_panel_menu_inspect",{tab:null!=e?e:W.q.Data})},l=e=>{e.preventDefault()},d=n=>{n.preventDefault(),(0,$.jN)(e,t)},c=e=>{e.preventDefault(),(0,$.bY)(t)},h=n=>{n.preventDefault(),(0,$.WJ)(e,t,!0)},p=e=>{e.preventDefault();const n=e.ctrlKey||e.metaKey?e=>window.open(`${x.ZP.appSubUrl}${e}`):void 0;G.h.dispatch((0,J.m$)(t,{getDataSourceSrv:_.F,getTimeSrv:k.$t,getExploreUrl:Q.H6,openInNewWindow:n}))},u=e=>{e.preventDefault(),(0,$.qw)(t)},g=[];if(!t.isEditing){const e=(0,q.t)("panel.header-menu.view","View");g.push({text:e,iconClassName:"eye",onClick:s,shortcut:"v"})}e.canEditPanel(t)&&!t.isEditing&&g.push({text:"Edit",iconClassName:"edit",onClick:i,shortcut:"e"});const m=(0,q.t)("panel.header-menu.share","Share");g.push({text:m,iconClassName:"share-alt",onClick:n=>{n.preventDefault(),(0,$.Po)(e,t)},shortcut:"p s"}),!H.Vt.hasAccessToExplore()||t.plugin&&t.plugin.meta.skipDataQuery||g.push({text:"Explore",iconClassName:"compass",onClick:p,shortcut:"x"});const f=[];if(t.plugin&&!t.plugin.meta.skipDataQuery){const t=(0,q.t)("panel.header-menu.inspect-data","Data");f.push({text:t,onClick:e=>o(W.q.Data)}),e.meta.canEdit&&f.push({text:"Query",onClick:e=>o(W.q.Query)})}const v=(0,q.t)("panel.header-menu.inspect-json","Panel JSON");f.push({text:v,onClick:e=>o(W.q.JSON)});const C=(0,q.t)("panel.header-menu.inspect","Inspect");g.push({type:"submenu",text:C,iconClassName:"info-circle",onClick:e=>o(),shortcut:"i",subMenu:f});const w=[],y=e.canEditPanel(t);if(!y||t.isViewing||t.isEditing||(w.push({text:"Duplicate",onClick:d,shortcut:"p d"}),w.push({text:"Copy",onClick:c}),(0,B.V)(t)?w.push({text:"Unlink library panel",onClick:r}):w.push({text:"Create library panel",onClick:a})),n){const e=n.getScope(),t=e.$$childHead.ctrl,s=t.getExtendedMenu();for(const n of s){const s={text:n.text,href:n.href,shortcut:n.shortcut};n.click&&(s.onClick=()=>{e.$eval(n.click,{ctrl:t})}),w.push(s)}}if(t.options.legend&&w.push({text:t.options.legend.showLegend?(0,q.t)("panel.header-menu.hide-legend","Hide legend"):(0,q.t)("panel.header-menu.show-legend","Show legend"),onClick:u,shortcut:"p l"}),t.isEditing&&(w.length=0),y&&t.plugin&&!t.plugin.meta.skipDataQuery&&w.push({text:"Get help",onClick:e=>o(W.q.Help)}),w.length){const e=(0,q.t)("panel.header-menu.more","More...");g.push({type:"submenu",text:e,iconClassName:"cube",subMenu:w,onClick:l})}return!e.canEditPanel(t)||t.isEditing||t.isViewing||(g.push({type:"divider",text:""}),g.push({text:"Remove",iconClassName:"trash-alt",onClick:h,shortcut:"p r"})),g}(n,t,o))}),[n,t,o,r]),i({items:a})},K=e=>{let{panel:t,dashboard:n}=e;return(0,d.jsx)(Z,{panel:t,dashboard:n,children:e=>{let{items:t}=e;return(0,d.jsx)(M,{items:t})}})},Y=e=>{let{notice:t,onClick:n}=e;const s="error"===t.severity||"warning"===t.severity?"exclamation-triangle":"info-circle";return(0,d.jsx)(N.u,{content:t.text,children:t.inspect?(0,d.jsx)("div",{className:"panel-info-notice pointer",onClick:e=>n(e,t.inspect),children:(0,d.jsx)(D.J,{name:s,style:{marginRight:"8px"}})}):(0,d.jsx)("a",{className:"panel-info-notice",href:t.link,target:"_blank",rel:"noreferrer",children:(0,d.jsx)(D.J,{name:s,style:{marginRight:"8px"}})})},t.severity)},X=e=>{let{frames:t,panelId:n}=e;const i=(0,s.useCallback)(((e,t)=>{e.stopPropagation(),b.E1.partial({inspect:n,inspectTab:t})}),[n]),a={};for(const e of t)if(e.meta&&e.meta.notices)for(const t of e.meta.notices)a[t.severity]=t;return(0,d.jsx)(d.Fragment,{children:Object.values(a).map((e=>(0,d.jsx)(Y,{notice:e,onClick:i},e.severity)))})};var ee,te;const ne=e=>{let{panel:t,error:n,isViewing:s,isEditing:i,data:a,alertState:r,dashboard:o}=e;const l=t.getDisplayTitle(),c=(0,j.cx)("panel-header",s||i?"":"grid-drag-handle"),h=(0,I.wW)(se);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(R,{state:a.state,onClick:()=>t.getQueryRunner().cancelQuery()}),(0,d.jsx)(O.Z,{panel:t,title:t.title,description:t.description,scopedVars:t.scopedVars,links:(0,E.H)(t),error:n}),(0,d.jsx)("div",{className:c,children:(0,d.jsx)(A,{"data-testid":f.wl.components.Panels.Panel.title(l),children:e=>{let{closeMenu:n,panelMenuOpen:s}=e;return(0,d.jsx)(P.L,{onClick:n,parent:document,children:(0,d.jsxs)("div",{className:"panel-title",children:[(0,d.jsx)(X,{frames:a.series,panelId:t.id}),r?(0,d.jsx)(D.J,{name:"alerting"===r?"heart-break":"heart",className:"icon-gf panel-alert-icon",style:{marginRight:"4px"},size:"sm"}):null,(0,d.jsx)("h2",{className:h.titleText,children:l}),!o.meta.publicDashboardAccessToken&&(0,d.jsxs)("div",{"data-testid":"panel-dropdown",children:[ee||(ee=(0,d.jsx)(D.J,{name:"angle-down",className:"panel-menu-toggle"})),s?(0,d.jsx)(K,{panel:t,dashboard:o,onClose:n}):null]}),a.request&&a.request.timeInfo&&(0,d.jsxs)("span",{className:"panel-time-info",children:[te||(te=(0,d.jsx)(D.J,{name:"clock-nine",size:"sm"}))," ",a.request.timeInfo]})]})})}})})]})},se=e=>({titleText:j.css`
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      max-width: calc(100% - 38px);
      cursor: pointer;
      font-weight: ${e.typography.fontWeightMedium};
      font-size: ${e.typography.body.fontSize};
      margin: 0;

      &:hover {
        color: ${e.colors.text.primary};
      }
      .panel-has-alert & {
        max-width: calc(100% - 54px);
      }
    `});function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ae extends s.PureComponent{constructor(e){super(e),ie(this,"element",null),ie(this,"timeSrv",(0,k.$t)()),ie(this,"scopeProps",void 0),ie(this,"subs",new u.w0),this.state={data:{state:g.Gu.NotStarted,series:[],timeRange:(0,m.JK)()}}}componentDidMount(){const{panel:e}=this.props;this.loadAngularPanel();const t=e.getQueryRunner();this.subs.add(t.getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:e=>this.onPanelDataUpdate(e)}))}onPanelDataUpdate(e){let t;if(e.state===g.Gu.Error){const{error:n}=e;n&&t!==n.message&&(t=n.message)}this.setState({data:e,errorMessage:t})}componentWillUnmount(){var e;(this.subs.unsubscribe(),this.props.angularComponent)&&(null===(e=this.props.angularComponent)||void 0===e||e.destroy())}componentDidUpdate(e,t){const{plugin:n,height:s,width:i,panel:a}=this.props;e.plugin!==n&&this.loadAngularPanel(),e.width===i&&e.height===s||this.scopeProps&&(this.scopeProps.size.height=this.getInnerPanelHeight(),this.scopeProps.size.width=this.getInnerPanelWidth(),a.render())}getInnerPanelHeight(){const{plugin:e,height:t}=this.props,{theme:n}=x.ZP;return t-(this.hasOverlayHeader()?0:n.panelHeaderHeight)-2*(e.noPadding?0:n.panelPadding)-C.QO}getInnerPanelWidth(){const{plugin:e,width:t}=this.props,{theme:n}=x.ZP;return t-2*(e.noPadding?0:n.panelPadding)-C.QO}loadAngularPanel(){const{panel:e,dashboard:t,setPanelAngularComponent:n}=this.props;if(!this.element)return;const s=(0,v.w)();this.scopeProps={panel:e,dashboard:t,size:{width:this.getInnerPanelWidth(),height:this.getInnerPanelHeight()}},n({key:e.key,angularComponent:s.load(this.element,this.scopeProps,'<plugin-component type="panel" class="panel-height-helper"></plugin-component>')})}hasOverlayHeader(){const{panel:e}=this.props,{data:t}=this.state;return(!t.request||!t.request.timeInfo)&&!e.hasTitle()}render(){var e;const{dashboard:t,panel:n,isViewing:s,isEditing:i,plugin:a}=this.props,{errorMessage:r,data:o}=this.state,{transparent:l}=n,c=null===(e=o.alertState)||void 0===e?void 0:e.state,h=p()({"panel-container":!0,"panel-container--absolute":y(b.E1.getLocation().pathname),"panel-container--transparent":l,"panel-container--no-title":this.hasOverlayHeader(),"panel-has-alert":void 0!==n.alert,[`panel-alert-state--${c}`]:void 0!==c}),u=p()({"panel-content":!0,"panel-content--no-padding":a.noPadding});return(0,d.jsxs)("div",{className:h,"aria-label":f.wl.components.Panels.Panel.containerByTitle(n.title),children:[(0,d.jsx)(ne,{panel:n,dashboard:t,title:n.title,description:n.description,links:n.links,error:r,isViewing:s,isEditing:i,data:o,alertState:c}),(0,d.jsx)("div",{className:u,children:(0,d.jsx)("div",{ref:e=>this.element=e,className:"panel-height-helper"})})]})}}const re={setPanelAngularComponent:r.o8},oe=(0,i.connect)(((e,t)=>{var n;return{angularComponent:null===(n=(0,w.i)(e,t.panel))||void 0===n?void 0:n.angularComponent}}),re)(ae);var le=n(60053),de=n(92721),ce=n(88246),he=n(54316),pe=n(68633),ue=n(7213),ge=n(38251),me=n(65737),fe=n(27783),ve=n(20317),be=n(72767),xe=n(94080),Ce=n(31919),we=n(663);const ye=(e,t)=>({matcher:{id:Ce.mi.byName,options:e},properties:[Se(t)]}),Se=e=>({id:"color",value:{mode:we.S.Fixed,fixedColor:e}});var ke=n(8105),je=n(73144),Ie=n(45921),Pe=n(3420),De=n(14496),Ee=n(89704);function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ne extends s.PureComponent{constructor(e){super(e),Oe(this,"timeSrv",(0,k.$t)()),Oe(this,"subs",new u.w0),Oe(this,"eventFilter",{onlyLocal:!0}),Oe(this,"getSync",(()=>this.props.isEditing?le.m.Off:this.props.dashboard.graphTooltip)),Oe(this,"onInstanceStateChange",(e=>{this.props.onInstanceStateChange(e),this.setState({context:Object.assign({},this.state.context,{instanceState:e})})})),Oe(this,"onSeriesColorChange",((e,t)=>{this.onFieldConfigChange(((e,t,n)=>{const{overrides:s}=n,i=n.overrides.findIndex((t=>t.matcher.id===Ce.mi.byName&&t.matcher.options===e));if(i<0)return Object.assign({},n,{overrides:[...n.overrides,ye(e,t)]});const a=Array.from(s),r=a[i],o=r.properties.findIndex((e=>"color"===e.id));if(o<0)return a[i]=Object.assign({},r,{properties:[...r.properties,Se(t)]}),Object.assign({},n,{overrides:a});const l=Array.from(r.properties);return l[o]=Se(t),a[i]=Object.assign({},r,{properties:l}),Object.assign({},n,{overrides:a})})(e,t,this.props.panel.fieldConfig))})),Oe(this,"onSeriesVisibilityChange",((e,t)=>{this.onFieldConfigChange((0,De.N)(e,t,this.props.panel.fieldConfig,this.state.data.series))})),Oe(this,"onToggleLegendSort",(e=>{const t=this.props.panel.options.legend;if(!t)return;let n=t.sortDesc,s=t.sortBy;e!==s&&(n=void 0),!1===n?(s=void 0,n=void 0):(n=!n,s=e),this.onOptionsChange(Object.assign({},this.props.panel.options,{legend:Object.assign({},t,{sortBy:s,sortDesc:n})}))})),Oe(this,"onRefresh",(()=>{const{dashboard:e,panel:t,isInView:n,width:s}=this.props;if(!n)return void this.setState({refreshWhenInView:!0});const i=(0,$.W1)(t,this.timeSrv.timeRange());if(this.wantsQueryExecution){if(s<0)return;this.state.refreshWhenInView&&this.setState({refreshWhenInView:!1}),t.runAllPanelQueries({dashboardId:e.id,dashboardUID:e.uid,dashboardTimezone:e.getTimezone(),publicDashboardAccessToken:e.meta.publicDashboardAccessToken,timeData:i,width:s})}else this.setState({data:Object.assign({},this.state.data,{timeRange:this.timeSrv.timeRange()}),renderCounter:this.state.renderCounter+1,liveTime:void 0})})),Oe(this,"onRender",(()=>{const e={renderCounter:this.state.renderCounter+1};this.setState(e)})),Oe(this,"onOptionsChange",(e=>{this.props.panel.updateOptions(e)})),Oe(this,"onFieldConfigChange",(e=>{this.props.panel.updateFieldConfig(e)})),Oe(this,"onPanelError",(e=>{const t=e.message||"Error in plugin";this.state.errorMessage!==t&&this.setState({errorMessage:t})})),Oe(this,"onPanelErrorRecover",(()=>{this.setState({errorMessage:void 0})})),Oe(this,"onAnnotationCreate",(async e=>{const t=e.from!==e.to,n={dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:t,time:e.from,timeEnd:t?e.to:0,tags:e.tags,text:e.description};await(0,je.xD)(n),(0,Ie.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new de.n1(n))})),Oe(this,"onAnnotationDelete",(async e=>{await(0,je.Dl)({id:e}),(0,Ie.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new de.n1({id:e}))})),Oe(this,"onAnnotationUpdate",(async e=>{const t=e.from!==e.to,n={id:e.id,dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:t,time:e.from,timeEnd:t?e.to:0,tags:e.tags,text:e.description};await(0,je._E)(n),(0,Ie.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new de.n1(n))})),Oe(this,"onChangeTimeRange",(e=>{this.timeSrv.setTime({from:(0,ce.zh)(e.from),to:(0,ce.zh)(e.to)})}));const t=e.dashboard.events.newScopedBus(`panel:${e.panel.id}`,this.eventFilter);this.state={isFirstLoad:!0,renderCounter:0,refreshWhenInView:!1,context:{eventBus:t,app:this.getPanelContextApp(),sync:this.getSync,onSeriesColorChange:this.onSeriesColorChange,onToggleSeriesVisibility:this.onSeriesVisibilityChange,onAnnotationCreate:this.onAnnotationCreate,onAnnotationUpdate:this.onAnnotationUpdate,onAnnotationDelete:this.onAnnotationDelete,onInstanceStateChange:this.onInstanceStateChange,onToggleLegendSort:this.onToggleLegendSort,canAddAnnotations:e.dashboard.canAddAnnotations.bind(e.dashboard),canEditAnnotations:e.dashboard.canEditAnnotations.bind(e.dashboard),canDeleteAnnotations:e.dashboard.canDeleteAnnotations.bind(e.dashboard)},data:this.getInitialPanelDataState()}}getPanelContextApp(){return this.props.isEditing?he.zj.PanelEditor:this.props.isViewing?he.zj.PanelViewer:he.zj.Dashboard}getInitialPanelDataState(){return{state:g.Gu.NotStarted,series:[],timeRange:(0,m.JK)()}}componentDidMount(){const{panel:e,dashboard:t}=this.props;this.subs.add(e.events.subscribe(ge.U5,this.onRefresh)),this.subs.add(e.events.subscribe(ke._z,this.onRender)),t.panelInitialized(this.props.panel),this.hasPanelSnapshot?this.setState({data:(0,Pe.y)(e,t),isFirstLoad:!1}):(this.wantsQueryExecution||this.setState({isFirstLoad:!1}),this.subs.add(e.getQueryRunner().getData({withTransforms:!0,withFieldConfig:!0}).subscribe({next:e=>this.onDataUpdate(e)})),Ee.A.listen(this))}componentWillUnmount(){this.subs.unsubscribe(),Ee.A.remove(this)}liveTimeChanged(e){const{data:t}=this.state;if(t.timeRange){const n=e.to.valueOf()-t.timeRange.to.valueOf();if(n<100)return void console.log("Skip tick render",this.props.panel.title,n)}this.setState({liveTime:e})}componentDidUpdate(e){const{isInView:t,width:n}=this.props,{context:s}=this.state,i=this.getPanelContextApp();s.app!==i&&this.setState({context:Object.assign({},s,{app:i})}),t!==e.isInView&&t&&this.state.refreshWhenInView&&this.onRefresh(),n!==e.width&&Ee.A.updateInterval(this)}onDataUpdate(e){const{dashboard:t,panel:n,plugin:s}=this.props;if(s.meta.skipDataQuery)return void this.setState({data:this.getInitialPanelDataState()});let i,{isFirstLoad:a}=this.state;switch(e.state){case g.Gu.Loading:if(this.state.data.state===g.Gu.Loading)return;break;case g.Gu.Error:const{error:s}=e;s&&i!==s.message&&(i=s.message);break;case g.Gu.Done:t.snapshot&&(n.snapshotData=e.series.map((e=>(0,pe.og)(e)))),a&&(a=!1)}this.setState({isFirstLoad:a,errorMessage:i,data:e,liveTime:void 0})}get hasPanelSnapshot(){const{panel:e}=this.props;return e.snapshotData&&e.snapshotData.length}get wantsQueryExecution(){return!(this.props.plugin.meta.skipDataQuery||this.hasPanelSnapshot)}shouldSignalRenderingCompleted(e,t){return e===g.Gu.Done||t.skipDataQuery}skipFirstRender(e){const{isFirstLoad:t}=this.state;return this.wantsQueryExecution&&t&&(e===g.Gu.Loading||e===g.Gu.NotStarted)}renderPanelContent(e,t){var n,s;const{panel:i,plugin:a,dashboard:r}=this.props,{renderCounter:o,data:l}=this.state,{state:c}=l;if(this.skipFirstRender(c))return null;this.shouldSignalRenderingCompleted(c,a.meta)&&xe.r.renderingCompleted();const h=a.panel,p=null!==(n=null!==(s=this.state.liveTime)&&void 0!==s?s:l.timeRange)&&void 0!==n?n:this.timeSrv.timeRange(),u=i.getOptions();return this.eventFilter.onlyLocal=0===r.graphTooltip,(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(fe._w,{value:this.state.context,children:(0,d.jsx)(h,{id:i.id,data:l,title:i.title,timeRange:p,timeZone:this.props.dashboard.getTimezone(),options:u,fieldConfig:i.fieldConfig,transparent:i.transparent,width:e,height:t,renderCounter:o,replaceVariables:i.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:r.events})})})}renderPanel(e,t){var n,s;const{panel:i,plugin:a,dashboard:r}=this.props,{renderCounter:o,data:l}=this.state,{theme:c}=me.v,{state:h}=l;if(this.skipFirstRender(h))return null;this.shouldSignalRenderingCompleted(h,a.meta)&&xe.r.renderingCompleted();const u=a.panel,g=null!==(n=null!==(s=this.state.liveTime)&&void 0!==s?s:l.timeRange)&&void 0!==n?n:this.timeSrv.timeRange(),m=this.hasOverlayHeader()?0:c.panelHeaderHeight,f=a.noPadding?0:c.panelPadding,v=e-2*f-C.QO,b=t-m-2*f-C.QO,x=p()({"panel-content":!0,"panel-content--no-padding":a.noPadding}),w=i.getOptions();this.eventFilter.onlyLocal=0===r.graphTooltip;const y=this.props.timezone||this.props.dashboard.getTimezone();return(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{className:x,children:(0,d.jsx)(ue.b,{meta:a.meta,children:(0,d.jsx)(fe._w,{value:this.state.context,children:(0,d.jsx)(u,{id:i.id,data:l,title:i.title,timeRange:g,timeZone:y,options:w,fieldConfig:i.fieldConfig,transparent:i.transparent,width:v,height:b,renderCounter:o,replaceVariables:i.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:r.events})})})})})}hasOverlayHeader(){const{panel:e}=this.props,{data:t}=this.state;return(!t.request||!t.request.timeInfo)&&!e.hasTitle()}render(){var e;const{dashboard:t,panel:n,isViewing:s,isEditing:i,width:a,height:r,plugin:o}=this.props,{errorMessage:l,data:c}=this.state,{transparent:h}=n,u=null===(e=c.alertState)||void 0===e?void 0:e.state,g=p()({"panel-container":!0,"panel-container--absolute":y(b.E1.getLocation().pathname),"panel-container--transparent":h,"panel-container--no-title":this.hasOverlayHeader(),[`panel-alert-state--${u}`]:void 0!==u}),m=n.getDisplayTitle(),v=o.noPadding?"none":"md",x=[(0,d.jsx)(R,{state:c.state,onClick:()=>n.getQueryRunner().cancelQuery()},"loading-indicator")];return me.v.featureToggles.newPanelChromeUI?(0,d.jsx)(ve.fm,{width:a,height:r,title:m,leftItems:x,padding:v,children:(e,t)=>(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(be.SV,{dependencies:[c,o,n.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover,children:n=>{let{error:s}=n;return s?null:this.renderPanelContent(e,t)}})})}):(0,d.jsxs)("section",{className:g,"aria-label":f.wl.components.Panels.Panel.containerByTitle(n.title),children:[(0,d.jsx)(ne,{panel:n,dashboard:t,title:n.title,description:n.description,links:n.links,error:l,isEditing:i,isViewing:s,alertState:u,data:c}),(0,d.jsx)(be.SV,{dependencies:[c,o,n.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover,children:e=>{let{error:t}=e;return t?null:this.renderPanel(a,r)}})]})}}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Te={initPanelState:a.JI,setPanelInstanceState:r.pC},Ve=(0,i.connect)(((e,t)=>{const n=e.panels[t.stateKey];return n?{plugin:n.plugin,instanceState:n.instanceState}:{plugin:null}}),Te);class Ae extends s.PureComponent{constructor(){super(...arguments),Re(this,"onInstanceStateChange",(e=>{this.props.setPanelInstanceState({key:this.props.stateKey,value:e})})),Re(this,"onVisibilityChange",(e=>{this.props.panel.isInView=e})),Re(this,"onPanelLoad",(()=>{this.props.plugin||this.props.initPanelState(this.props.panel)})),Re(this,"renderPanel",(e=>{const{dashboard:t,panel:n,isViewing:s,isEditing:i,width:a,height:r,plugin:o,timezone:l}=this.props;return o?o&&o.angularPanelCtrl?(0,d.jsx)(oe,{plugin:o,panel:n,dashboard:t,isViewing:s,isEditing:i,isInView:e,width:a,height:r}):(0,d.jsx)(Ne,{plugin:o,panel:n,dashboard:t,isViewing:s,isEditing:i,isInView:e,width:a,height:r,onInstanceStateChange:this.onInstanceStateChange,timezone:l}):null}))}componentDidMount(){this.props.panel.isInView=!this.props.lazy,this.props.lazy||this.onPanelLoad()}render(){const{width:e,height:t,lazy:n}=this.props;return n?(0,d.jsx)(c,{width:e,height:t,onChange:this.onVisibilityChange,onLoad:this.onPanelLoad,children:this.renderPanel}):this.renderPanel(!0)}}Re(Ae,"defaultProps",{lazy:!0});const Le=Ve(Ae)},54958:(e,t,n)=>{n.d(t,{Z:()=>v});var s,i,a,r=n(68404),o=n(42870),l=n(25004),d=n(2633),c=n(80795),h=n(21888),p=n(53091),u=n(34944),g=n(45916);function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Error="Error",e.Info="Info",e.Links="Links"}(a||(a={}));class f extends r.Component{constructor(){super(...arguments),m(this,"timeSrv",(0,p.$t)()),m(this,"getInfoMode",(()=>{const{panel:e,error:t}=this.props;return t?a.Error:e.description?a.Info:e.links&&e.links.length?a.Links:void 0})),m(this,"getInfoContent",(()=>{const{panel:e}=this.props,t=e.description||"",n=(0,d.J)().replace(t,e.scopedVars),s=(0,o.a)(n),i=this.props.links&&this.props.links.getLinks(e.replaceVariables);return(0,g.jsxs)("div",{className:"panel-info-content markdown-html",children:[(0,g.jsx)("div",{dangerouslySetInnerHTML:{__html:s}}),i&&i.length>0&&(0,g.jsx)("ul",{className:"panel-info-corner-links",children:i.map(((e,t)=>(0,g.jsx)("li",{children:(0,g.jsx)("a",{className:"panel-info-corner-links__item",href:e.href,target:e.target,children:e.title})},t)))})]})})),m(this,"onClickError",(()=>{c.E1.partial({inspect:this.props.panel.id,inspectTab:u.q.Error})}))}renderCornerType(e,t,n){const r=e===a.Error?"error":"info",o=`panel-info-corner panel-info-corner--${e.toLowerCase()}`,d=l.wl.components.Panels.Panel.headerCornerInfo(e.toLowerCase());return(0,g.jsx)(h.u,{content:t,placement:"top-start",theme:r,interactive:!0,children:(0,g.jsxs)("button",{type:"button",className:o,onClick:n,"aria-label":d,children:[s||(s=(0,g.jsx)("i",{"aria-hidden":!0,className:"fa"})),i||(i=(0,g.jsx)("span",{className:"panel-info-corner-inner"}))]})})}render(){const{error:e}=this.props,t=this.getInfoMode();return t?t===a.Error&&e?this.renderCornerType(t,e,this.onClickError):t===a.Info||t===a.Links?this.renderCornerType(t,this.getInfoContent):null:null}}const v=f},14496:(e,t,n)=>{n.d(t,{N:()=>p});var s=n(15399),i=n(15696),a=n(31919),r=n(27843),o=n(32934),l=n(77401),d=n(25393);const c="hideSeriesFrom",h=(0,s.Y4)(c);function p(e,t,n,s){const{overrides:i}=n,a=e,r=i.findIndex(h);if(r<0){if(t===d.R.ToggleSelection){const e=u([a,...b(i,s)]);return Object.assign({},n,{overrides:[...n.overrides,e]})}const e=u(v(s,a));return Object.assign({},n,{overrides:[...n.overrides,e]})}const o=Array.from(i),[l]=o.splice(r,1);if(t===d.R.ToggleSelection){let e=m(l);const t=b(o,s);if(t.length>0&&(e=e.filter((e=>t.indexOf(e)<0))),e[0]===a&&1===e.length)return Object.assign({},n,{overrides:o});const i=u([a,...t]);return Object.assign({},n,{overrides:[...o,i]})}const c=g(l,a);return f(c,s)?Object.assign({},n,{overrides:o}):Object.assign({},n,{overrides:[...o,c]})}function u(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Ys.exclude,s=arguments.length>2?arguments[2]:void 0;return s=null!==(t=s)&&void 0!==t?t:{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:c,matcher:{id:a.mi.byNames,options:{mode:n,names:e,prefix:n===i.Ys.exclude?"All except:":void 0,readOnly:!0}},properties:[Object.assign({},s,{value:{viz:!0,legend:!1,tooltip:!1}})]}}const g=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Ys.exclude;const s=e.properties.find((e=>"custom.hideFrom"===e.id)),a=m(e),r=a.findIndex((e=>e===t));return r<0?a.push(t):a.splice(r,1),u(a,n,s)},m=e=>{var t;const n=null===(t=e.matcher.options)||void 0===t?void 0:t.names;return Array.isArray(n)?[...n]:[]},f=(e,t)=>m(e).length===v(t).length,v=(e,t)=>{const n=new Set;for(const s of e)for(const i of s.fields){if(i.type!==r.fS.number)continue;const a=(0,o.C)(i,s,e);a!==t&&n.add(a)}return Array.from(n)},b=(e,t)=>{let n=[];for(const i of e){var s;const e=i.properties.find((e=>"custom.hideFrom"===e.id));if(void 0!==e&&!0===(null===(s=e.value)||void 0===s?void 0:s.legend)){const e=l.Ls.get(i.matcher.id).get(i.matcher.options);for(const s of t)for(const i of s.fields){if(i.type!==r.fS.number)continue;const a=(0,o.C)(i,s,t);e(i,s,t)&&n.push(a)}}}return n}},89118:(e,t,n)=>{n.d(t,{ZQ:()=>O,mV:()=>E,f1:()=>T,$M:()=>R});var s=n(36298),i=n(88246),a=n(92721),r=n(80795),o=n(93570),l=n(65737),d=n(93686),c=n(2247),h=n(47900),p=n(42200),u=n(78130),g=n(32086),m=n(94722),f=n(53091),v=n(60057),b=n(54876),x=n(98142),C=n(64850),w=n(45921),y=n(20275),S=n(84455),k=n(62646),j=n(27904),I=n(31181);var P=n(39556);const D=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.forEach((e=>{e.panels?D(e.panels,t):e.targets&&e.targets.forEach((e=>{var n;null!==(n=e.datasource)&&void 0!==n&&n.type&&(t[e.datasource.type]?t[e.datasource.type].push(e):t[e.datasource.type]=[e])}))})),t};function E(e){return async(t,n)=>{var E,R;t((0,P.sf)());const V=await async function(e,t,n){const i=u.Z.getObject(N);if(i)return T(),i;try{switch(e.routeName){case C.vq.Home:{const e=await p.ae.get("/api/dashboards/home");if(e.redirectUri){const t=s.u.stripBaseFromUrl(e.redirectUri);return r.E1.replace(t),null}return e.meta.canSave=!1,e.meta.canShare=!1,e.meta.canStar=!1,e}case C.vq.Public:return await g.pD.loadDashboard("public",e.urlSlug,e.accessToken);case C.vq.Normal:{const t=await g.pD.loadDashboard(e.urlType,e.urlSlug,e.urlUid);if(e.fixUrl&&t.meta.url&&!b.r0.isPlaying){const e=s.u.stripBaseFromUrl(t.meta.url),n=r.E1.getLocation().pathname;e!==n&&(r.E1.replace(Object.assign({},r.E1.getLocation(),{pathname:e})),console.log("not correct url correcting",e,n))}return t}case C.vq.New:return O(e.urlFolderId,e.panelType);case C.vq.Path:{var a;const t=null!==(a=e.urlSlug)&&void 0!==a?a:"";return await g.pD.loadDashboard(C.vq.Path,t,t)}default:throw{message:"Unknown route "+e.routeName}}}catch(e){return(0,o.kW)(e)&&e.cancelled||(t((0,P.jA)({message:"Failed to fetch dashboard",error:e})),console.error(e)),null}}(e,t);if(!V)return;let A;t((0,P.Nv)());try{A=new k.f(V.dashboard,V.meta)}catch(e){return t((0,P.jA)({message:"Failed create dashboard model",error:e})),void console.error(e)}const L=n(),F=r.E1.getSearchObject();F.orgId||r.E1.partial({orgId:L.user.orgId},!0);const M=(0,f.$t)();(0,m.h4)().setCurrent(A),M.init(A);const U=(0,x.mn)(null!==(E=e.urlUid)&&void 0!==E?E:A.uid);await t((0,y.LX)(U,A));if((0,w.Tl)({dashboard:A,timeSrv:M}).run({dashboard:A,range:M.timeRange()}),(0,S.cp)(n())===U&&n().dashboard.initPhase===C.bG.Services){try{A.processRepeats(),F.autofitpanels&&A.autoFitPanels(window.innerHeight,F.kiosk),e.keybindingSrv.setupDashboardBindings(A)}catch(e){e instanceof Error&&t((0,d.$l)((0,h.t_)("Dashboard init failed",e))),console.error(e)}e.routeName!==C.vq.New?(!function(e){const t={dashboardId:e.id,dashboardName:e.title,dashboardUid:e.uid,folderName:e.meta.folderTitle,eventName:j.ct.DashboardView,publicDashboardUid:e.meta.publicDashboardUid};(0,I.r_)(t)}(A),v.H.watch(A.uid)):v.H.leave(),""!==A.weekStart?(0,i.Ls)(A.weekStart):(0,i.Ls)(l.v.bootData.user.weekStart),c.Z.publish(new a.Pl({dashboardId:A.uid,orgId:L.user.orgId,userId:null===(R=L.user.user)||void 0===R?void 0:R.id,grafanaVersion:l.v.buildInfo.version,queries:D(A.panels)})),t((0,P.dS)(A))}}}function O(e,t){const n={meta:{canStar:!1,canShare:!1,canDelete:!1,isNew:!0,folderId:0},dashboard:{title:"New dashboard",panels:[{type:null!=t?t:"add-panel",gridPos:{x:0,y:0,w:12,h:9},title:"Panel Title"}]}};return e&&(n.meta.folderId=parseInt(e,10)),n}const N="DASHBOARD_FROM_LS_KEY";function R(e){u.Z.setObject(N,e)}function T(){u.Z.delete(N)}},3420:(e,t,n)=>{n.d(t,{y:()=>p});var s=n(12717),i=n(22458),a=n(28173),r=n(71855),o=n(46782),l=n(8959),d=n(8343),c=n(53091),h=n(13631);function p(e,t){const n=(0,d.F9)(e.snapshotData),p=new l.g,u={dashboard:t,range:(0,s.JK)()},g=p.canWork(u)?p.getAnnotationsInSnapshot(t,e.id):[],m=[new i.i(g)];return{timeRange:(0,h.W1)(e,(0,c.$t)().timeRange()).timeRange,state:a.Gu.Done,series:(0,r.SM)({data:n,fieldConfig:{defaults:{},overrides:[]},replaceVariables:e.replaceVariables,fieldConfigRegistry:e.plugin.fieldConfigRegistry,theme:o.vc.theme2,timeZone:t.getTimezone()}),annotations:m}}},34944:(e,t,n)=>{let s;n.d(t,{q:()=>s}),function(e){e.Data="data",e.Meta="meta",e.Error="error",e.Stats="stats",e.JSON="json",e.Query="query",e.Actions="actions",e.Help="help"}(s||(s={}))},48951:(e,t,n)=>{n.d(t,{H:()=>l,n:()=>o});var s=n(68633),i=n(55343),a=n(79869),r=n(2417);const o=e=>{const t=e.field.links;if(t&&0!==t.length)return{getLinks:n=>{const o={};if(e.view){const{dataFrame:t}=e.view;o.__series={value:{name:t.name,refId:t.refId},text:"Series"};const n=void 0!==e.colIndex?t.fields[e.colIndex]:void 0;if(n){if(o.__field={value:{name:n.name,labels:n.labels},text:"Field"},void 0!==e.rowIndex&&e.rowIndex>=0){const{timeField:a}=(0,s.sV)(t);o.__value={value:{raw:n.values.get(e.rowIndex),numeric:e.display.numeric,text:(0,i.zc)(e.display),time:a?a.values.get(e.rowIndex):void 0},text:"Value"}}e.view&&(o.__data={value:{name:t.name,refId:t.refId,fields:(0,a.z)({frame:t,rowIndex:e.rowIndex})},text:"Data"})}else o.__value={value:{raw:e.display.numeric,numeric:e.display.numeric,text:(0,i.zc)(e.display),calc:e.name},text:"Value"}}else console.log("VALUE",e);const l=(e,t,s)=>{const i=Object.assign({},o,t);return n(e,i,s)};return t.map((t=>(0,r.Bq)().getDataLinkUIModel(t,l,e)))}}},l=e=>{const t=e.links;if(t&&0!==t.length)return{getLinks:()=>t.map((t=>(0,r.Bq)().getDataLinkUIModel(t,e.replaceVariables,e)))}}},17321:(e,t,n)=>{function s(e,t){return e.panels[t.key]}n.d(t,{i:()=>s})}}]);
//# sourceMappingURL=1454.49a7182e33cc461774bd.js.map